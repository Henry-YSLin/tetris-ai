(self.webpackChunktetris_ai=self.webpackChunktetris_ai||[]).push([[826],{795:(t,e,n)=>{"use strict";var r=n(294),o=n(935),i=n(727),a=n(977);const u=function(t){return r.createElement("p",null,"Not found")};const c=function(){return r.createElement("div",{className:"flex flex-col justify-center items-center select-none min-h-screen bg-gradient-to-br from-gray-900  to-blue-700"},r.createElement("h1",{className:"text-6xl text-green-500 border-b-4 pb-4"},"Hello World !"),r.createElement("h2",{className:"text-2xl text-gray-300 mt-10"},"Click"," ",r.createElement(i.rU,{to:"/test",className:"text-green-400 underline"},"here")," ","to play pre-alpha Tetris",r.createElement("br",null),r.createElement(i.rU,{to:"/multi/local",className:"text-green-400 underline"},"Local Multi")))};const l=function(t){return r.createElement(c,null)};var f,s=n(210),p=n.n(s),h=10,y=40,v=20,b=20,d=.5;function w(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t[t.None=0]="None",t[t.SoftDrop=1]="SoftDrop",t[t.HardDrop=2]="HardDrop",t[t.Hold=3]="Hold",t[t.ShiftLeft=4]="ShiftLeft",t[t.ShiftRight=5]="ShiftRight",t[t.RotateCW=6]="RotateCW",t[t.RotateCCW=7]="RotateCCW"}(f||(f={}));const g=f;function m(t){return t===f.RotateCCW||t===f.RotateCW}var S=function(){function t(e,n,r,o,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.Tick=e,this.Input=n,this.Success=r,this.Falling=o,this.Player=i}var e,n,r;return e=t,(n=[{key:"Clone",value:function(){return new t(this.Tick,this.Input,this.Success,this.Falling,this.Player)}}])&&w(e.prototype,n),r&&w(e,r),t}();function O(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var P,k,R,T,C,_,j,E,x,A,D,B,G,H,I,M,W=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.X=e,this.Y=n}var e,n,r;return e=t,(n=[{key:"Add",value:function(e){return new t(this.X+e.X,this.Y+e.Y)}},{key:"Subtract",value:function(e){return new t(this.X-e.X,this.Y-e.Y)}},{key:"Clone",value:function(){return new t(this.X,this.Y)}}])&&O(e.prototype,n),r&&O(e,r),t}();function L(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t[t.None=0]="None",t[t.I=1]="I",t[t.J=2]="J",t[t.L=3]="L",t[t.O=4]="O",t[t.S=5]="S",t[t.T=6]="T",t[t.Z=7]="Z",t[t.Garbage=8]="Garbage"}(H||(H={})),function(t){t[t.R0=0]="R0",t[t.R90=1]="R90",t[t.R180=2]="R180",t[t.R270=3]="R270"}(I||(I={})),function(t){t[t.CW=1]="CW",t[t.CCW=-1]="CCW"}(M||(M={}));var F=Object.freeze([(P={},L(P,-1,[new W(0,0),new W(1,0),new W(1,1),new W(0,-2),new W(1,-2)]),L(P,1,[new W(0,0),new W(-1,0),new W(-1,1),new W(0,-2),new W(-1,-2)]),P),(k={},L(k,-1,[new W(0,0),new W(1,0),new W(1,-1),new W(0,2),new W(1,2)]),L(k,1,[new W(0,0),new W(1,0),new W(1,-1),new W(0,2),new W(1,2)]),k),(R={},L(R,-1,[new W(0,0),new W(-1,0),new W(-1,1),new W(0,-2),new W(-1,-2)]),L(R,1,[new W(0,0),new W(1,0),new W(1,1),new W(0,-2),new W(1,-2)]),R),(T={},L(T,-1,[new W(0,0),new W(-1,0),new W(-1,-1),new W(0,2),new W(-1,2)]),L(T,1,[new W(0,0),new W(-1,0),new W(-1,-1),new W(0,2),new W(-1,2)]),T)]),N=Object.freeze([(C={},L(C,-1,[new W(0,0),new W(-1,0),new W(2,0),new W(-1,2),new W(2,-1)]),L(C,1,[new W(0,0),new W(-2,0),new W(1,0),new W(-2,-1),new W(1,2)]),C),(_={},L(_,-1,[new W(0,0),new W(2,0),new W(-1,0),new W(2,1),new W(-1,-2)]),L(_,1,[new W(0,0),new W(-1,0),new W(2,0),new W(-1,2),new W(2,-1)]),_),(j={},L(j,-1,[new W(0,0),new W(1,0),new W(-2,0),new W(1,-2),new W(-2,1)]),L(j,1,[new W(0,0),new W(2,0),new W(-1,0),new W(2,1),new W(-1,-2)]),j),(E={},L(E,-1,[new W(0,0),new W(-2,0),new W(1,0),new W(-2,-1),new W(1,2)]),L(E,1,[new W(0,0),new W(1,0),new W(-2,0),new W(1,-2),new W(-2,1)]),E)]),X=Object.freeze([(x={},L(x,-1,[new W(0,0)]),L(x,1,[new W(0,0)]),x),(A={},L(A,-1,[new W(0,0)]),L(A,1,[new W(0,0)]),A),(D={},L(D,-1,[new W(0,0)]),L(D,1,[new W(0,0)]),D),(B={},L(B,-1,[new W(0,0)]),L(B,1,[new W(0,0)]),B)]),Y=Object.freeze((L(G={},H.None,{Rotations:[[]],WallKick:X}),L(G,H.I,{Rotations:[[new W(0,2),new W(1,2),new W(2,2),new W(3,2)],[new W(2,0),new W(2,1),new W(2,2),new W(2,3)],[new W(0,1),new W(1,1),new W(2,1),new W(3,1)],[new W(1,0),new W(1,1),new W(1,2),new W(1,3)]],WallKick:N}),L(G,H.J,{Rotations:[[new W(0,2),new W(0,1),new W(1,1),new W(2,1)],[new W(2,2),new W(1,2),new W(1,1),new W(1,0)],[new W(0,1),new W(1,1),new W(2,1),new W(2,0)],[new W(0,0),new W(1,0),new W(1,1),new W(1,2)]],WallKick:F}),L(G,H.L,{Rotations:[[new W(0,1),new W(1,1),new W(2,1),new W(2,2)],[new W(1,2),new W(1,1),new W(1,0),new W(2,0)],[new W(0,0),new W(0,1),new W(1,1),new W(2,1)],[new W(0,2),new W(1,2),new W(1,1),new W(1,0)]],WallKick:F}),L(G,H.O,{Rotations:[[new W(0,0),new W(0,1),new W(1,0),new W(1,1)]],WallKick:X}),L(G,H.S,{Rotations:[[new W(0,1),new W(1,1),new W(1,2),new W(2,2)],[new W(1,2),new W(1,1),new W(2,1),new W(2,0)],[new W(0,0),new W(1,0),new W(1,1),new W(2,1)],[new W(0,2),new W(0,1),new W(1,1),new W(1,0)]],WallKick:F}),L(G,H.T,{Rotations:[[new W(0,1),new W(1,1),new W(1,2),new W(2,1)],[new W(1,2),new W(1,1),new W(2,1),new W(1,0)],[new W(0,1),new W(1,0),new W(1,1),new W(2,1)],[new W(1,2),new W(0,1),new W(1,1),new W(1,0)]],WallKick:F}),L(G,H.Z,{Rotations:[[new W(0,2),new W(1,1),new W(1,2),new W(2,1)],[new W(2,2),new W(1,1),new W(2,1),new W(1,0)],[new W(0,1),new W(1,0),new W(1,1),new W(2,0)],[new W(1,2),new W(0,1),new W(1,1),new W(0,0)]],WallKick:F}),L(G,H.Garbage,{Rotations:[[new W(0,0)]],WallKick:X}),G));const z=Y;function U(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const V=function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),U(this,"listeners",[]),U(this,"listenersOncer",[]),U(this,"on",(function(t){return e.listeners.push(t),{dispose:function(){return e.off(t)}}})),U(this,"once",(function(t){e.listenersOncer.push(t)})),U(this,"off",(function(t){var n=e.listeners.indexOf(t);n>-1&&e.listeners.splice(n,1)})),U(this,"emit",(function(t){if(e.listeners.forEach((function(e){return e(t)})),e.listenersOncer.length>0){var n=e.listenersOncer;e.listenersOncer=[],n.forEach((function(e){return e(t)}))}})),U(this,"pipe",(function(t){return e.on((function(e){return t.emit(e)}))}))};Array.prototype.max||Object.defineProperty(Array.prototype,"max",{enumerable:!1,writable:!1,configurable:!1,value:function(){for(var t=this.length,e=this[this.length-1];t--;)this[t]>=e&&(e=this[t]);return e}}),Array.prototype.maxBy||Object.defineProperty(Array.prototype,"maxBy",{enumerable:!1,writable:!1,configurable:!1,value:function(t){for(var e=this.length,n=t(this[this.length-1]),r=this[this.length-1];e--;){var o=t(this[e]);o>=n&&(n=o,r=this[e])}return r}}),Array.prototype.min||Object.defineProperty(Array.prototype,"min",{enumerable:!1,writable:!1,configurable:!1,value:function(){for(var t=this.length,e=this[this.length-1];t--;)this[t]<=e&&(e=this[t]);return e}}),Array.prototype.minBy||Object.defineProperty(Array.prototype,"minBy",{enumerable:!1,writable:!1,configurable:!1,value:function(t){for(var e=this.length,n=t(this[this.length-1]),r=this[this.length-1];e--;){var o=t(this[e]);o<=n&&(n=o,r=this[e])}return r}});const q=function(t){return function(){var e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}};function K(t){return function(t){if(Array.isArray(t))return Q(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Q(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Q(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function $(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function J(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Z(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,et(t,e,"get"))}function tt(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,et(t,e,"set"),n),n}function et(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var nt=new WeakMap,rt=new WeakMap,ot=new WeakMap,it=function(){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;if($(this,t),nt.set(this,{writable:!0,value:void 0}),rt.set(this,{writable:!0,value:void 0}),ot.set(this,{writable:!0,value:void 0}),n instanceof Array)return tt(this,rt,null),tt(this,ot,new Array(r+n.length).fill(H.None)),(e=Z(this,ot)).splice.apply(e,[r,n.length].concat(K(n))),void tt(this,nt,null);tt(this,rt,void 0===n?Math.floor(Math.random()*Math.pow(2,32)):n),tt(this,nt,q(Z(this,rt))),tt(this,ot,[])}var e,n,r;return e=t,(n=[{key:"Seed",get:function(){return Z(this,rt)}},{key:"generate",value:function(){if(null!==Z(this,rt)&&null!==Z(this,nt))for(var t=[H.I,H.J,H.L,H.O,H.S,H.T,H.Z];t.length>0;){var e=Math.floor(Z(this,nt).call(this)*t.length)%t.length;Z(this,ot).push(t.splice(e,1)[0])}else Z(this,ot).push(H.None)}},{key:"Get",value:function(t){for(;Z(this,ot).length<=t;)this.generate();return Z(this,ot)[t]}},{key:"GetRange",value:function(t,e){for(;Z(this,ot).length<=t+e;)this.generate();return Z(this,ot).slice(t,t+e)}}])&&J(e.prototype,n),r&&J(e,r),t}();function at(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ut(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ct,lt=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I.R0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:NaN,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:NaN,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:g.None,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;at(this,t),this.Type=e,this.Rotation=n,r?this.Position=r:(this.Position=new W(4,21),this.Bottom=21,this.Left=Math.floor(5-this.Width/2)),this.LastActionTick=o,this.ActionCount=i,this.DropTick=a,this.LastAction=u,this.PieceIndex=c}var e,n,r;return e=t,r=[{key:"Spawn",value:function(e,n,r){return new t(e,void 0,void 0,n,0,n,void 0,r)}}],(n=[{key:"Clone",value:function(){return new t(this.Type,this.Rotation,this.Position.Clone(),this.LastActionTick,this.ActionCount,this.DropTick,this.LastAction,this.PieceIndex)}},{key:"InternalPoints",get:function(){return Y[this.Type].Rotations[this.Rotation]}},{key:"Points",get:function(){var t=this;return Y[this.Type].Rotations[this.Rotation].map((function(e){return e.Add(t.Position)}))}},{key:"InternalLeft",get:function(){return this.InternalPoints.map((function(t){return t.X})).min()}},{key:"InternalRight",get:function(){return this.InternalPoints.map((function(t){return t.X})).max()}},{key:"InternalTop",get:function(){return this.InternalPoints.map((function(t){return t.Y})).max()}},{key:"InternalBottom",get:function(){return this.InternalPoints.map((function(t){return t.Y})).min()}},{key:"Left",get:function(){return this.Position.X+this.InternalLeft},set:function(t){this.Position.X=t-this.InternalLeft}},{key:"Right",get:function(){return this.Position.X+this.InternalRight},set:function(t){this.Position.X=t-this.InternalRight}},{key:"Top",get:function(){return this.Position.Y+this.InternalTop},set:function(t){this.Position.Y=t-this.InternalTop}},{key:"Bottom",get:function(){return this.Position.Y+this.InternalBottom},set:function(t){this.Position.Y=t-this.InternalBottom}},{key:"Width",get:function(){return this.InternalRight-this.InternalLeft+1}},{key:"Height",get:function(){return this.InternalTop-this.InternalBottom+1}},{key:"Rotate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M.CW;this.Rotation+=t;var e=Y[this.Type].Rotations.length;this.Rotation>=e&&(this.Rotation=0),this.Rotation<0&&(this.Rotation=e-1)}}])&&ut(e.prototype,n),r&&ut(e,r),t}();function ft(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t[t.LineClear=0]="LineClear",t[t.TSpin=1]="TSpin",t[t.TSpinMini=2]="TSpinMini",t[t.PerfectClear=3]="PerfectClear"}(ct||(ct={}));const st=function(){function t(e,n,r,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.LinesCleared=e,this.Type=n,this.Combo=r,this.BackToBack=o}var e,n,r;return e=t,(n=[{key:"Clone",value:function(){return new t(this.LinesCleared,this.Type,this.Combo,this.BackToBack)}},{key:"Rating",get:function(){var t=Math.pow(1.1,this.LinesCleared.length);switch(this.Type){case ct.PerfectClear:t*=1.5;case ct.TSpin:t*=1.3;case ct.TSpinMini:t*=1.1}return this.BackToBack&&(t*=1.1),this.Combo&&(t*=Math.pow(1.05,this.Combo)),t}},{key:"Garbage",get:function(){var t=0,e=0;switch(this.BackToBack&&t++,this.Combo){case 0:case 1:break;case 2:case 3:t+=1;break;case 4:case 5:t+=2;break;case 6:case 7:t+=3;break;case 8:case 9:case 10:t+=4;break;default:t+=5}if(this.Type===ct.PerfectClear)e+=6;else if(this.Type===ct.LineClear)switch(this.LinesCleared.length){case 0:case 1:break;case 2:t++;break;case 3:t+=2;break;default:t+=4}else this.Type===ct.TSpinMini?t+=this.LinesCleared.length:this.Type===ct.TSpin&&(t+=2*this.LinesCleared.length,this.BackToBack&&3===this.LinesCleared.length&&t++);return{Targeted:t,Universal:e}}},{key:"toString",value:function(){var t="",e="";switch(this.Combo>0&&(t+="".concat(this.Combo," REN ")),this.BackToBack&&(t+="Back-to-back "),this.Type){case ct.PerfectClear:e+="Perfect Clear ";break;case ct.TSpinMini:e+="T-Spin Mini ";break;case ct.TSpin:e+="T-Spin "}if(this.Type!==ct.PerfectClear)switch(this.LinesCleared.length){case 4:e+="Tetris ";break;case 3:e+="Triple ";break;case 2:e+="Double ";break;case 1:e+="Single "}return[t.trim(),e.trim()]}}])&&ft(e.prototype,n),r&&ft(e,r),t}();function pt(t){return t.Type===ct.LineClear&&t.LinesCleared.length>=4||(t.Type===ct.TSpin||t.Type===ct.TSpinMini)&&t.LinesCleared.length>0}function ht(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return yt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function vt(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,dt(t,e,"get"))}function bt(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,dt(t,e,"set"),n),n}function dt(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function wt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function gt(t,e,n){return e&&wt(t.prototype,e),n&&wt(t,n),t}function mt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var St=function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:y,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:v,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7?arguments[7]:void 0,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,s=arguments.length>9&&void 0!==arguments[9]&&arguments[9],p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,d=arguments.length>12&&void 0!==arguments[12]&&arguments[12];mt(this,t),this.Grid=new Array(40).fill(null).map((function(){return new Array(10).fill(H.None)})),o&&o.forEach((function(t,n){return t.forEach((function(t,r){return e.Grid[n][r]=t}))})),this.GridWidth=i,this.GridHeight=a,this.PlayfieldHeight=u,this.Falling=c?c.Clone():null,this.Hold=l?l.Clone():null,this.BlockHold=s,this.TicksElapsed=f,this.PieceQueue=n,this.PieceIndex=r,this.Combo=p,this.LastAchievement=b,this.IsDead=d},Ot=function(){function t(e,n){mt(this,t),this.Type=e,this.PieceIndex=n}return gt(t,[{key:"Clone",value:function(){return new t(this.Type,this.PieceIndex)}}]),t}(),Pt=new WeakMap,kt=new WeakMap,Rt=new WeakMap;const Tt=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,f=arguments.length>8&&void 0!==arguments[8]&&arguments[8];if(mt(this,t),Pt.set(this,{writable:!0,value:void 0}),kt.set(this,{writable:!0,value:void 0}),Rt.set(this,{writable:!0,value:void 0}),n instanceof St){var s=n;this.Grid=s.Grid,this.Grid=new Array(40).fill(null).map((function(){return new Array(10).fill(H.None)})),s.Grid&&s.Grid.forEach((function(t,n){return t.forEach((function(t,r){return e.Grid[n][r]=t}))})),this.Falling=s.Falling,this.Hold=s.Hold,this.BlockHold=s.BlockHold,this.TicksElapsed=s.TicksElapsed,bt(this,Pt,new it(s.PieceQueue,s.PieceIndex)),this.PieceIndex=s.PieceIndex,this.Combo=s.Combo,this.LastAchievement=s.LastAchievement,this.IsDead=s.IsDead}else this.Grid=new Array(40).fill(null).map((function(){return new Array(10).fill(H.None)})),this.Falling=o,this.Hold=null!=i?i:null,this.BlockHold=u,this.TicksElapsed=a,bt(this,Pt,new it(n)),this.PieceIndex=r,this.Combo=c,this.LastAchievement=l,this.IsDead=f;bt(this,kt,new V),bt(this,Rt,new V)}return gt(t,[{key:"GetVisibleState",value:function(){var t;return new St(this.PieceQueue,this.PieceIndex,this.Grid,this.GridWidth,this.GridHeight,this.PlayfieldHeight,this.Falling,this.Hold,this.TicksElapsed,this.BlockHold,this.Combo,null===(t=this.LastAchievement)||void 0===t?void 0:t.Clone(),this.IsDead)}},{key:"Achievement",get:function(){return vt(this,kt)}},{key:"Dead",get:function(){return vt(this,Rt)}},{key:"GridWidth",get:function(){return h}},{key:"GridHeight",get:function(){return y}},{key:"PlayfieldHeight",get:function(){return v}},{key:"PieceQueue",get:function(){return vt(this,Pt).GetRange(this.PieceIndex,6)}},{key:"Get",value:function(t){var e,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(t instanceof W)e=t.X,n=t.Y;else{if(void 0===r)return null;e=t,n=r}return e<0||n<0||e>=h||n>=y?null:this.Grid[n][e]}},{key:"IsPieceValid",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return e?!e.Points.some((function(e){var n;return(null!==(n=t.Get(e))&&void 0!==n?n:H.I)!==H.None})):!this.Falling||!this.Falling.Points.some((function(e){var n;return(null!==(n=t.Get(e))&&void 0!==n?n:H.I)!==H.None}))}},{key:"HasHold",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return void 0===t?null!==this.Hold&&this.Hold.Type!==H.None:null!==t&&t.Type!==H.None}},{key:"DequeuePiece",value:function(){return null===this.Falling&&(this.Falling=lt.Spawn(vt(this,Pt).Get(this.PieceIndex),this.TicksElapsed,this.PieceIndex),this.PieceIndex++,this.BlockHold=!1,!!this.IsPieceValid()||(this.IsDead=!0,vt(this,Rt).emit(),!1))}},{key:"HoldPiece",value:function(){if(null===this.Falling)return!1;if(this.BlockHold)return!1;var t=this.Hold;return this.Hold=new Ot(this.Falling.Type,this.PieceIndex-1),this.HasHold(t)||(t=new Ot(vt(this,Pt).Get(this.PieceIndex),this.PieceIndex),this.PieceIndex++),t&&(this.Falling=lt.Spawn(t.Type,this.TicksElapsed,t.PieceIndex)),this.BlockHold=!0,this.Falling.LastAction=g.Hold,!0}},{key:"ClearLines",value:function(){var t,e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,r=[],o=null;if((null==n?void 0:n.Type)===H.T&&m(n.LastAction)){var i=[[0,0],[2,0],[0,2],[2,2]].reduce((function(t,r){var o=ht(r,2),i=o[0],a=o[1];return e.Get(n.Position.X+i,n.Position.Y+a)!==H.None?t+1:t}),0);if(i>=3){var a=[[1,0],[0,1],[1,2],[2,1]].some((function(t){var r=ht(t,2),o=r[0],i=r[1];return!n.InternalPoints.find((function(t){return t.X===o&&t.Y===i}))&&e.Get(n.Position.X+o,n.Position.Y+i)!==H.None}));o=a?ct.TSpinMini:ct.TSpin}}for(var u=this.GridHeight-1;u>=0;u--)this.Grid[u].some((function(t){return t===H.None}))||(this.Grid.splice(u,1),this.Grid.push(new Array(this.GridWidth).fill(H.None)),r.push(u));if(0===r.length){if(this.Combo=0,null===o)return}else r.length>1&&o===ct.TSpinMini&&(o=ct.TSpin);var c=new st(r,null!==(t=o)&&void 0!==t?t:ct.LineClear,this.Combo,!!this.LastAchievement&&pt(this.LastAchievement));r.length>0&&this.Combo++,this.Grid.some((function(t){return t.some((function(t){return t!==H.None}))}))||(c.Type=ct.PerfectClear),c.BackToBack=pt(c)&&c.BackToBack;var l=c.Clone();vt(this,kt).emit(c),this.LastAchievement=l}},{key:"LockPiece",value:function(){var t=this;if(null===this.Falling)return!1;for(;!this.IsPieceValid();)this.Falling.Position.Y++;return this.Falling.Points.forEach((function(e){var n,r;return t.Grid[e.Y][e.X]=null!==(n=null===(r=t.Falling)||void 0===r?void 0:r.Type)&&void 0!==n?n:H.None})),this.ClearLines(this.Falling),this.Falling.Points.map((function(t){return t.Y})).min()>=this.PlayfieldHeight&&(this.IsDead=!0,vt(this,Rt).emit()),this.Falling=null,!0}},{key:"RotatePiece",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M.CW;if(null===this.Falling)return!1;var n=Y[this.Falling.Type].WallKick[this.Falling.Rotation][e].find((function(n){var r,o=null===(r=t.Falling)||void 0===r?void 0:r.Clone();return!!o&&(o.Rotate(e),o.Position=o.Position.Add(n),t.IsPieceValid(o))}));return!!n&&(this.Falling.Rotate(e),this.Falling.Position=this.Falling.Position.Add(n),this.Falling.LastActionTick=this.TicksElapsed,this.Falling.ActionCount++,this.Falling.LastAction=e===M.CW?g.RotateCW:g.RotateCCW,!0)}},{key:"ShiftPiece",value:function(t){if(null===this.Falling)return!1;var e=this.Falling.Clone();return e.Position.X+=t,!!this.IsPieceValid(e)&&(this.Falling=e,this.Falling.LastActionTick=this.TicksElapsed,this.Falling.ActionCount++,this.Falling.LastAction=t>0?g.ShiftRight:g.ShiftLeft,!0)}},{key:"CanPieceDrop",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(e)t=e.Clone();else{if(!this.Falling)return!1;t=this.Falling.Clone()}return t.Position.Y--,this.IsPieceValid(t)}},{key:"SoftDropPiece",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null!==this.Falling&&(!!this.CanPieceDrop()&&(this.Falling.Position.Y--,this.Falling.LastActionTick=this.TicksElapsed,this.Falling.ActionCount=0,t?this.Falling.DropTick=this.TicksElapsed:this.Falling.LastAction=g.SoftDrop,!0))}},{key:"HardDropPiece",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(e)t=e;else{if(!this.Falling)return!1;t=this.Falling}for(var n=t.Position.Y;this.IsPieceValid(t);)t.Position.Y--;return t.Position.Y++,n!==t.Position.Y&&(t.LastAction=g.HardDrop),t!==this.Falling||this.LockPiece()}},{key:"Tick",value:function(){this.IsDead||(null===this.Falling?this.DequeuePiece():(this.TicksElapsed-this.Falling.DropTick>=15&&this.SoftDropPiece(!0),this.TicksElapsed-this.Falling.LastActionTick>=60&&!this.CanPieceDrop()&&this.LockPiece()),this.TicksElapsed++)}}]),t}();function Ct(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _t(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Et(t,e,"get"))}function jt(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Et(t,e,"set"),n),n}function Et(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var xt=new WeakMap,At=new WeakMap,Dt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),xt.set(this,{writable:!0,value:void 0}),At.set(this,{writable:!0,value:void 0}),jt(this,At,void 0===e?Math.floor(Math.random()*Math.pow(2,32)):e),jt(this,xt,q(_t(this,At)))}var e,n,r;return e=t,(n=[{key:"Seed",get:function(){return _t(this,At)}},{key:"Get",value:function(t){return Math.floor(_t(this,xt).call(this)*t)}}])&&Ct(e.prototype,n),r&&Ct(e,r),t}();function Bt(t){return(Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Gt(t,e,n){return(Gt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Yt(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Ht(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Mt(t,e,"get"))}function It(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Mt(t,e,"set"),n),n}function Mt(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function Wt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Lt(t,e)}function Lt(t,e){return(Lt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ft(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Yt(t);if(e){var o=Yt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Nt(this,n)}}function Nt(t,e){return!e||"object"!==Bt(e)&&"function"!=typeof e?Xt(t):e}function Xt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Yt(t){return(Yt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function zt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ut(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Vt(t,e,n){return e&&Ut(t.prototype,e),n&&Ut(t,n),t}var qt=function(){function t(e,n){zt(this,t),this.Lines=e,this.TickEnqueued=n}return Vt(t,[{key:"Clone",value:function(){return new t(this.Lines,this.TickEnqueued)}}]),t}(),Kt=function(t){Wt(n,t);var e=Ft(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:y,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:v,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,p=arguments.length>9&&void 0!==arguments[9]&&arguments[9],b=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,w=arguments.length>12&&void 0!==arguments[12]&&arguments[12],g=arguments.length>13&&void 0!==arguments[13]?arguments[13]:[];return zt(this,n),(t=e.call(this,r,o,i,a,u,c,l,f,s,p,b,d,w)).GarbageMeter=g.map((function(t){return t.Clone()})),t}return n}(St),Qt=new WeakMap;const $t=function(t){Wt(n,t);var e=Ft(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,c=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s=arguments.length>8&&void 0!==arguments[8]&&arguments[8],p=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[],h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:void 0;if(zt(this,n),t=e.call(this,r,o,null!=i?i:void 0,a,u,c,l,f,s),Qt.set(Xt(t),{writable:!0,value:void 0}),r instanceof Kt){var y=r;t.GarbageMeter=y.GarbageMeter,It(Xt(t),Qt,null)}else t.GarbageMeter=p,It(Xt(t),Qt,new Dt(h));return t}return Vt(n,[{key:"GetVisibleState",value:function(){var t;return new Kt(this.PieceQueue,this.PieceIndex,this.Grid,this.GridWidth,this.GridHeight,this.PlayfieldHeight,this.Falling,this.Hold,this.TicksElapsed,this.BlockHold,this.Combo,null===(t=this.LastAchievement)||void 0===t?void 0:t.Clone(),this.IsDead,this.GarbageMeter)}},{key:"SpawnGarbageLines",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(Ht(this,Qt)){var e=new Array(this.GridWidth).fill(H.Garbage);e[Ht(this,Qt).Get(this.GridWidth)]=H.None;for(var n=0;n<t;n++)this.Grid.unshift(e.slice()),this.Grid.pop();if(this.Falling)for(;!this.IsPieceValid();)this.Falling.Position.Y++}}},{key:"CancelGarbage",value:function(t){for(;t>0||this.GarbageMeter.length>0;){var e=this.GarbageMeter.minBy((function(t){return t.TickEnqueued}));e.Lines>=t?(e.Lines-=t,t=0):(t-=e.Lines,this.GarbageMeter.splice(this.GarbageMeter.indexOf(e),1))}return t}},{key:"Tick",value:function(){var t=this;this.IsDead||(this.GarbageMeter.forEach((function(e){e.Lines<=0||t.TicksElapsed-e.TickEnqueued>=240&&t.SpawnGarbageLines(e.Lines)})),this.GarbageMeter=this.GarbageMeter.filter((function(e){return t.TicksElapsed-e.TickEnqueued<240&&e.Lines>0})),Gt(Yt(n.prototype),"Tick",this).call(this))}}]),n}(Tt);var Jt=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)};function Zt(t){return(Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function te(t,e){return(te=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ee(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=re(t);if(e){var o=re(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ne(this,n)}}function ne(t,e){return!e||"object"!==Zt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function re(t){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var oe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&te(t,e)}(n,t);var e=ee(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).Participants=[],t}return n}(Jt);function ie(t){return(ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ae(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ue(t,e){return(ue=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ce(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=se(t);if(e){var o=se(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return le(this,n)}}function le(t,e){return!e||"object"!==ie(e)&&"function"!=typeof e?fe(t):e}function fe(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function se(t){return(se=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pe(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ye(t,e,"get"))}function he(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,ye(t,e,"set"),n),n}function ye(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var ve=new WeakMap,be=new WeakMap,de=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ue(t,e)}(i,t);var e,n,r,o=ce(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),e=o.call(this),ve.set(fe(e),{writable:!0,value:void 0}),be.set(fe(e),{writable:!0,value:void 0}),he(fe(e),ve,null),e.Participants=t.map((function(t){return{Player:t.player,State:t.seed instanceof $t?t.seed:new $t(t.seed)}})),e.Participants.map((function(t){return t.State})).forEach((function(t){return t.Achievement.on((function(n){var r=n.Garbage,o=e.Participants.map((function(t){return t.State})).filter((function(e){return e!==t}));o.forEach((function(t){return t.GarbageMeter.push(new qt(r.Universal,t.TicksElapsed))}));var i=o.filter((function(t){return!t.IsDead})),a=i[Math.floor(Math.random()*i.length)];a&&a.GarbageMeter.push(new qt(r.Targeted,a.TicksElapsed))}))})),he(fe(e),be,new V),e}return e=i,(n=[{key:"Input",get:function(){return pe(this,be)}},{key:"ClockRunning",get:function(){return null!==pe(this,ve)}},{key:"StartClock",value:function(){he(this,ve,window.setInterval(this.Tick.bind(this),1e3/60))}},{key:"StopClock",value:function(){null!==pe(this,ve)&&window.clearInterval(pe(this,ve))}},{key:"Tick",value:function(){var t=this;this.Participants.forEach((function(e){if(!e.State.IsDead){e.State.Tick();var n=e.Player.Tick(e.State.GetVisibleState()),r=e.State.Falling,o=!1;switch(n){case g.None:break;case g.HardDrop:o=e.State.HardDropPiece();break;case g.Hold:o=e.State.HoldPiece();break;case g.RotateCW:o=e.State.RotatePiece(M.CW);break;case g.RotateCCW:o=e.State.RotatePiece(M.CCW);break;case g.ShiftLeft:o=e.State.ShiftPiece(-1);break;case g.ShiftRight:o=e.State.ShiftPiece(1);break;case g.SoftDrop:o=e.State.SoftDropPiece(!1)}n!==g.None&&pe(t,be).emit(new S(e.State.TicksElapsed,n,o,r,e.Player))}}))}}])&&ae(e.prototype,n),r&&ae(e,r),i}(oe);function we(t){return(we="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ge(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function me(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Se(t,e){return(Se=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Oe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ke(t);if(e){var o=ke(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Pe(this,n)}}function Pe(t,e){return!e||"object"!==we(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ke(t){return(ke=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Re(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Se(t,e)}(i,t);var e,n,r,o=Oe(i);function i(){var t;ge(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).State=null,t}return e=i,(n=[{key:"ConfigureGameState",value:function(t){this.State=t}}])&&me(e.prototype,n),r&&me(e,r),i}(t)}function Te(t){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ce(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function je(t,e){return(je=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ee(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ae(t);if(e){var o=Ae(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return xe(this,n)}}function xe(t,e){return!e||"object"!==Te(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ae(t){return(Ae=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function De(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&je(t,e)}(i,t);var e,n,r,o=Ee(i);function i(){var t;Ce(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).Player=null,t}return e=i,(n=[{key:"ConfigurePlayer",value:function(t){this.Player=t}}])&&_e(e.prototype,n),r&&_e(e,r),i}(t)}function Be(t){return(Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ge(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function He(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ie(t,e){return(Ie=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Me(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Le(t);if(e){var o=Le(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return We(this,n)}}function We(t,e){return!e||"object"!==Be(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Le(t){return(Le=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Fe(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ie(t,e)}(i,t);var e,n,r,o=Me(i);function i(){var t;Ge(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).Game=null,t}return e=i,(n=[{key:"ConfigureGame",value:function(t){this.Game=t}}])&&He(e.prototype,n),r&&He(e,r),i}(t)}function Ne(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Ye,ze,Ue,Ve=function(){function t(e,n,r,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t.Linear;Ne(this,t),this.From=e,this.To=n,this.Duration=r,this.Data=o,this.Elapsed=i,this.EasingFunction=a}var e,n,r;return e=t,r=[{key:"Linear",value:function(t){return t}},{key:"EaseOutQuint",value:function(t){return 1-Math.pow(1-t,5)}},{key:"EaseInOutSine",value:function(t){return-(Math.cos(Math.PI*t)-1)/2}},{key:"RevertingFunction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.EaseInOutSine,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;return function(t){return t<=n?e(t/n):t>=1-n?e((1-t)/n):1}}}],(n=[{key:"CurrentValue",get:function(){return this.From+(this.To-this.From)*this.EasingFunction(this.Elapsed/this.Duration)}},{key:"Finished",get:function(){return this.Elapsed>=this.Duration}},{key:"Tick",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.Elapsed+=t}}])&&Xe(e.prototype,n),r&&Xe(e,r),t}();function qe(t){return(qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ke(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function $e(t,e,n){return($e="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=en(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Je(t,e){return(Je=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ze(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=en(t);if(e){var o=en(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return tn(this,n)}}function tn(t,e){return!e||"object"!==qe(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function en(t){return(en=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function nn(t){return"ConfigurePlayfieldAnimatable"in t}function rn(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Je(t,e)}(i,t);var e,n,r,o=Ze(i);function i(){var t;Ke(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).HardDropAnimations=[],t.LineClearAnimations=[],t}return e=i,(n=[{key:"ConfigurePlayfieldAnimatable",value:function(){var t=this;null!==this.State?null!==this.Game?null!==this.Player?(this.Game.Input.on((function(e){e.Player===t.Player&&e.Input===g.HardDrop&&e.Success&&e.Falling&&t.HardDropAnimations.push(new Ve(1,0,20,{left:e.Falling.Left,right:e.Falling.Right,end:e.Falling.Top,type:e.Falling.Type},0,Ve.EaseOutQuint))})),this.State.Achievement.on((function(e){var n=0;e.LinesCleared.forEach((function(e){t.LineClearAnimations.filter((function(t){return t.Data.Y>e})).forEach((function(t){return t.Data.Y--})),t.LineClearAnimations.push(new Ve(1,0,20+n,{Y:e,OrigY:e},0,Ve.EaseOutQuint)),n+=4}))}))):console.error("ConfigurePlayfieldAnimatable called before this.Player is assigned. Beware of the call order of Configure_ functions."):console.error("ConfigurePlayfieldAnimatable called before this.Game is assigned. Beware of the call order of Configure_ functions."):console.error("ConfigurePlayfieldAnimatable called before this.State is assigned. Beware of the call order of Configure_ functions.")}},{key:"p5Draw",value:function(t){$e(en(i.prototype),"p5Draw",this).call(this,t),this.HardDropAnimations.forEach((function(t){return t.Tick()})),this.HardDropAnimations=this.HardDropAnimations.filter((function(t){return!t.Finished})),this.LineClearAnimations.forEach((function(t){return t.Tick()})),this.LineClearAnimations=this.LineClearAnimations.filter((function(t){return!t.Finished}))}}])&&Qe(e.prototype,n),r&&Qe(e,r),i}(t)}function on(t,e){return t.setAlpha(e),t}function an(t,e){switch(e){case H.None:return t.color(50);case H.I:return t.color(77,208,225);case H.J:return t.color(33,150,243);case H.L:return t.color(255,152,0);case H.O:return t.color(253,216,53);case H.S:return t.color(76,175,80);case H.T:return t.color(224,64,251);case H.Z:return t.color(229,115,115);case H.Garbage:return t.color(150)}}function un(t,e,n,r,o,i){t.fill(on(an(t,null!=e?e:H.None),i)),r.forEach((function(e){t.rect(n.X+e.X*o,n.Y+e.Y*o,o,o)}))}function cn(t,e,n,r,o,i){t.push(),t.scale(1,-1),t.text(e,n,-r,o,void 0===i?i:-i),t.pop()}function ln(t){return void 0!==Object.keys(ze).find((function(e){return e===t}))}function fn(t){return void 0!==Object.keys(Ue).find((function(e){return e===t}))}function sn(t){if(t instanceof S)switch(t.Input){case g.None:return null;case g.HardDrop:return Ye.Lock;case g.RotateCCW:case g.RotateCW:return t.Success?Ye.RotateSuccess:Ye.RotateFail;case g.ShiftLeft:case g.ShiftRight:return t.Success?Ye.ShiftSuccess:Ye.ShiftFail;case g.SoftDrop:return Ye.SoftDrop;case g.Hold:return t.Success?Ye.Hold:null}if(t instanceof st){var e=[];if(t.Combo>0){var n="Combo".concat(Math.min(20,t.Combo));ln(n)&&e.push(ze[n])}if(t.Type===ct.PerfectClear)return e.push(ze.PerfectClear),e;var r="";return t.BackToBack&&(r+="B2b"),t.Type===ct.TSpinMini?r+="TSpinMini":(t.Type===ct.TSpin&&(r+="TSpin"),1===t.LinesCleared.length?r+="Single":2===t.LinesCleared.length?r+="Double":3===t.LinesCleared.length?r+="Triple":4===t.LinesCleared.length&&(r+="Tetris")),(ln(r)||r.startsWith("B2b")&&ln(r=r.substr(3)))&&e.push(ze[r]),e}return null}function pn(t){return(pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function hn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vn(t,e,n){return(vn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=mn(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function bn(t,e){return(bn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function dn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=mn(t);if(e){var o=mn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return wn(this,n)}}function wn(t,e){return!e||"object"!==pn(e)&&"function"!=typeof e?gn(t):e}function gn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function mn(t){return(mn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Sn(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Pn(t,e,"get"))}function On(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Pn(t,e,"set"),n),n}function Pn(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function kn(t){var e,n,r;return e=new WeakMap,n=new WeakMap,r=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&bn(t,e)}(c,t);var o,i,a,u=dn(c);function c(){var t;hn(this,c);for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return t=u.call.apply(u,[this].concat(i)),e.set(gn(t),{writable:!0,value:void 0}),n.set(gn(t),{writable:!0,value:void 0}),r.set(gn(t),{writable:!0,value:void 0}),On(gn(t),e,new W(0,0)),On(gn(t),n,new W(1,1)),On(gn(t),r,null),t}return o=c,(i=[{key:"ConfigurePlayfieldDrawable",value:function(t,r){On(this,e,t),On(this,n,r)}},{key:"p5Setup",value:function(t,e){vn(mn(c.prototype),"p5Setup",this).call(this,t,e),this.State&&On(this,r,t.createGraphics(this.State.GridWidth*this.BlockSize,(this.State.PlayfieldHeight+.1)*this.BlockSize))}},{key:"p5Draw",value:function(t){var o=this;if(vn(mn(c.prototype),"p5Draw",this).call(this,t),null!==this.State){this.SetTransform(t,Sn(this,n).X,Sn(this,n).Y,Sn(this,e).X,Sn(this,e).Y);var i=this.State,a=this.BlockSize;if(Sn(this,r)){var u=Sn(this,r);if(i){u.background(50),u.stroke(0,0,0,100);for(var l=0;l<=i.GridHeight;l++)u.line(0,l*a,i.GridWidth*a,l*a);for(var f=0;f<=i.GridWidth;f++)u.line(f*a,0,f*a,i.GridHeight*a);nn(this)&&(u.noStroke(),this.HardDropAnimations.forEach((function(t){u.fill(on(an(u,t.Data.type),20)),u.rect(t.Data.left*a,t.Data.end*a,(t.Data.right-t.Data.left+1)*a,(i.PlayfieldHeight-t.Data.end)*t.CurrentValue*a)}))),u.stroke(0,0,0,150);var s=null;if(nn(this)){s=[];for(var p=function(t){s.push(t+o.LineClearAnimations.filter((function(e){return e.Data.Y<=t})).reduce((function(t,e){return t+e.CurrentValue}),0))},h=0;h<i.GridHeight;h++)p(h)}for(var y=0;y<i.GridHeight;y++)for(var v=0;v<i.GridWidth;v++){var b,d=null!==(b=i.Get(v,y))&&void 0!==b?b:H.None;d!==H.None&&(u.fill(an(u,d)),u.rect(v*a,P(y)*a,a,a))}if(i.Falling){var w,g,m=i.Falling.Points.map((function(t){return new W(t.X,P(t.Y))}));un(u,null===(w=i.Falling)||void 0===w?void 0:w.Type,new W(0,0),m,a,255);var S=i.Falling.Clone();i.HardDropPiece(S);var O=S.Points.map((function(t){return new W(t.X,P(t.Y))}));un(u,null===(g=i.Falling)||void 0===g?void 0:g.Type,new W(0,0),O,a,50)}nn(this)&&(u.noStroke(),u.fill(255,255,255,100),this.LineClearAnimations.forEach((function(t){u.rect(0,t.Data.OrigY*a,i.GridWidth*a/2*t.CurrentValue,a),u.rect(i.GridWidth*a,t.Data.OrigY*a,-i.GridWidth*a/2*t.CurrentValue,a)}))),i.IsDead&&u.filter(u.GRAY),t.image(u,0,0)}}}function P(t){return null===s?t:s[t]}}}])&&yn(o.prototype,i),a&&yn(o,a),c}(t)}function Rn(t){return(Rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Tn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Cn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _n(t,e,n){return(_n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Dn(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function jn(t,e){return(jn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function En(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Dn(t);if(e){var o=Dn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return xn(this,n)}}function xn(t,e){return!e||"object"!==Rn(e)&&"function"!=typeof e?An(t):e}function An(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Dn(t){return(Dn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Bn(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Hn(t,e,"get"))}function Gn(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Hn(t,e,"set"),n),n}function Hn(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function In(t){var e,n;return e=new WeakMap,n=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&jn(t,e)}(u,t);var r,o,i,a=En(u);function u(){var t;Tn(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=a.call.apply(a,[this].concat(o)),e.set(An(t),{writable:!0,value:void 0}),n.set(An(t),{writable:!0,value:void 0}),Gn(An(t),e,new W(0,0)),Gn(An(t),n,new W(1,1)),t}return r=u,(o=[{key:"ConfigureHoldPieceDrawable",value:function(t,r){Gn(this,e,t),Gn(this,n,r)}},{key:"p5Draw",value:function(t){if(_n(Dn(u.prototype),"p5Draw",this).call(this,t),null!==this.State){this.SetTransform(t,Bn(this,n).X,Bn(this,n).Y,Bn(this,e).X,Bn(this,e).Y);var r=this.State,o=this.BlockSize;if(t.fill(50),t.rect(0,0,5*o,6*o),t.noStroke(),t.fill(255),t.textAlign(t.CENTER),t.textSize(15),cn(t,"HOLD",2.5*o,5*o),t.textAlign(t.LEFT),t.stroke(0),r.Hold){var i=z[r.Hold.Type].Rotations[0].slice(),a=i.map((function(t){return t.X})),c=i.map((function(t){return t.Y})),l=a.max()-a.min()+1,f=c.max()-c.min()+1;un(t,r.Hold.Type,new W((2.5-l/2)*o,(2.5-f/2-c.min())*o),i,o,255)}}}}])&&Cn(r.prototype,o),i&&Cn(r,i),u}(t)}function Mn(t){return(Mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ln(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Fn(t,e,n){return(Fn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Un(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Nn(t,e){return(Nn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Xn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Un(t);if(e){var o=Un(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Yn(this,n)}}function Yn(t,e){return!e||"object"!==Mn(e)&&"function"!=typeof e?zn(t):e}function zn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Un(t){return(Un=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Vn(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Kn(t,e,"get"))}function qn(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Kn(t,e,"set"),n),n}function Kn(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function Qn(t){var e,n;return e=new WeakMap,n=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Nn(t,e)}(u,t);var r,o,i,a=Xn(u);function u(){var t;Wn(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=a.call.apply(a,[this].concat(o)),e.set(zn(t),{writable:!0,value:void 0}),n.set(zn(t),{writable:!0,value:void 0}),qn(zn(t),e,new W(0,0)),qn(zn(t),n,new W(1,1)),t}return r=u,(o=[{key:"ConfigurePieceQueueDrawable",value:function(t,r){qn(this,e,t),qn(this,n,r)}},{key:"p5Draw",value:function(t){if(Fn(Un(u.prototype),"p5Draw",this).call(this,t),null!==this.State){this.SetTransform(t,Vn(this,n).X,Vn(this,n).Y,Vn(this,e).X,Vn(this,e).Y);for(var r=this.State,o=this.BlockSize,i=0,a=r.PieceQueue.length-1;a>=0;a--){var c=z[r.PieceQueue[a]].Rotations[0].slice(),l=c.map((function(t){return t.X})),f=c.map((function(t){return t.Y})),s=f.max()-f.min()+1,p=l.max()-l.min()+1;un(t,r.PieceQueue[a],new W((2-p/2)*o,i-f.min()*o),c,o,255),i+=(s+1)*o}}}}])&&Ln(r.prototype,o),i&&Ln(r,i),u}(t)}function $n(t){return($n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Jn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Zn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function tr(t,e,n){return(tr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ir(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function er(t,e){return(er=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function nr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ir(t);if(e){var o=ir(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return rr(this,n)}}function rr(t,e){return!e||"object"!==$n(e)&&"function"!=typeof e?or(t):e}function or(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ir(t){return(ir=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ar(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,cr(t,e,"get"))}function ur(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,cr(t,e,"set"),n),n}function cr(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function lr(t){var e,n;return e=new WeakMap,n=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&er(t,e)}(u,t);var r,o,i,a=nr(u);function u(){var t;Jn(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=a.call.apply(a,[this].concat(o)),e.set(or(t),{writable:!0,value:void 0}),n.set(or(t),{writable:!0,value:void 0}),ur(or(t),e,new W(0,0)),ur(or(t),n,new W(1,1)),t}return r=u,(o=[{key:"ConfigureFramerateDrawable",value:function(t,r){ur(this,e,t),ur(this,n,r)}},{key:"p5Draw",value:function(t){tr(ir(u.prototype),"p5Draw",this).call(this,t),this.SetTransform(t,ar(this,n).X,ar(this,n).Y,ar(this,e).X,ar(this,e).Y),t.noStroke(),t.fill(0),cn(t,"FPS: ".concat(t.frameRate().toFixed(2)),0,0)}}])&&Zn(r.prototype,o),i&&Zn(r,i),u}(t)}function fr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t.Lock="assets/sfx/sfx_lockdown.wav",t.RotateSuccess="assets/sfx/sfx_rotate.wav",t.RotateFail="assets/sfx/sfx_rotatefail.wav",t.ShiftSuccess="assets/sfx/sfx_move.wav",t.ShiftFail="assets/sfx/sfx_movefail.wav",t.SoftDrop="assets/sfx/sfx_softdrop.wav",t.Hold="assets/sfx/sfx_hold.wav"}(Ye||(Ye={})),function(t){t.Single="assets/sfx/sfx_single.wav",t.Double="assets/sfx/sfx_double.wav",t.Triple="assets/sfx/sfx_triple.wav",t.Tetris="assets/sfx/sfx_tetris.wav",t.TSpin="assets/sfx/sfx_tspin_zero.wav",t.TSpinMini="assets/sfx/sfx_tspin_mini.wav",t.TSpinSingle="assets/sfx/sfx_tspin_single.wav",t.TSpinDouble="assets/sfx/sfx_tspin_double.wav",t.TSpinTriple="assets/sfx/sfx_tspin_triple.wav",t.B2bTSpinMini="assets/sfx/sfx_b2b_tspin_mini.wav",t.B2bTSpinSingle="assets/sfx/sfx_b2b_tspin_single.wav",t.B2bTSpinDouble="assets/sfx/sfx_b2b_tspin_double.wav",t.B2bTSpinTriple="assets/sfx/sfx_b2b_tspin_triple.wav",t.B2bTetris="assets/sfx/sfx_b2b_tetris.wav",t.PerfectClear="assets/sfx/sfx_perfectclear.wav",t.Combo1="assets/sfx/sfx_combo1.wav",t.Combo2="assets/sfx/sfx_combo2.wav",t.Combo3="assets/sfx/sfx_combo3.wav",t.Combo4="assets/sfx/sfx_combo4.wav",t.Combo5="assets/sfx/sfx_combo5.wav",t.Combo6="assets/sfx/sfx_combo6.wav",t.Combo7="assets/sfx/sfx_combo7.wav",t.Combo8="assets/sfx/sfx_combo8.wav",t.Combo9="assets/sfx/sfx_combo9.wav",t.Combo10="assets/sfx/sfx_combo10.wav",t.Combo11="assets/sfx/sfx_combo11.wav",t.Combo12="assets/sfx/sfx_combo12.wav",t.Combo13="assets/sfx/sfx_combo13.wav",t.Combo14="assets/sfx/sfx_combo14.wav",t.Combo15="assets/sfx/sfx_combo15.wav",t.Combo16="assets/sfx/sfx_combo16.wav",t.Combo17="assets/sfx/sfx_combo17.wav",t.Combo18="assets/sfx/sfx_combo18.wav",t.Combo19="assets/sfx/sfx_combo19.wav",t.Combo20="assets/sfx/sfx_combo20.wav",t.GameOver="assets/sfx/sfx_gameover.wav"}(ze||(ze={})),function(t){t.Single="assets/voice/voice_single.wav",t.Double="assets/voice/voice_double.wav",t.Triple="assets/voice/voice_triple.wav",t.Tetris="assets/voice/voice_tetris.wav",t.TSpin="assets/voice/voice_tspin.wav",t.TSpinMini="assets/voice/voice_tspinmini.wav",t.TSpinSingle="assets/voice/voice_tspinsingle.wav",t.TSpinDouble="assets/voice/voice_tspindouble.wav",t.TSpinTriple="assets/voice/voice_tspintriple.wav",t.B2bTSpinMini="assets/voice/voice_b2btspinmini.wav",t.B2bTSpinSingle="assets/voice/voice_b2btspinsingle.wav",t.B2bTSpinDouble="assets/voice/voice_b2btspindouble.wav",t.B2bTSpinTriple="assets/voice/voice_b2btspintriple.wav",t.B2bTetris="assets/voice/voice_b2btetris.wav",t.PerfectClear="assets/voice/voice_perfectclear.wav",t.Combo1="assets/voice/voice_combo01.wav",t.Combo2="assets/voice/voice_combo02.wav",t.Combo3="assets/voice/voice_combo03.wav",t.Combo4="assets/voice/voice_combo04.wav",t.Combo5="assets/voice/voice_combo05.wav"}(Ue||(Ue={}));var sr=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,r;return e=t,(n=[{key:"Tick",value:function(t){return g.None}}])&&fr(e.prototype,n),r&&fr(e,r),t}();function pr(t){return(pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function hr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vr(t,e){return(vr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function br(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=gr(t);if(e){var o=gr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return dr(this,n)}}function dr(t,e){return!e||"object"!==pr(e)&&"function"!=typeof e?wr(t):e}function wr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function gr(t){return(gr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function mr(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Or(t,e,"get"))}function Sr(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Or(t,e,"set"),n),n}function Or(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function Pr(t){return(Pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function kr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Rr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Tr(t,e,n){return(Tr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=xr(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Cr(t,e){return(Cr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _r(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=xr(t);if(e){var o=xr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return jr(this,n)}}function jr(t,e){return!e||"object"!==Pr(e)&&"function"!=typeof e?Er(t):e}function Er(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function xr(t){return(xr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ar(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Br(t,e,"get"))}function Dr(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Br(t,e,"set"),n),n}function Br(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function Gr(t){var e;return e=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Cr(t,e)}(a,t);var n,r,o,i=_r(a);function a(){var t;kr(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=i.call.apply(i,[this].concat(r)),e.set(Er(t),{writable:!0,value:void 0}),Dr(Er(t),e,[]),t}return n=a,(r=[{key:"Tick",value:function(t){var n;return"ConfigureInputDelayable"in this?Tr(xr(a.prototype),"Tick",this).call(this,t):null!==(n=Ar(this,e).shift())&&void 0!==n?n:g.None}},{key:"Update",value:function(t,n){var r;return n&&null!==(r=Ar(this,e).shift())&&void 0!==r?r:g.None}},{key:"Enqueue",value:function(t){Ar(this,e).push(t)}}])&&Rr(n.prototype,r),o&&Rr(n,o),a}(t)}function Hr(t){return(Hr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ir(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Mr(t,e){return(Mr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Wr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Fr(t);if(e){var o=Fr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Lr(this,n)}}function Lr(t,e){return!e||"object"!==Hr(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Fr(t){return(Fr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Nr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Mr(t,e)}(n,t);var e=Wr(n);function n(){return Ir(this,n),e.apply(this,arguments)}return n}(Gr(sr));function Xr(t){return(Xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Yr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function zr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ur(t,e,n){return(Ur="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Qr(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Vr(t,e){return(Vr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function qr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Qr(t);if(e){var o=Qr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Kr(this,n)}}function Kr(t,e){return!e||"object"!==Xr(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Qr(t){return(Qr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $r(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Vr(t,e)}(i,t);var e,n,r,o=qr(i);function i(){var t;Yr(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).keyHold=g.None,t.keyDelay=0,t}return e=i,(n=[{key:"p5Draw",value:function(t){Ur(Qr(i.prototype),"p5Draw",this).call(this,t),this.keyHold!==g.None&&this.Player instanceof Nr&&(this.keyDelay<=0&&(this.Player.Enqueue(this.keyHold),this.keyDelay=3),this.keyDelay--)}},{key:"p5KeyPressed",value:function(t){this.Player instanceof Nr&&(t.keyCode===t.LEFT_ARROW&&(this.keyHold=g.ShiftLeft),t.keyCode===t.RIGHT_ARROW&&(this.keyHold=g.ShiftRight),t.keyCode===t.UP_ARROW&&(this.keyHold=g.RotateCW),t.keyCode===t.CONTROL&&(this.keyHold=g.RotateCCW),t.keyCode===t.DOWN_ARROW&&(this.keyHold=g.SoftDrop),t.keyCode===t.SHIFT&&(this.keyHold=g.Hold)," "===t.key&&(this.keyHold=g.HardDrop),this.Player.Enqueue(this.keyHold),this.keyDelay=10)}},{key:"p5KeyReleased",value:function(t){if(this.Player instanceof Nr){var e=g.None;t.keyCode===t.LEFT_ARROW&&(e=g.ShiftLeft),t.keyCode===t.RIGHT_ARROW&&(e=g.ShiftRight),t.keyCode===t.UP_ARROW&&(e=g.RotateCW),t.keyCode===t.CONTROL&&(e=g.RotateCCW),t.keyCode===t.DOWN_ARROW&&(e=g.SoftDrop),t.keyCode===t.SHIFT&&(e=g.Hold)," "===t.key&&(e=g.HardDrop),this.keyHold===e&&(this.keyHold=g.None)}}},{key:"KeyPressedHandler",get:function(){return this.p5KeyPressed.bind(this)}},{key:"KeyReleasedHandler",get:function(){return this.p5KeyReleased.bind(this)}}])&&zr(e.prototype,n),r&&zr(e,r),i}(t)}function Jr(t){return(Jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Zr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function to(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function eo(t,e){return(eo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function no(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=oo(t);if(e){var o=oo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ro(this,n)}}function ro(t,e){return!e||"object"!==Jr(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function oo(t){return(oo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function io(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&eo(t,e)}(i,t);var e,n,r,o=no(i);function i(){var t;Zr(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).blockSize=b,t}return e=i,(n=[{key:"BlockSize",get:function(){return this.blockSize}},{key:"ConfigureBlockSize",value:function(t){this.blockSize=t}}])&&to(e.prototype,n),r&&to(e,r),i}(t)}var ao=n(766);function uo(t){return(uo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function co(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return lo(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lo(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lo(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function fo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function so(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function po(t,e,n){return(po="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=wo(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function ho(t,e){return(ho=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function yo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=wo(t);if(e){var o=wo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return vo(this,n)}}function vo(t,e){return!e||"object"!==uo(e)&&"function"!=typeof e?bo(t):e}function bo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function wo(t){return(wo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function go(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,So(t,e,"get"))}function mo(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,So(t,e,"set"),n),n}function So(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function Oo(t){var e,n,r;return e=new WeakMap,n=new WeakMap,r=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ho(t,e)}(c,t);var o,i,a,u=yo(c);function c(){var t;fo(this,c);for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return t=u.call.apply(u,[this].concat(i)),e.set(bo(t),{writable:!0,value:void 0}),n.set(bo(t),{writable:!0,value:void 0}),r.set(bo(t),{writable:!0,value:void 0}),mo(bo(t),n,new Map),mo(bo(t),e,null),mo(bo(t),r,.5),t}return o=c,(i=[{key:"ConfigurePlayerSfxPlayable",value:function(t){var o=this;mo(this,r,t),null!==this.Game?null!==this.Player?this.Game.Input.on((function(t){var r;if(t.Player===o.Player){var i=go(o,e);if(mo(o,e,null!=t?t:null),!(i&&t.Tick-i.Tick<=4&&t.Success===i.Success&&t.Input===i.Input)){var a=sn(t);a&&(null===(r=go(o,n).get(a))||void 0===r||r.play())}}})):console.error("ConfigurePlayerSfxPlayable called before this.Player is assigned. Beware of the call order of Configure_ functions."):console.error("ConfigurePlayerSfxPlayable called before this.Game is assigned. Beware of the call order of Configure_ functions.")}},{key:"p5Setup",value:function(t,e){var o=this;po(wo(c.prototype),"p5Setup",this).call(this,t,e),Object.entries(Ye).forEach((function(t){var e=co(t,2)[1];return go(o,n).set(e,new ao.Howl({src:[e],volume:go(o,r)}))}))}}])&&so(o.prototype,i),a&&so(o,a),c}(t)}function Po(t){return(Po="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ko(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Ro(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ro(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ro(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function To(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Co(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _o(t,e,n){return(_o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Do(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function jo(t,e){return(jo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Eo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Do(t);if(e){var o=Do(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return xo(this,n)}}function xo(t,e){return!e||"object"!==Po(e)&&"function"!=typeof e?Ao(t):e}function Ao(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Do(t){return(Do=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Bo(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Ho(t,e,"get"))}function Go(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Ho(t,e,"set"),n),n}function Ho(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function Io(t){var e,n;return e=new WeakMap,n=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&jo(t,e)}(u,t);var r,o,i,a=Eo(u);function u(){var t;To(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=a.call.apply(a,[this].concat(o)),e.set(Ao(t),{writable:!0,value:void 0}),n.set(Ao(t),{writable:!0,value:void 0}),Go(Ao(t),e,new Map),Go(Ao(t),n,.5),t}return r=u,(o=[{key:"ConfigureGameEventSfxPlayable",value:function(t){var r=this;Go(this,n,t),null!==this.State?(this.State.Achievement.on((function(t){console.log(t);var n=sn(t);n&&n.forEach((function(t){var n;return null===(n=Bo(r,e).get(t))||void 0===n?void 0:n.play()}))})),this.State.Dead.on((function(){var t;null===(t=Bo(r,e).get(ze.GameOver))||void 0===t||t.play()}))):console.error("ConfigureGameEventSfxPlayable called before this.State is assigned. Beware of the call order of Configure_ functions.")}},{key:"p5Setup",value:function(t,r){var o=this;_o(Do(u.prototype),"p5Setup",this).call(this,t,r),Object.entries(ze).forEach((function(t){var r=ko(t,2)[1];return Bo(o,e).set(r,new ao.Howl({src:[r],volume:Bo(o,n)}))}))}}])&&Co(r.prototype,o),i&&Co(r,i),u}(t)}function Mo(t){return(Mo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Lo(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Lo(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Lo(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Fo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function No(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Xo(t,e,n){return(Xo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=qo(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Yo(t,e){return(Yo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function zo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=qo(t);if(e){var o=qo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Uo(this,n)}}function Uo(t,e){return!e||"object"!==Mo(e)&&"function"!=typeof e?Vo(t):e}function Vo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function qo(t){return(qo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ko(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,$o(t,e,"get"))}function Qo(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,$o(t,e,"set"),n),n}function $o(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function Jo(t){var e,n;return e=new WeakMap,n=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Yo(t,e)}(u,t);var r,o,i,a=zo(u);function u(){var t;Fo(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=a.call.apply(a,[this].concat(o)),e.set(Vo(t),{writable:!0,value:void 0}),n.set(Vo(t),{writable:!0,value:void 0}),Qo(Vo(t),e,new Map),Qo(Vo(t),n,.5),t}return r=u,(o=[{key:"ConfigureGameEventVoicePlayable",value:function(t){var r=this;Qo(this,n,t),null!==this.State?this.State.Achievement.on((function(t){var n,o=function(t){if(t.Type===ct.PerfectClear)return Ue.PerfectClear;var e="";if(t.BackToBack&&(e+="B2b"),t.Type===ct.TSpinMini?e+="TSpinMini":(t.Type===ct.TSpin&&(e+="TSpin"),1===t.LinesCleared.length?e+="Single":2===t.LinesCleared.length?e+="Double":3===t.LinesCleared.length?e+="Triple":4===t.LinesCleared.length&&(e+="Tetris")),fn(e)&&"Single"!==e)return Ue[e];if(e.startsWith("B2b")&&fn(e=e.substr(3)))return Ue[e];if(t.Combo>0){var n="Combo".concat(Math.min(5,t.Combo));if(fn(n))return Ue[n]}return null}(t);o&&(null===(n=Ko(r,e).get(o))||void 0===n||n.play())})):console.error("ConfigureGameEventVoicePlayable called before this.State is assigned. Beware of the call order of Configure_ functions.")}},{key:"p5Setup",value:function(t,r){var o=this;Xo(qo(u.prototype),"p5Setup",this).call(this,t,r),Object.entries(Ue).forEach((function(t){var r=Wo(t,2)[1];return Ko(o,e).set(r,new ao.Howl({src:[r],volume:Ko(o,n)}))}))}}])&&No(r.prototype,o),i&&No(r,i),u}(t)}function Zo(t){return(Zo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ti(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return ei(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ei(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ei(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ni(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ri(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function oi(t,e,n){return(oi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=li(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function ii(t,e){return(ii=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ai(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=li(t);if(e){var o=li(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ui(this,n)}}function ui(t,e){return!e||"object"!==Zo(e)&&"function"!=typeof e?ci(t):e}function ci(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function li(t){return(li=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function fi(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,pi(t,e,"get"))}function si(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,pi(t,e,"set"),n),n}function pi(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function hi(t){var e,n;return e=new WeakMap,n=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ii(t,e)}(u,t);var r,o,i,a=ai(u);function u(){var t;ni(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=a.call.apply(a,[this].concat(o)),e.set(ci(t),{writable:!0,value:void 0}),n.set(ci(t),{writable:!0,value:void 0}),t.GameEventAnimation=null,si(ci(t),e,new W(0,0)),si(ci(t),n,new W(1,1)),t}return r=u,(o=[{key:"ConfigureGameEventTextDrawable",value:function(t,r){var o=this;si(this,e,t),si(this,n,r),null!==this.State?this.State.Achievement.on((function(t){var e=ti(t.toString(),2),n=e[0],r=e[1];o.GameEventAnimation=new Ve(0,1,100*t.Rating,{subtitle:n,title:r,rating:t.Rating},0,Ve.RevertingFunction())})):console.error("ConfigureGameEventTextDrawable called before this.State is assigned. Beware of the call order of Configure_ functions.")}},{key:"p5Draw",value:function(t){oi(li(u.prototype),"p5Draw",this).call(this,t),this.SetTransform(t,fi(this,n).X,fi(this,n).Y,fi(this,e).X,fi(this,e).Y);var r=this.GameEventAnimation;r&&(r.Tick(),r.Finished&&(this.GameEventAnimation=null),t.textAlign(t.CENTER,t.BOTTOM),t.fill(255,255,255,255*r.CurrentValue),t.noStroke(),t.textSize(15*r.Data.rating*.8),cn(t,r.Data.subtitle,0,15*r.Data.rating),t.textSize(15*r.Data.rating),cn(t,r.Data.title,0,0))}}])&&ri(r.prototype,o),i&&ri(r,i),u}(t)}function yi(t){return(yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function bi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function di(t,e,n){return(di="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Oi(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function wi(t,e){return(wi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function gi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Oi(t);if(e){var o=Oi(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return mi(this,n)}}function mi(t,e){return!e||"object"!==yi(e)&&"function"!=typeof e?Si(t):e}function Si(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Oi(t){return(Oi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Pi(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Ri(t,e,"get"))}function ki(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Ri(t,e,"set"),n),n}function Ri(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function Ti(t){var e,n;return e=new WeakMap,n=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&wi(t,e)}(u,t);var r,o,i,a=gi(u);function u(){var t;vi(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=a.call.apply(a,[this].concat(o)),e.set(Si(t),{writable:!0,value:void 0}),n.set(Si(t),{writable:!0,value:void 0}),ki(Si(t),e,new W(0,0)),ki(Si(t),n,new W(1,1)),t}return r=u,(o=[{key:"ConfigureGarbageMeterDrawable",value:function(t,r){ki(this,e,t),ki(this,n,r)}},{key:"p5Draw",value:function(t){if(di(Oi(u.prototype),"p5Draw",this).call(this,t),null!==this.State){this.SetTransform(t,Pi(this,n).X,Pi(this,n).Y,Pi(this,e).X,Pi(this,e).Y);var r=this.State,o=this.BlockSize;t.fill(50),t.rect(0,0,o,o*r.PlayfieldHeight),t.fill(an(t,H.Garbage));for(var i=r.GarbageMeter.reduce((function(t,e){return t+e.Lines}),0),a=0;a<i;a++)t.rect(0,a*o,o,o)}}}])&&bi(r.prototype,o),i&&bi(r,i),u}(t)}function Ci(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var _i=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e&&n?(this.width=e,this.height=n):(this.width=440,this.height=502)}var e,n,r;return e=t,(n=[{key:"SetTransform",value:function(t,e,n,r,o){this.ResetTransform(t),t.translate(r,o),t.scale(e,n)}},{key:"ResetTransform",value:function(t){t.resetMatrix(),t.scale(1,-1),t.translate(0,-this.height),t.scale(1,1)}},{key:"p5Setup",value:function(t,e){t.createCanvas(this.width,this.height).parent(e),t.frameRate(60),this.ResetTransform(t)}},{key:"p5Draw",value:function(t){t.background(100)}},{key:"DrawHandler",get:function(){return this.p5Draw.bind(this)}},{key:"SetupHandler",get:function(){return this.p5Setup.bind(this)}}])&&Ci(e.prototype,n),r&&Ci(e,r),t}();function ji(t){return(ji="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ei(t,e){return(Ei=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function xi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Di(t);if(e){var o=Di(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ai(this,n)}}function Ai(t,e){return!e||"object"!==ji(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Di(t){return(Di=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Bi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ei(t,e)}(n,t);var e=xi(n);function n(t,r,o,i){var a,u,c;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(c=o&&i?e.call(this,o,i):e.call(this)).ConfigureGameState(r.State),c.ConfigurePlayer(r.Player),c.ConfigureGame(t),c.ConfigureBlockSize(b),c.ConfigurePlayfieldAnimatable(),c.ConfigurePlayerSfxPlayable(d),c.ConfigureGameEventSfxPlayable(d),c.ConfigureGameEventVoicePlayable(d),c.ConfigureGameEventTextDrawable(new W(11*c.BlockSize,c.BlockSize*((null!==(a=null===(u=c.State)||void 0===u?void 0:u.PlayfieldHeight)&&void 0!==a?a:v)+1)),new W(1,1)),c.ConfigurePlayfieldDrawable(new W(6*c.BlockSize,0),new W(1,1)),c.ConfigureHoldPieceDrawable(new W(10,200),new W(1,1)),c.ConfigurePieceQueueDrawable(new W(18*c.BlockSize,100),new W(.7,.7)),c.ConfigureGarbageMeterDrawable(new W(16.5*c.BlockSize,0),new W(1,1)),c.ConfigureFramerateDrawable(new W(0,c.height-10),new W(1,1)),Ai(c)}return n}(lr(Ti(Qn(In(kn(hi(Io(Jo(Oo(rn(io($r(Fe(De(Re(_i))))))))))))))));function Gi(t){return(Gi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Hi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ii(t,e){return(Ii=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Mi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Li(t);if(e){var o=Li(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Wi(this,n)}}function Wi(t,e){return!e||"object"!==Gi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Li(t){return(Li=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Fi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ii(t,e)}(i,t);var e,n,r,o=Mi(i);function i(t,e,n,r){var a,u,c;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(c=n&&r?o.call(this,n,r):o.call(this,220,251)).ConfigureGameState(e.State),c.ConfigurePlayer(e.Player),c.ConfigureGame(t),c.ConfigureBlockSize(b),c.ConfigurePlayfieldAnimatable(),c.ConfigurePlayerSfxPlayable(0),c.ConfigureGameEventSfxPlayable(.025),c.ConfigureGameEventVoicePlayable(.025),c.ConfigureGameEventTextDrawable(new W(11*c.BlockSize,c.BlockSize*((null!==(a=null===(u=c.State)||void 0===u?void 0:u.PlayfieldHeight)&&void 0!==a?a:v)+1)),new W(1,1)),c.ConfigurePlayfieldDrawable(new W(6*c.BlockSize,0),new W(1,1)),c.ConfigureHoldPieceDrawable(new W(10,200),new W(1,1)),c.ConfigurePieceQueueDrawable(new W(18*c.BlockSize,100),new W(.7,.7)),c.ConfigureGarbageMeterDrawable(new W(16.5*c.BlockSize,0),new W(1,1)),c.ConfigureFramerateDrawable(new W(0,c.height-10),new W(1,1)),Wi(c)}return e=i,(n=[{key:"ResetTransform",value:function(t){t.resetMatrix(),t.scale(1,-1),t.translate(0,-this.height),t.scale(.5,.5)}}])&&Hi(e.prototype,n),r&&Hi(e,r),i}(lr(Ti(Qn(In(kn(hi(Io(Jo(Oo(rn(io(Fe(De(Re(_i)))))))))))))));function Ni(t){return(Ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Yi(t,e){return(Yi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function zi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Vi(t);if(e){var o=Vi(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ui(this,n)}}function Ui(t,e){return!e||"object"!==Ni(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Vi(t){return(Vi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var qi,Ki,Qi,$i=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Yi(t,e)}(i,t);var e,n,r,o=zi(i);function i(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this)).ConfigureInputDelayable(5),t}return e=i,(n=[{key:"Update",value:function(t,e){return g.None}}])&&Xi(e.prototype,n),r&&Xi(e,r),i}((qi=sr,Ki=new WeakMap,Qi=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&vr(t,e)}(i,t);var e,n,r,o=br(i);function i(){var t;hr(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),Ki.set(wr(t),{writable:!0,value:void 0}),Qi.set(wr(t),{writable:!0,value:void 0}),Sr(wr(t),Ki,0),Sr(wr(t),Qi,5),t}return e=i,(n=[{key:"Tick",value:function(t){var e=t.TicksElapsed-mr(this,Ki)>=mr(this,Qi),n=this.Update(t,e);return e?(n!==g.None&&Sr(this,Ki,t.TicksElapsed),n):g.None}},{key:"ConfigureInputDelayable",value:function(t){Sr(this,Qi,t)}},{key:"Update",value:function(t,e){return g.None}}])&&yr(e.prototype,n),r&&yr(e,r),i}(qi)));function Ji(t){return(Ji="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Zi(t){return function(t){if(Array.isArray(t))return ta(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return ta(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ta(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ta(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ea(t,e,n){return(ea="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=aa(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function na(t,e){return(na=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ra(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=aa(t);if(e){var o=aa(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return oa(this,n)}}function oa(t,e){return!e||"object"!==Ji(e)&&"function"!=typeof e?ia(t):e}function ia(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function aa(t){return(aa=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ua(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,la(t,e,"get"))}function ca(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,la(t,e,"set"),n),n}function la(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function fa(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function sa(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function pa(t,e,n){return e&&sa(t.prototype,e),n&&sa(t,n),t}var ha=function(){function t(e){var n=this;fa(this,t),this.Map=[];for(var r=function(t){var r=e.Grid.map((function(e){return e[t]}));r[-1]=H.I;for(var o=r.length-1;r[o]===H.None;)o--;n.Map.push(o+1)},o=0;o<e.GridWidth;o++)r(o)}return pa(t,[{key:"FindPattern",value:function(){for(var t=[],e=0;e<this.Map.length-arguments.length+1;e++){for(var n=!0,r=0;r<arguments.length-1;r++)this.Map[e+r+1]-this.Map[e+r]!=(r+1<0||arguments.length<=r+1?void 0:arguments[r+1])-(r<0||arguments.length<=r?void 0:arguments[r])&&(n=!1);n&&t.push(e)}return t}}]),t}(),ya=new WeakMap,va=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&na(t,e)}(n,t);var e=ra(n);function n(){var t;return fa(this,n),t=e.call(this),ya.set(ia(t),{writable:!0,value:void 0}),ca(ia(t),ya,null),t}return pa(n,[{key:"Update",value:function(t,e){var r=t.Falling;if(null===r&&ca(this,ya,null),null===ua(this,ya)&&null!==r||null!==ua(this,ya)&&null!==r&&ua(this,ya).PieceIndex!==r.PieceIndex){ca(this,ya,r);for(var o=new ha(t),i=Math.floor(Math.random()*t.GridWidth),a=Math.floor(4*Math.random()),u=[],c=new Tt(t),l=0;l<z[r.Type].Rotations.length;l++)for(var f=z[r.Type].Rotations[l].map((function(t){return t.X})).min(),s=-f;s<t.GridWidth-f;s++){var p=r.Clone();p.Position.X=s,p.Rotation=l,c.HardDropPiece(p),u.push({rot:l,col:s,top:p.Top,isMatch:!1})}z[r.Type].Rotations.flatMap((function(t,e){return o.FindPattern.apply(o,Zi(function(t){for(var e=t.map((function(t){return t.X})).min(),n=t.map((function(t){return t.X})).max(),r=[],o=function(e){r.push(t.filter((function(t){return t.X===e})).map((function(t){return t.Y})).min())},i=e;i<=n;i++)o(i);return r}(t.slice()))).forEach((function(t){var n=u.find((function(n){return n.rot===e&&n.col===t-z[r.Type].Rotations[e].map((function(t){return t.X})).min()}));n&&(n.isMatch=!0)}))}));var h=u.filter((function(t){return!0===t.isMatch}));if(0!==h.length||t.BlockHold){var y;a=(y=h.length>0?h.minBy((function(t){return t.top})):u.minBy((function(t){return t.top}))).rot,i=y.col;for(var v=0;v<a;v++)this.Enqueue(g.RotateCW);if(i>r.Position.X)for(var b=0;b<i-r.Position.X;b++)this.Enqueue(g.ShiftRight);else if(i<r.Position.X)for(var d=0;d<r.Position.X-i;d++)this.Enqueue(g.ShiftLeft);this.Enqueue(g.HardDrop)}else this.Enqueue(g.Hold)}return ea(aa(n.prototype),"Update",this).call(this,t,e)}}]),n}(Gr($i));function ba(t){return(ba="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function da(t,e,n){return(da="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Oa(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function wa(t,e){return(wa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ga(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Oa(t);if(e){var o=Oa(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ma(this,n)}}function ma(t,e){return!e||"object"!==ba(e)&&"function"!=typeof e?Sa(t):e}function Sa(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Oa(t){return(Oa=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Pa(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ka(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ra(t,e,n){return e&&ka(t.prototype,e),n&&ka(t,n),t}function Ta(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,_a(t,e,"get"))}function Ca(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,_a(t,e,"set"),n),n}function _a(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var ja=new WeakMap,Ea=function(){function t(e,n){Pa(this,t),ja.set(this,{writable:!0,value:void 0}),this.rot=e,this.col=n,this.pieceTop=0,this.globalTop=0,this.enclosedHoles=0,this.openHoles=0,this.blocksAboveHoles=0,this.iWells=0,Ca(this,ja,null)}return Ra(t,[{key:"Rating",get:function(){if(Ta(this,ja))return Ta(this,ja);var t=0;return t-=this.pieceTop,Ca(this,ja,t),t}}]),t}(),xa=new WeakMap,Aa=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&wa(t,e)}(n,t);var e=ga(n);function n(){var t;return Pa(this,n),t=e.call(this),xa.set(Sa(t),{writable:!0,value:void 0}),Ca(Sa(t),xa,null),t}return Ra(n,[{key:"getChoice",value:function(t,e){for(var n=[],r=0;r<z[e.Type].Rotations.length;r++)for(var o=z[e.Type].Rotations[r].map((function(t){return t.X})).min(),i=z[e.Type].Rotations[r].map((function(t){return t.X})).max(),a=-o;a<t.GridWidth-i;a++){var u=new Ea(r,a),c=new Tt(t);if(e){var l=e.Clone();c.Falling=l,l.Position.X=a,l.Rotation=r,c.HardDropPiece(),u.pieceTop=l.Top;for(var f=c.GridHeight-1;f>=0&&!c.Grid[f].some((function(t){return t!==H.None}));)f--;u.globalTop=f,n.push(u)}}return n.sort((function(t,e){return e.Rating-t.Rating})),n[0]}},{key:"Update",value:function(t,e){var r=t.Falling;if(null===r&&Ca(this,xa,null),null===Ta(this,xa)&&null!==r||null!==Ta(this,xa)&&null!==r&&Ta(this,xa).PieceIndex!==r.PieceIndex){Ca(this,xa,r);var o=this.getChoice(t,r);if((t.Hold&&t.Hold.Type!==H.None?this.getChoice(t,new lt(t.Hold.Type)):this.getChoice(t,new lt(t.PieceQueue[0]))).Rating>o.Rating)this.Enqueue(g.Hold);else{for(var i=o.col,a=o.rot,u=0;u<a;u++)this.Enqueue(g.RotateCW);if(i>r.Position.X)for(var c=0;c<i-r.Position.X;c++)this.Enqueue(g.ShiftRight);else if(i<r.Position.X)for(var l=0;l<r.Position.X-i;l++)this.Enqueue(g.ShiftLeft);this.Enqueue(g.HardDrop)}}return da(Oa(n.prototype),"Update",this).call(this,t,e)}}]),n}(Gr($i));function Da(t){return function(t){if(Array.isArray(t))return Ha(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Ga(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ba(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||Ga(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ga(t,e){if(t){if("string"==typeof t)return Ha(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ha(t,e):void 0}}function Ha(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}const Ia=function(t){var e=Ba((0,r.useState)(),2)[1],n=Ba((0,r.useState)(),2)[1],o=Ba((0,r.useState)(),2),i=o[0],a=o[1];return(0,r.useEffect)((function(){for(var t=new Aa,r=[],o=0;o<3;o++)r.push(new va);var i=new de([{player:t}].concat(Da(r.map((function(t){return{player:t}}))))),u=new Bi(i,i.Participants[0]),c=[];return i.Participants.slice(1).forEach((function(t){return c.push(new Fi(i,t))})),e([t].concat(r)),n(i),a([u].concat(c)),setTimeout((function(){return i.StartClock()}),1e3),function(){i.StopClock()}}),[]),r.createElement("div",{className:"min-h-screen w-screen flex justify-center items-center flex-wrap"},null==i?void 0:i.map((function(t,e){return r.createElement(p(),{key:e,setup:t.SetupHandler,draw:t.DrawHandler,keyPressed:t instanceof Bi?t.KeyPressedHandler:void 0,keyReleased:t instanceof Bi?t.KeyReleasedHandler:void 0})})))};function Ma(t){return(Ma="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wa(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function La(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Fa(t,e){return(Fa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Na(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=za(t);if(e){var o=za(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Xa(this,n)}}function Xa(t,e){return!e||"object"!==Ma(e)&&"function"!=typeof e?Ya(t):e}function Ya(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function za(t){return(za=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ua(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,qa(t,e,"get"))}function Va(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,qa(t,e,"set"),n),n}function qa(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var Ka=new WeakMap,Qa=new WeakMap,$a=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Fa(t,e)}(i,t);var e,n,r,o=Na(i);function i(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return Wa(this,i),e=o.call(this),Ka.set(Ya(e),{writable:!0,value:void 0}),Qa.set(Ya(e),{writable:!0,value:void 0}),Va(Ya(e),Ka,null),e.Player=t,e.State=n instanceof Tt?n:new Tt(n),Va(Ya(e),Qa,new V),e}return e=i,(n=[{key:"Input",get:function(){return Ua(this,Qa)}},{key:"ClockRunning",get:function(){return null!==Ua(this,Ka)}},{key:"StartClock",value:function(){Va(this,Ka,window.setInterval(this.Tick.bind(this),1e3/60))}},{key:"StopClock",value:function(){null!==Ua(this,Ka)&&window.clearInterval(Ua(this,Ka))}},{key:"Tick",value:function(){if(!this.State.IsDead){this.State.Tick();var t=this.Player.Tick(this.State.GetVisibleState()),e=this.State.Falling,n=!1;switch(t){case g.None:break;case g.HardDrop:n=this.State.HardDropPiece();break;case g.Hold:n=this.State.HoldPiece();break;case g.RotateCW:n=this.State.RotatePiece(M.CW);break;case g.RotateCCW:n=this.State.RotatePiece(M.CCW);break;case g.ShiftLeft:n=this.State.ShiftPiece(-1);break;case g.ShiftRight:n=this.State.ShiftPiece(1);break;case g.SoftDrop:n=this.State.SoftDropPiece(!1)}t!==g.None&&Ua(this,Qa).emit(new S(this.State.TicksElapsed,t,n,e,this.Player))}}}])&&La(e.prototype,n),r&&La(e,r),i}(Jt);function Ja(t){return(Ja="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Za(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tu(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function eu(t,e){return(eu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function nu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ou(t);if(e){var o=ou(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ru(this,n)}}function ru(t,e){return!e||"object"!==Ja(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ou(t){return(ou=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function iu(t){return(iu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function au(t,e){return(au=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function uu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=lu(t);if(e){var o=lu(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return cu(this,n)}}function cu(t,e){return!e||"object"!==iu(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function lu(t){return(lu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var fu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&au(t,e)}(n,t);var e=uu(n);function n(t,r,o){var i,a,u;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(u=r&&o?e.call(this,r,o):e.call(this)).ConfigureGameState(t.State),u.ConfigurePlayer(t.Player),u.ConfigureGame(t),u.ConfigureBlockSize(b),u.ConfigurePlayfieldAnimatable(),u.ConfigurePlayerSfxPlayable(d),u.ConfigureGameEventSfxPlayable(d),u.ConfigureGameEventVoicePlayable(d),u.ConfigureGameEventTextDrawable(new W(11*u.BlockSize,u.BlockSize*((null!==(i=null===(a=u.State)||void 0===a?void 0:a.PlayfieldHeight)&&void 0!==i?i:v)+1)),new W(1,1)),u.ConfigurePlayfieldDrawable(new W(6*u.BlockSize,0),new W(1,1)),u.ConfigureHoldPieceDrawable(new W(10,200),new W(1,1)),u.ConfigurePieceQueueDrawable(new W(17*u.BlockSize,100),new W(.7,.7)),u.ConfigureFramerateDrawable(new W(0,u.height-10),new W(1,1)),cu(u)}return n}(lr(Qn(In(kn(hi(Io(Jo(Oo(rn(io($r(Fe(De(function(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&eu(t,e)}(i,t);var e,n,r,o=nu(i);function i(){var t;Za(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).State=null,t}return e=i,(n=[{key:"ConfigureGameState",value:function(t){this.State=t}}])&&tu(e.prototype,n),r&&tu(e,r),i}(t)}(_i)))))))))))))));function su(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return pu(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pu(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pu(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}const hu=function(t){var e=su((0,r.useState)(),2)[1],n=su((0,r.useState)(),2)[1],o=su((0,r.useState)(),2),i=o[0],a=o[1];return(0,r.useEffect)((function(){var t=new Nr,r=new $a(t),o=new fu(r);return e(t),n(r),a(o),setTimeout((function(){return r.StartClock()}),1e3),function(){r.StopClock()}}),[]),i?r.createElement("div",{className:"min-h-screen w-screen flex justify-center items-center"},r.createElement(p(),{setup:i.SetupHandler,draw:i.DrawHandler,keyPressed:i.KeyPressedHandler,keyReleased:i.KeyReleasedHandler})):r.createElement("p",null,"Loading")};const yu=function(){return r.createElement(i.UT,null,r.createElement(a.rs,null,r.createElement(a.AW,{exact:!0,path:"/",component:l}),r.createElement(a.AW,{exact:!0,path:"/test",component:hu}),r.createElement(a.AW,{exact:!0,path:"/multi/local",component:Ia}),r.createElement(a.AW,{component:u})))};o.render(r.createElement(yu,null),document.getElementById("app"))}},t=>{"use strict";var e;e=795,t(t.s=e)}]);