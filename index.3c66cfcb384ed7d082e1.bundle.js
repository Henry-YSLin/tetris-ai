(self.webpackChunktetris_ai=self.webpackChunktetris_ai||[]).push([[826],{603:(t,e,n)=>{"use strict";var r=n(294),o=n(935),i=n(727),a=n(977);const u=function(t){return r.createElement("p",null,"Not found")};const c=function(){return r.createElement("div",{className:"flex flex-col justify-center items-center select-none min-h-screen bg-gradient-to-br from-gray-900  to-blue-700"},r.createElement("h1",{className:"text-6xl text-green-500 border-b-4 pb-4"},"Hello World !"),r.createElement("h2",{className:"text-2xl text-gray-300 mt-10"},"Click"," ",r.createElement(i.rU,{to:"/test",className:"text-green-400 underline"},"here")," ","to play pre-alpha Tetris",r.createElement("br",null),r.createElement(i.rU,{to:"/multi/local",className:"text-green-400 underline"},"Local Multi")))};const l=function(t){return r.createElement(c,null)};var f,s=n(210),p=n.n(s);function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t[t.None=0]="None",t[t.SoftDrop=1]="SoftDrop",t[t.HardDrop=2]="HardDrop",t[t.Hold=3]="Hold",t[t.ShiftLeft=4]="ShiftLeft",t[t.ShiftRight=5]="ShiftRight",t[t.RotateCW=6]="RotateCW",t[t.RotateCCW=7]="RotateCCW"}(f||(f={}));const y=f;function v(t){return t===f.RotateCCW||t===f.RotateCW}var b=function(){function t(e,n,r,o,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.Tick=e,this.Input=n,this.Success=r,this.Falling=o,this.Player=i}var e,n,r;return e=t,(n=[{key:"Clone",value:function(){return new t(this.Tick,this.Input,this.Success,this.Falling,this.Player)}}])&&h(e.prototype,n),r&&h(e,r),t}();function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var w=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,r;return e=t,(n=[{key:"Tick",value:function(t){return y.None}}])&&d(e.prototype,n),r&&d(e,r),t}(),g=10,m=40,S=20,P=20,O=.5;function k(t){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function R(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function C(t,e){return(C=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=x(t);if(e){var o=x(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return j(this,n)}}function j(t,e){return!e||"object"!==k(e)&&"function"!=typeof e?E(t):e}function E(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function x(t){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function A(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,B(t,e,"get"))}function D(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,B(t,e,"set"),n),n}function B(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function G(t){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function I(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function H(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function W(t,e,n){return(W="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Y(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function M(t,e){return(M=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function L(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Y(t);if(e){var o=Y(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return F(this,n)}}function F(t,e){return!e||"object"!==G(e)&&"function"!=typeof e?N(t):e}function N(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Y(t){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function X(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,V(t,e,"get"))}function z(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,V(t,e,"set"),n),n}function V(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function U(t){var e;return e=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&M(t,e)}(a,t);var n,r,o,i=L(a);function a(){var t;I(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t=i.call.apply(i,[this].concat(r)),e.set(N(t),{writable:!0,value:void 0}),z(N(t),e,[]),t}return n=a,(r=[{key:"Tick",value:function(t){var n;return"ConfigureInputDelayable"in this?W(Y(a.prototype),"Tick",this).call(this,t):null!==(n=X(this,e).shift())&&void 0!==n?n:y.None}},{key:"Update",value:function(t,n){var r;return n&&null!==(r=X(this,e).shift())&&void 0!==r?r:y.None}},{key:"Enqueue",value:function(t){X(this,e).push(t)}}])&&H(n.prototype,r),o&&H(n,o),a}(t)}function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Q(t,e){return(Q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function $(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Z(t);if(e){var o=Z(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return J(this,n)}}function J(t,e){return!e||"object"!==K(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Z(t){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var tt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Q(t,e)}(n,t);var e=$(n);function n(){return q(this,n),e.apply(this,arguments)}return n}(U(w));function et(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var nt,rt,ot,it,at,ut,ct,lt,ft,st,pt,ht,yt,vt,bt,dt,wt=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.X=e,this.Y=n}var e,n,r;return e=t,(n=[{key:"Add",value:function(e){return new t(this.X+e.X,this.Y+e.Y)}},{key:"Subtract",value:function(e){return new t(this.X-e.X,this.Y-e.Y)}},{key:"Clone",value:function(){return new t(this.X,this.Y)}}])&&et(e.prototype,n),r&&et(e,r),t}();function gt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t[t.None=0]="None",t[t.I=1]="I",t[t.J=2]="J",t[t.L=3]="L",t[t.O=4]="O",t[t.S=5]="S",t[t.T=6]="T",t[t.Z=7]="Z",t[t.Garbage=8]="Garbage"}(vt||(vt={})),function(t){t[t.R0=0]="R0",t[t.R90=1]="R90",t[t.R180=2]="R180",t[t.R270=3]="R270"}(bt||(bt={})),function(t){t[t.CW=1]="CW",t[t.CCW=-1]="CCW"}(dt||(dt={}));var mt=Object.freeze([(nt={},gt(nt,-1,[new wt(0,0),new wt(1,0),new wt(1,1),new wt(0,-2),new wt(1,-2)]),gt(nt,1,[new wt(0,0),new wt(-1,0),new wt(-1,1),new wt(0,-2),new wt(-1,-2)]),nt),(rt={},gt(rt,-1,[new wt(0,0),new wt(1,0),new wt(1,-1),new wt(0,2),new wt(1,2)]),gt(rt,1,[new wt(0,0),new wt(1,0),new wt(1,-1),new wt(0,2),new wt(1,2)]),rt),(ot={},gt(ot,-1,[new wt(0,0),new wt(-1,0),new wt(-1,1),new wt(0,-2),new wt(-1,-2)]),gt(ot,1,[new wt(0,0),new wt(1,0),new wt(1,1),new wt(0,-2),new wt(1,-2)]),ot),(it={},gt(it,-1,[new wt(0,0),new wt(-1,0),new wt(-1,-1),new wt(0,2),new wt(-1,2)]),gt(it,1,[new wt(0,0),new wt(-1,0),new wt(-1,-1),new wt(0,2),new wt(-1,2)]),it)]),St=Object.freeze([(at={},gt(at,-1,[new wt(0,0),new wt(-1,0),new wt(2,0),new wt(-1,2),new wt(2,-1)]),gt(at,1,[new wt(0,0),new wt(-2,0),new wt(1,0),new wt(-2,-1),new wt(1,2)]),at),(ut={},gt(ut,-1,[new wt(0,0),new wt(2,0),new wt(-1,0),new wt(2,1),new wt(-1,-2)]),gt(ut,1,[new wt(0,0),new wt(-1,0),new wt(2,0),new wt(-1,2),new wt(2,-1)]),ut),(ct={},gt(ct,-1,[new wt(0,0),new wt(1,0),new wt(-2,0),new wt(1,-2),new wt(-2,1)]),gt(ct,1,[new wt(0,0),new wt(2,0),new wt(-1,0),new wt(2,1),new wt(-1,-2)]),ct),(lt={},gt(lt,-1,[new wt(0,0),new wt(-2,0),new wt(1,0),new wt(-2,-1),new wt(1,2)]),gt(lt,1,[new wt(0,0),new wt(1,0),new wt(-2,0),new wt(1,-2),new wt(-2,1)]),lt)]),Pt=Object.freeze([(ft={},gt(ft,-1,[new wt(0,0)]),gt(ft,1,[new wt(0,0)]),ft),(st={},gt(st,-1,[new wt(0,0)]),gt(st,1,[new wt(0,0)]),st),(pt={},gt(pt,-1,[new wt(0,0)]),gt(pt,1,[new wt(0,0)]),pt),(ht={},gt(ht,-1,[new wt(0,0)]),gt(ht,1,[new wt(0,0)]),ht)]),Ot=Object.freeze((gt(yt={},vt.None,{Rotations:[[]],WallKick:Pt}),gt(yt,vt.I,{Rotations:[[new wt(0,2),new wt(1,2),new wt(2,2),new wt(3,2)],[new wt(2,0),new wt(2,1),new wt(2,2),new wt(2,3)],[new wt(0,1),new wt(1,1),new wt(2,1),new wt(3,1)],[new wt(1,0),new wt(1,1),new wt(1,2),new wt(1,3)]],WallKick:St}),gt(yt,vt.J,{Rotations:[[new wt(0,2),new wt(0,1),new wt(1,1),new wt(2,1)],[new wt(2,2),new wt(1,2),new wt(1,1),new wt(1,0)],[new wt(0,1),new wt(1,1),new wt(2,1),new wt(2,0)],[new wt(0,0),new wt(1,0),new wt(1,1),new wt(1,2)]],WallKick:mt}),gt(yt,vt.L,{Rotations:[[new wt(0,1),new wt(1,1),new wt(2,1),new wt(2,2)],[new wt(1,2),new wt(1,1),new wt(1,0),new wt(2,0)],[new wt(0,0),new wt(0,1),new wt(1,1),new wt(2,1)],[new wt(0,2),new wt(1,2),new wt(1,1),new wt(1,0)]],WallKick:mt}),gt(yt,vt.O,{Rotations:[[new wt(0,0),new wt(0,1),new wt(1,0),new wt(1,1)]],WallKick:Pt}),gt(yt,vt.S,{Rotations:[[new wt(0,1),new wt(1,1),new wt(1,2),new wt(2,2)],[new wt(1,2),new wt(1,1),new wt(2,1),new wt(2,0)],[new wt(0,0),new wt(1,0),new wt(1,1),new wt(2,1)],[new wt(0,2),new wt(0,1),new wt(1,1),new wt(1,0)]],WallKick:mt}),gt(yt,vt.T,{Rotations:[[new wt(0,1),new wt(1,1),new wt(1,2),new wt(2,1)],[new wt(1,2),new wt(1,1),new wt(2,1),new wt(1,0)],[new wt(0,1),new wt(1,0),new wt(1,1),new wt(2,1)],[new wt(1,2),new wt(0,1),new wt(1,1),new wt(1,0)]],WallKick:mt}),gt(yt,vt.Z,{Rotations:[[new wt(0,2),new wt(1,1),new wt(1,2),new wt(2,1)],[new wt(2,2),new wt(1,1),new wt(2,1),new wt(1,0)],[new wt(0,1),new wt(1,0),new wt(1,1),new wt(2,0)],[new wt(1,2),new wt(0,1),new wt(1,1),new wt(0,0)]],WallKick:mt}),gt(yt,vt.Garbage,{Rotations:[[new wt(0,0)]],WallKick:Pt}),yt));const kt=Ot;function Rt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const Tt=function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Rt(this,"listeners",[]),Rt(this,"listenersOncer",[]),Rt(this,"on",(function(t){return e.listeners.push(t),{dispose:function(){return e.off(t)}}})),Rt(this,"once",(function(t){e.listenersOncer.push(t)})),Rt(this,"off",(function(t){var n=e.listeners.indexOf(t);n>-1&&e.listeners.splice(n,1)})),Rt(this,"emit",(function(t){if(e.listeners.forEach((function(e){return e(t)})),e.listenersOncer.length>0){var n=e.listenersOncer;e.listenersOncer=[],n.forEach((function(e){return e(t)}))}})),Rt(this,"pipe",(function(t){return e.on((function(e){return t.emit(e)}))}))};Array.prototype.max||Object.defineProperty(Array.prototype,"max",{enumerable:!1,writable:!1,configurable:!1,value:function(){for(var t=this.length,e=this[this.length-1];t--;)this[t]>=e&&(e=this[t]);return e}}),Array.prototype.maxBy||Object.defineProperty(Array.prototype,"maxBy",{enumerable:!1,writable:!1,configurable:!1,value:function(t){for(var e=this.length,n=t(this[this.length-1]),r=this[this.length-1];e--;){var o=t(this[e]);o>=n&&(n=o,r=this[e])}return r}}),Array.prototype.min||Object.defineProperty(Array.prototype,"min",{enumerable:!1,writable:!1,configurable:!1,value:function(){for(var t=this.length,e=this[this.length-1];t--;)this[t]<=e&&(e=this[t]);return e}}),Array.prototype.minBy||Object.defineProperty(Array.prototype,"minBy",{enumerable:!1,writable:!1,configurable:!1,value:function(t){for(var e=this.length,n=t(this[this.length-1]),r=this[this.length-1];e--;){var o=t(this[e]);o<=n&&(n=o,r=this[e])}return r}});const Ct=function(t){return function(){var e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}};function _t(t){return function(t){if(Array.isArray(t))return jt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return jt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jt(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Et(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function At(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Bt(t,e,"get"))}function Dt(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Bt(t,e,"set"),n),n}function Bt(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var Gt=new WeakMap,It=new WeakMap,Ht=new WeakMap,Wt=function(){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;if(Et(this,t),Gt.set(this,{writable:!0,value:void 0}),It.set(this,{writable:!0,value:void 0}),Ht.set(this,{writable:!0,value:void 0}),n instanceof Array)return Dt(this,It,null),Dt(this,Ht,new Array(r+n.length).fill(vt.None)),(e=At(this,Ht)).splice.apply(e,[r,n.length].concat(_t(n))),void Dt(this,Gt,null);Dt(this,It,void 0===n?Math.floor(Math.random()*Math.pow(2,32)):n),Dt(this,Gt,Ct(At(this,It))),Dt(this,Ht,[])}var e,n,r;return e=t,(n=[{key:"Seed",get:function(){return At(this,It)}},{key:"generate",value:function(){if(null!==At(this,It)&&null!==At(this,Gt))for(var t=[vt.I,vt.J,vt.L,vt.O,vt.S,vt.T,vt.Z];t.length>0;){var e=Math.floor(At(this,Gt).call(this)*t.length)%t.length;At(this,Ht).push(t.splice(e,1)[0])}else At(this,Ht).push(vt.None)}},{key:"Get",value:function(t){for(;At(this,Ht).length<=t;)this.generate();return At(this,Ht)[t]}},{key:"GetRange",value:function(t,e){for(;At(this,Ht).length<=t+e;)this.generate();return At(this,Ht).slice(t,t+e)}}])&&xt(e.prototype,n),r&&xt(e,r),t}();function Mt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Lt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Ft,Nt=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bt.R0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:NaN,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:NaN,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:y.None,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;Mt(this,t),this.Type=e,this.Rotation=n,r?this.Position=r:(this.Position=new wt(4,21),this.Bottom=21,this.Left=Math.floor(5-this.Width/2)),this.LastActionTick=o,this.ActionCount=i,this.DropTick=a,this.LastAction=u,this.PieceIndex=c}var e,n,r;return e=t,r=[{key:"Spawn",value:function(e,n,r){return new t(e,void 0,void 0,n,0,n,void 0,r)}}],(n=[{key:"Clone",value:function(){return new t(this.Type,this.Rotation,this.Position.Clone(),this.LastActionTick,this.ActionCount,this.DropTick,this.LastAction,this.PieceIndex)}},{key:"InternalPoints",get:function(){return Ot[this.Type].Rotations[this.Rotation]}},{key:"Points",get:function(){var t=this;return Ot[this.Type].Rotations[this.Rotation].map((function(e){return e.Add(t.Position)}))}},{key:"InternalLeft",get:function(){return this.InternalPoints.map((function(t){return t.X})).min()}},{key:"InternalRight",get:function(){return this.InternalPoints.map((function(t){return t.X})).max()}},{key:"InternalTop",get:function(){return this.InternalPoints.map((function(t){return t.Y})).max()}},{key:"InternalBottom",get:function(){return this.InternalPoints.map((function(t){return t.Y})).min()}},{key:"Left",get:function(){return this.Position.X+this.InternalLeft},set:function(t){this.Position.X=t-this.InternalLeft}},{key:"Right",get:function(){return this.Position.X+this.InternalRight},set:function(t){this.Position.X=t-this.InternalRight}},{key:"Top",get:function(){return this.Position.Y+this.InternalTop},set:function(t){this.Position.Y=t-this.InternalTop}},{key:"Bottom",get:function(){return this.Position.Y+this.InternalBottom},set:function(t){this.Position.Y=t-this.InternalBottom}},{key:"Width",get:function(){return this.InternalRight-this.InternalLeft+1}},{key:"Height",get:function(){return this.InternalTop-this.InternalBottom+1}},{key:"Rotate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dt.CW;this.Rotation+=t;var e=Ot[this.Type].Rotations.length;this.Rotation>=e&&(this.Rotation=0),this.Rotation<0&&(this.Rotation=e-1)}}])&&Lt(e.prototype,n),r&&Lt(e,r),t}();function Yt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t[t.LineClear=0]="LineClear",t[t.TSpin=1]="TSpin",t[t.TSpinMini=2]="TSpinMini",t[t.PerfectClear=3]="PerfectClear"}(Ft||(Ft={}));const Xt=function(){function t(e,n,r,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.LinesCleared=e,this.Type=n,this.Combo=r,this.BackToBack=o}var e,n,r;return e=t,(n=[{key:"Clone",value:function(){return new t(this.LinesCleared,this.Type,this.Combo,this.BackToBack)}},{key:"Rating",get:function(){var t=Math.pow(1.1,this.LinesCleared.length);switch(this.Type){case Ft.PerfectClear:t*=1.5;case Ft.TSpin:t*=1.3;case Ft.TSpinMini:t*=1.1}return this.BackToBack&&(t*=1.1),this.Combo&&(t*=Math.pow(1.05,this.Combo)),t}},{key:"Garbage",get:function(){var t=0,e=0;switch(this.BackToBack&&t++,this.Combo){case 0:case 1:break;case 2:case 3:t+=1;break;case 4:case 5:t+=2;break;case 6:case 7:t+=3;break;case 8:case 9:case 10:t+=4;break;default:t+=5}if(this.Type===Ft.PerfectClear)e+=6;else if(this.Type===Ft.LineClear)switch(this.LinesCleared.length){case 0:case 1:break;case 2:t++;break;case 3:t+=2;break;default:t+=4}else this.Type===Ft.TSpinMini?t+=this.LinesCleared.length:this.Type===Ft.TSpin&&(t+=2*this.LinesCleared.length,this.BackToBack&&3===this.LinesCleared.length&&t++);return{Targeted:t,Universal:e}}},{key:"toString",value:function(){var t="",e="";switch(this.Combo>0&&(t+="".concat(this.Combo," REN ")),this.BackToBack&&(t+="Back-to-back "),this.Type){case Ft.PerfectClear:e+="Perfect Clear ";break;case Ft.TSpinMini:e+="T-Spin Mini ";break;case Ft.TSpin:e+="T-Spin "}if(this.Type!==Ft.PerfectClear)switch(this.LinesCleared.length){case 4:e+="Tetris ";break;case 3:e+="Triple ";break;case 2:e+="Double ";break;case 1:e+="Single "}return[t.trim(),e.trim()]}}])&&Yt(e.prototype,n),r&&Yt(e,r),t}();function zt(t){return t.Type===Ft.LineClear&&t.LinesCleared.length>=4||(t.Type===Ft.TSpin||t.Type===Ft.TSpinMini)&&t.LinesCleared.length>0}function Vt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Ut(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ut(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ut(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Kt(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Qt(t,e,"get"))}function qt(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Qt(t,e,"set"),n),n}function Qt(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function $t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Jt(t,e,n){return e&&$t(t.prototype,e),n&&$t(t,n),t}function Zt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var te=function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:m,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:S,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7?arguments[7]:void 0,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,s=arguments.length>9&&void 0!==arguments[9]&&arguments[9],p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,y=arguments.length>12&&void 0!==arguments[12]&&arguments[12];Zt(this,t),this.Grid=new Array(40).fill(null).map((function(){return new Array(10).fill(vt.None)})),o&&o.forEach((function(t,n){return t.forEach((function(t,r){return e.Grid[n][r]=t}))})),this.GridWidth=i,this.GridHeight=a,this.PlayfieldHeight=u,this.Falling=c?c.Clone():null,this.Hold=l?l.Clone():null,this.BlockHold=s,this.TicksElapsed=f,this.PieceQueue=n,this.PieceIndex=r,this.Combo=p,this.LastAchievement=h,this.IsDead=y},ee=function(){function t(e,n){Zt(this,t),this.Type=e,this.PieceIndex=n}return Jt(t,[{key:"Clone",value:function(){return new t(this.Type,this.PieceIndex)}}]),t}(),ne=new WeakMap,re=new WeakMap,oe=new WeakMap;const ie=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,f=arguments.length>8&&void 0!==arguments[8]&&arguments[8];if(Zt(this,t),ne.set(this,{writable:!0,value:void 0}),re.set(this,{writable:!0,value:void 0}),oe.set(this,{writable:!0,value:void 0}),n instanceof te){var s=n;this.Grid=s.Grid,this.Grid=new Array(40).fill(null).map((function(){return new Array(10).fill(vt.None)})),s.Grid&&s.Grid.forEach((function(t,n){return t.forEach((function(t,r){return e.Grid[n][r]=t}))})),this.Falling=s.Falling,this.Hold=s.Hold,this.BlockHold=s.BlockHold,this.TicksElapsed=s.TicksElapsed,qt(this,ne,new Wt(s.PieceQueue,s.PieceIndex)),this.PieceIndex=s.PieceIndex,this.Combo=s.Combo,this.LastAchievement=s.LastAchievement,this.IsDead=s.IsDead}else this.Grid=new Array(40).fill(null).map((function(){return new Array(10).fill(vt.None)})),this.Falling=o,this.Hold=null!=i?i:null,this.BlockHold=u,this.TicksElapsed=a,qt(this,ne,new Wt(n)),this.PieceIndex=r,this.Combo=c,this.LastAchievement=l,this.IsDead=f;qt(this,re,new Tt),qt(this,oe,new Tt)}return Jt(t,[{key:"GetVisibleState",value:function(){var t;return new te(this.PieceQueue,this.PieceIndex,this.Grid,this.GridWidth,this.GridHeight,this.PlayfieldHeight,this.Falling,this.Hold,this.TicksElapsed,this.BlockHold,this.Combo,null===(t=this.LastAchievement)||void 0===t?void 0:t.Clone(),this.IsDead)}},{key:"Achievement",get:function(){return Kt(this,re)}},{key:"Dead",get:function(){return Kt(this,oe)}},{key:"GridWidth",get:function(){return g}},{key:"GridHeight",get:function(){return m}},{key:"PlayfieldHeight",get:function(){return S}},{key:"PieceQueue",get:function(){return Kt(this,ne).GetRange(this.PieceIndex,6)}},{key:"Get",value:function(t){var e,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(t instanceof wt)e=t.X,n=t.Y;else{if(void 0===r)return null;e=t,n=r}return e<0||n<0||e>=g||n>=m?null:this.Grid[n][e]}},{key:"IsPieceValid",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return e?!e.Points.some((function(e){var n;return(null!==(n=t.Get(e))&&void 0!==n?n:vt.I)!==vt.None})):!this.Falling||!this.Falling.Points.some((function(e){var n;return(null!==(n=t.Get(e))&&void 0!==n?n:vt.I)!==vt.None}))}},{key:"HasHold",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return void 0===t?null!==this.Hold&&this.Hold.Type!==vt.None:null!==t&&t.Type!==vt.None}},{key:"DequeuePiece",value:function(){return null===this.Falling&&(this.Falling=Nt.Spawn(Kt(this,ne).Get(this.PieceIndex),this.TicksElapsed,this.PieceIndex),this.PieceIndex++,this.BlockHold=!1,!!this.IsPieceValid()||(this.IsDead=!0,Kt(this,oe).emit(),!1))}},{key:"HoldPiece",value:function(){if(null===this.Falling)return!1;if(this.BlockHold)return!1;var t=this.Hold;return this.Hold=new ee(this.Falling.Type,this.PieceIndex-1),this.HasHold(t)||(t=new ee(Kt(this,ne).Get(this.PieceIndex),this.PieceIndex),this.PieceIndex++),t&&(this.Falling=Nt.Spawn(t.Type,this.TicksElapsed,t.PieceIndex)),this.BlockHold=!0,this.Falling.LastAction=y.Hold,!0}},{key:"ClearLines",value:function(){var t,e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,r=[],o=null;if((null==n?void 0:n.Type)===vt.T&&v(n.LastAction)){var i=[[0,0],[2,0],[0,2],[2,2]].reduce((function(t,r){var o=Vt(r,2),i=o[0],a=o[1];return e.Get(n.Position.X+i,n.Position.Y+a)!==vt.None?t+1:t}),0);if(i>=3){var a=[[1,0],[0,1],[1,2],[2,1]].some((function(t){var r=Vt(t,2),o=r[0],i=r[1];return!n.InternalPoints.find((function(t){return t.X===o&&t.Y===i}))&&e.Get(n.Position.X+o,n.Position.Y+i)!==vt.None}));o=a?Ft.TSpinMini:Ft.TSpin}}for(var u=this.GridHeight-1;u>=0;u--)this.Grid[u].some((function(t){return t===vt.None}))||(this.Grid.splice(u,1),this.Grid.push(new Array(this.GridWidth).fill(vt.None)),r.push(u));if(0===r.length){if(this.Combo=0,null===o)return}else r.length>1&&o===Ft.TSpinMini&&(o=Ft.TSpin);var c=new Xt(r,null!==(t=o)&&void 0!==t?t:Ft.LineClear,this.Combo,!!this.LastAchievement&&zt(this.LastAchievement));r.length>0&&this.Combo++,this.Grid.some((function(t){return t.some((function(t){return t!==vt.None}))}))||(c.Type=Ft.PerfectClear),c.BackToBack=zt(c)&&c.BackToBack;var l=c.Clone();Kt(this,re).emit(c),this.LastAchievement=l}},{key:"LockPiece",value:function(){var t=this;if(null===this.Falling)return!1;for(;!this.IsPieceValid();)this.Falling.Position.Y++;return this.Falling.Points.forEach((function(e){var n,r;return t.Grid[e.Y][e.X]=null!==(n=null===(r=t.Falling)||void 0===r?void 0:r.Type)&&void 0!==n?n:vt.None})),this.ClearLines(this.Falling),this.Falling.Points.map((function(t){return t.Y})).min()>=this.PlayfieldHeight&&(this.IsDead=!0,Kt(this,oe).emit()),this.Falling=null,!0}},{key:"RotatePiece",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dt.CW;if(null===this.Falling)return!1;var n=Ot[this.Falling.Type].WallKick[this.Falling.Rotation][e].find((function(n){var r,o=null===(r=t.Falling)||void 0===r?void 0:r.Clone();return!!o&&(o.Rotate(e),o.Position=o.Position.Add(n),t.IsPieceValid(o))}));return!!n&&(this.Falling.Rotate(e),this.Falling.Position=this.Falling.Position.Add(n),this.Falling.LastActionTick=this.TicksElapsed,this.Falling.ActionCount++,this.Falling.LastAction=e===dt.CW?y.RotateCW:y.RotateCCW,!0)}},{key:"ShiftPiece",value:function(t){if(null===this.Falling)return!1;var e=this.Falling.Clone();return e.Position.X+=t,!!this.IsPieceValid(e)&&(this.Falling=e,this.Falling.LastActionTick=this.TicksElapsed,this.Falling.ActionCount++,this.Falling.LastAction=t>0?y.ShiftRight:y.ShiftLeft,!0)}},{key:"CanPieceDrop",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(e)t=e.Clone();else{if(!this.Falling)return!1;t=this.Falling.Clone()}return t.Position.Y--,this.IsPieceValid(t)}},{key:"SoftDropPiece",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null!==this.Falling&&(!!this.CanPieceDrop()&&(this.Falling.Position.Y--,this.Falling.LastActionTick=this.TicksElapsed,this.Falling.ActionCount=0,t?this.Falling.DropTick=this.TicksElapsed:this.Falling.LastAction=y.SoftDrop,!0))}},{key:"HardDropPiece",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(e)t=e;else{if(!this.Falling)return!1;t=this.Falling}for(var n=t.Position.Y;this.IsPieceValid(t);)t.Position.Y--;return t.Position.Y++,n!==t.Position.Y&&(t.LastAction=y.HardDrop),t!==this.Falling||this.LockPiece()}},{key:"Tick",value:function(){this.IsDead||(null===this.Falling?this.DequeuePiece():(this.TicksElapsed-this.Falling.DropTick>=15&&this.SoftDropPiece(!0),this.TicksElapsed-this.Falling.LastActionTick>=60&&!this.CanPieceDrop()&&this.LockPiece()),this.TicksElapsed++)}}]),t}();function ae(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ue(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,le(t,e,"get"))}function ce(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,le(t,e,"set"),n),n}function le(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var fe=new WeakMap,se=new WeakMap,pe=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),fe.set(this,{writable:!0,value:void 0}),se.set(this,{writable:!0,value:void 0}),ce(this,se,void 0===e?Math.floor(Math.random()*Math.pow(2,32)):e),ce(this,fe,Ct(ue(this,se)))}var e,n,r;return e=t,(n=[{key:"Seed",get:function(){return ue(this,se)}},{key:"Get",value:function(t){return Math.floor(ue(this,fe).call(this)*t)}}])&&ae(e.prototype,n),r&&ae(e,r),t}();function he(t){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ye(t,e,n){return(ye="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Oe(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function ve(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,de(t,e,"get"))}function be(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,de(t,e,"set"),n),n}function de(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function we(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ge(t,e)}function ge(t,e){return(ge=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function me(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Oe(t);if(e){var o=Oe(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Se(this,n)}}function Se(t,e){return!e||"object"!==he(e)&&"function"!=typeof e?Pe(t):e}function Pe(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Oe(t){return(Oe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ke(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Re(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Te(t,e,n){return e&&Re(t.prototype,e),n&&Re(t,n),t}var Ce=function(){function t(e,n){ke(this,t),this.Lines=e,this.TickEnqueued=n}return Te(t,[{key:"Clone",value:function(){return new t(this.Lines,this.TickEnqueued)}}]),t}(),_e=function(t){we(n,t);var e=me(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:m,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:S,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,p=arguments.length>9&&void 0!==arguments[9]&&arguments[9],h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,v=arguments.length>12&&void 0!==arguments[12]&&arguments[12],b=arguments.length>13&&void 0!==arguments[13]?arguments[13]:[];return ke(this,n),(t=e.call(this,r,o,i,a,u,c,l,f,s,p,h,y,v)).GarbageMeter=b.map((function(t){return t.Clone()})),t}return n}(te),je=new WeakMap;const Ee=function(t){we(n,t);var e=me(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,c=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s=arguments.length>8&&void 0!==arguments[8]&&arguments[8],p=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[],h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:void 0;if(ke(this,n),t=e.call(this,r,o,null!=i?i:void 0,a,u,c,l,f,s),je.set(Pe(t),{writable:!0,value:void 0}),r instanceof _e){var y=r;t.GarbageMeter=y.GarbageMeter,be(Pe(t),je,null)}else t.GarbageMeter=p,be(Pe(t),je,new pe(h));return t}return Te(n,[{key:"GetVisibleState",value:function(){var t;return new _e(this.PieceQueue,this.PieceIndex,this.Grid,this.GridWidth,this.GridHeight,this.PlayfieldHeight,this.Falling,this.Hold,this.TicksElapsed,this.BlockHold,this.Combo,null===(t=this.LastAchievement)||void 0===t?void 0:t.Clone(),this.IsDead,this.GarbageMeter)}},{key:"SpawnGarbageLines",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(ve(this,je)){var e=new Array(this.GridWidth).fill(vt.Garbage);e[ve(this,je).Get(this.GridWidth)]=vt.None;for(var n=0;n<t;n++)this.Grid.unshift(e.slice()),this.Grid.pop();if(this.Falling)for(;!this.IsPieceValid();)this.Falling.Position.Y++}}},{key:"CancelGarbage",value:function(t){for(;t>0||this.GarbageMeter.length>0;){var e=this.GarbageMeter.minBy((function(t){return t.TickEnqueued}));e.Lines>=t?(e.Lines-=t,t=0):(t-=e.Lines,this.GarbageMeter.splice(this.GarbageMeter.indexOf(e),1))}return t}},{key:"Tick",value:function(){var t=this;this.IsDead||(this.GarbageMeter.forEach((function(e){e.Lines<=0||t.TicksElapsed-e.TickEnqueued>=240&&t.SpawnGarbageLines(e.Lines)})),this.GarbageMeter=this.GarbageMeter.filter((function(e){return t.TicksElapsed-e.TickEnqueued<240&&e.Lines>0})),ye(Oe(n.prototype),"Tick",this).call(this))}}]),n}(ie);var xe=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)};function Ae(t){return(Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function De(t,e){return(De=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Be(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ie(t);if(e){var o=Ie(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ge(this,n)}}function Ge(t,e){return!e||"object"!==Ae(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ie(t){return(Ie=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var He=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&De(t,e)}(n,t);var e=Be(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).Participants=[],t}return n}(xe);function We(t){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Me(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Le(t,e){return(Le=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Fe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Xe(t);if(e){var o=Xe(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ne(this,n)}}function Ne(t,e){return!e||"object"!==We(e)&&"function"!=typeof e?Ye(t):e}function Ye(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Xe(t){return(Xe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ze(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Ue(t,e,"get"))}function Ve(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Ue(t,e,"set"),n),n}function Ue(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var Ke=new WeakMap,qe=new WeakMap,Qe=new WeakMap,$e=new WeakMap,Je=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Le(t,e)}(i,t);var e,n,r,o=Fe(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),e=o.call(this),Ke.set(Ye(e),{writable:!0,value:void 0}),qe.set(Ye(e),{writable:!0,value:void 0}),Qe.set(Ye(e),{writable:!0,value:void 0}),$e.set(Ye(e),{writable:!0,value:void 0}),Ve(Ye(e),Ke,null),e.Participants=t.map((function(t){return{Player:t.player,State:t.seed instanceof Ee?t.seed:new Ee(t.seed)}})),e.Participants.map((function(t){return t.State})).forEach((function(t){return t.Achievement.on((function(n){var r=n.Garbage,o=e.Participants.map((function(t){return t.State})).filter((function(e){return e!==t}));o.forEach((function(t){return t.GarbageMeter.push(new Ce(r.Universal,t.TicksElapsed))}));var i=o.filter((function(t){return!t.IsDead})),a=i[Math.floor(Math.random()*i.length)];a&&a.GarbageMeter.push(new Ce(r.Targeted,a.TicksElapsed))}))})),Ve(Ye(e),qe,new Tt),Ve(Ye(e),Qe,!1),Ve(Ye(e),$e,new Tt),e}return e=i,(n=[{key:"IsGameEnded",get:function(){return!!ze(this,Qe)||this.Participants.filter((function(t){return!t.State.IsDead})).length<=1&&(Ve(this,Qe,!0),!0)}},{key:"Input",get:function(){return ze(this,qe)}},{key:"GameEnded",get:function(){return ze(this,$e)}},{key:"ClockRunning",get:function(){return null!==ze(this,Ke)}},{key:"StartClock",value:function(){Ve(this,Ke,window.setInterval(this.Tick.bind(this),1e3/60))}},{key:"StopClock",value:function(){null!==ze(this,Ke)&&window.clearInterval(ze(this,Ke))}},{key:"Tick",value:function(){var t=this;this.Participants.forEach((function(e){if(!e.State.IsDead&&(e.State.Tick(),!e.State.IsDead)){var n=e.Player.Tick(e.State.GetVisibleState()),r=e.State.Falling,o=!1;switch(n){case y.None:break;case y.HardDrop:o=e.State.HardDropPiece();break;case y.Hold:o=e.State.HoldPiece();break;case y.RotateCW:o=e.State.RotatePiece(dt.CW);break;case y.RotateCCW:o=e.State.RotatePiece(dt.CCW);break;case y.ShiftLeft:o=e.State.ShiftPiece(-1);break;case y.ShiftRight:o=e.State.ShiftPiece(1);break;case y.SoftDrop:o=e.State.SoftDropPiece(!1)}n!==y.None&&ze(t,qe).emit(new b(e.State.TicksElapsed,n,o,r,e.Player))}})),!ze(this,Qe)&&this.IsGameEnded&&ze(this,$e).emit()}}])&&Me(e.prototype,n),r&&Me(e,r),i}(He);function Ze(t){return(Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function en(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function nn(t,e){return(nn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function rn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=an(t);if(e){var o=an(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return on(this,n)}}function on(t,e){return!e||"object"!==Ze(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function an(t){return(an=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function un(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&nn(t,e)}(i,t);var e,n,r,o=rn(i);function i(){var t;tn(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).State=null,t}return e=i,(n=[{key:"ConfigureGameState",value:function(t){this.State=t}}])&&en(e.prototype,n),r&&en(e,r),i}(t)}function cn(t){return(cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ln(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function fn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function sn(t,e){return(sn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function pn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=yn(t);if(e){var o=yn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return hn(this,n)}}function hn(t,e){return!e||"object"!==cn(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function yn(t){return(yn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function vn(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&sn(t,e)}(i,t);var e,n,r,o=pn(i);function i(){var t;ln(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).Player=null,t}return e=i,(n=[{key:"ConfigurePlayer",value:function(t){this.Player=t}}])&&fn(e.prototype,n),r&&fn(e,r),i}(t)}function bn(t){return(bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function wn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function gn(t,e){return(gn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function mn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Pn(t);if(e){var o=Pn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Sn(this,n)}}function Sn(t,e){return!e||"object"!==bn(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Pn(t){return(Pn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function On(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&gn(t,e)}(i,t);var e,n,r,o=mn(i);function i(){var t;dn(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).Game=null,t}return e=i,(n=[{key:"ConfigureGame",value:function(t){this.Game=t}}])&&wn(e.prototype,n),r&&wn(e,r),i}(t)}function kn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Rn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Tn,Cn,_n,jn=function(){function t(e,n,r,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t.Linear;kn(this,t),this.From=e,this.To=n,this.Duration=r,this.Data=o,this.Elapsed=i,this.EasingFunction=a}var e,n,r;return e=t,r=[{key:"Linear",value:function(t){return t}},{key:"EaseOutQuint",value:function(t){return 1-Math.pow(1-t,5)}},{key:"EaseInOutSine",value:function(t){return-(Math.cos(Math.PI*t)-1)/2}},{key:"RevertingFunction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.EaseInOutSine,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;return function(t){return t<=n?e(t/n):t>=1-n?e((1-t)/n):1}}}],(n=[{key:"CurrentValue",get:function(){return this.From+(this.To-this.From)*this.EasingFunction(this.Elapsed/this.Duration)}},{key:"Finished",get:function(){return this.Elapsed>=this.Duration}},{key:"Tick",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.Elapsed+=t}}])&&Rn(e.prototype,n),r&&Rn(e,r),t}();function En(t){return(En="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function An(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Dn(t,e,n){return(Dn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Hn(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Bn(t,e){return(Bn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Gn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Hn(t);if(e){var o=Hn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return In(this,n)}}function In(t,e){return!e||"object"!==En(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Hn(t){return(Hn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Wn(t){return"ConfigurePlayfieldAnimatable"in t}function Mn(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Bn(t,e)}(i,t);var e,n,r,o=Gn(i);function i(){var t;xn(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).HardDropAnimations=[],t.LineClearAnimations=[],t}return e=i,(n=[{key:"ConfigurePlayfieldAnimatable",value:function(){var t=this;null!==this.State?null!==this.Game?null!==this.Player?(this.Game.Input.on((function(e){e.Player===t.Player&&e.Input===y.HardDrop&&e.Success&&e.Falling&&t.HardDropAnimations.push(new jn(1,0,20,{left:e.Falling.Left,right:e.Falling.Right,end:e.Falling.Top,type:e.Falling.Type},0,jn.EaseOutQuint))})),this.State.Achievement.on((function(e){var n=0;e.LinesCleared.forEach((function(e){t.LineClearAnimations.filter((function(t){return t.Data.Y>e})).forEach((function(t){return t.Data.Y--})),t.LineClearAnimations.push(new jn(1,0,20+n,{Y:e,OrigY:e},0,jn.EaseOutQuint)),n+=4}))}))):console.error("ConfigurePlayfieldAnimatable called before this.Player is assigned. Beware of the call order of Configure_ functions."):console.error("ConfigurePlayfieldAnimatable called before this.Game is assigned. Beware of the call order of Configure_ functions."):console.error("ConfigurePlayfieldAnimatable called before this.State is assigned. Beware of the call order of Configure_ functions.")}},{key:"p5Draw",value:function(t){Dn(Hn(i.prototype),"p5Draw",this).call(this,t),this.HardDropAnimations.forEach((function(t){return t.Tick()})),this.HardDropAnimations=this.HardDropAnimations.filter((function(t){return!t.Finished})),this.LineClearAnimations.forEach((function(t){return t.Tick()})),this.LineClearAnimations=this.LineClearAnimations.filter((function(t){return!t.Finished}))}}])&&An(e.prototype,n),r&&An(e,r),i}(t)}function Ln(t,e){return t.setAlpha(e),t}function Fn(t,e){switch(e){case vt.None:return t.color(50);case vt.I:return t.color(77,208,225);case vt.J:return t.color(33,150,243);case vt.L:return t.color(255,152,0);case vt.O:return t.color(253,216,53);case vt.S:return t.color(76,175,80);case vt.T:return t.color(224,64,251);case vt.Z:return t.color(229,115,115);case vt.Garbage:return t.color(150)}}function Nn(t,e,n,r,o,i){t.fill(Ln(Fn(t,null!=e?e:vt.None),i)),r.forEach((function(e){t.rect(n.X+e.X*o,n.Y+e.Y*o,o,o)}))}function Yn(t,e,n,r,o,i){t.push(),t.scale(1,-1),t.text(e,n,-r,o,void 0===i?i:-i),t.pop()}function Xn(t){return void 0!==Object.keys(Cn).find((function(e){return e===t}))}function zn(t){return void 0!==Object.keys(_n).find((function(e){return e===t}))}function Vn(t){if(t instanceof b)switch(t.Input){case y.None:return null;case y.HardDrop:return Tn.Lock;case y.RotateCCW:case y.RotateCW:return t.Success?Tn.RotateSuccess:Tn.RotateFail;case y.ShiftLeft:case y.ShiftRight:return t.Success?Tn.ShiftSuccess:Tn.ShiftFail;case y.SoftDrop:return Tn.SoftDrop;case y.Hold:return t.Success?Tn.Hold:null}if(t instanceof Xt){var e=[];if(t.Combo>0){var n="Combo".concat(Math.min(20,t.Combo));Xn(n)&&e.push(Cn[n])}if(t.Type===Ft.PerfectClear)return e.push(Cn.PerfectClear),e;var r="";return t.BackToBack&&(r+="B2b"),t.Type===Ft.TSpinMini?r+="TSpinMini":(t.Type===Ft.TSpin&&(r+="TSpin"),1===t.LinesCleared.length?r+="Single":2===t.LinesCleared.length?r+="Double":3===t.LinesCleared.length?r+="Triple":4===t.LinesCleared.length&&(r+="Tetris")),(Xn(r)||r.startsWith("B2b")&&Xn(r=r.substr(3)))&&e.push(Cn[r]),e}return null}function Un(t){return(Un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Kn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Qn(t,e,n){return(Qn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=er(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function $n(t,e){return($n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Jn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=er(t);if(e){var o=er(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Zn(this,n)}}function Zn(t,e){return!e||"object"!==Un(e)&&"function"!=typeof e?tr(t):e}function tr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function er(t){return(er=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function nr(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,or(t,e,"get"))}function rr(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,or(t,e,"set"),n),n}function or(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function ir(t){var e,n,r;return e=new WeakMap,n=new WeakMap,r=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$n(t,e)}(c,t);var o,i,a,u=Jn(c);function c(){var t;Kn(this,c);for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return t=u.call.apply(u,[this].concat(i)),e.set(tr(t),{writable:!0,value:void 0}),n.set(tr(t),{writable:!0,value:void 0}),r.set(tr(t),{writable:!0,value:void 0}),rr(tr(t),e,new wt(0,0)),rr(tr(t),n,new wt(1,1)),rr(tr(t),r,null),t}return o=c,(i=[{key:"ConfigurePlayfieldDrawable",value:function(t,r){rr(this,e,t),rr(this,n,r)}},{key:"p5Setup",value:function(t,e){Qn(er(c.prototype),"p5Setup",this).call(this,t,e),this.State&&rr(this,r,t.createGraphics(this.State.GridWidth*this.BlockSize,(this.State.PlayfieldHeight+.1)*this.BlockSize))}},{key:"p5Draw",value:function(t){var o=this;if(Qn(er(c.prototype),"p5Draw",this).call(this,t),null!==this.State){this.SetTransform(t,nr(this,n).X,nr(this,n).Y,nr(this,e).X,nr(this,e).Y);var i=this.State,a=this.BlockSize;if(nr(this,r)){var u=nr(this,r);if(i){u.background(50),u.stroke(0,0,0,100);for(var l=0;l<=i.GridHeight;l++)u.line(0,l*a,i.GridWidth*a,l*a);for(var f=0;f<=i.GridWidth;f++)u.line(f*a,0,f*a,i.GridHeight*a);Wn(this)&&(u.noStroke(),this.HardDropAnimations.forEach((function(t){u.fill(Ln(Fn(u,t.Data.type),20)),u.rect(t.Data.left*a,t.Data.end*a,(t.Data.right-t.Data.left+1)*a,(i.PlayfieldHeight-t.Data.end)*t.CurrentValue*a)}))),u.stroke(0,0,0,150);var s=null;if(Wn(this)){s=[];for(var p=function(t){s.push(t+o.LineClearAnimations.filter((function(e){return e.Data.Y<=t})).reduce((function(t,e){return t+e.CurrentValue}),0))},h=0;h<i.GridHeight;h++)p(h)}for(var y=0;y<i.GridHeight;y++)for(var v=0;v<i.GridWidth;v++){var b,d=null!==(b=i.Get(v,y))&&void 0!==b?b:vt.None;d!==vt.None&&(u.fill(Fn(u,d)),u.rect(v*a,O(y)*a,a,a))}if(i.Falling){var w,g,m=i.Falling.Points.map((function(t){return new wt(t.X,O(t.Y))}));Nn(u,null===(w=i.Falling)||void 0===w?void 0:w.Type,new wt(0,0),m,a,255);var S=i.Falling.Clone();i.HardDropPiece(S);var P=S.Points.map((function(t){return new wt(t.X,O(t.Y))}));Nn(u,null===(g=i.Falling)||void 0===g?void 0:g.Type,new wt(0,0),P,a,50)}Wn(this)&&(u.noStroke(),u.fill(255,255,255,100),this.LineClearAnimations.forEach((function(t){u.rect(0,t.Data.OrigY*a,i.GridWidth*a/2*t.CurrentValue,a),u.rect(i.GridWidth*a,t.Data.OrigY*a,-i.GridWidth*a/2*t.CurrentValue,a)}))),t.image(u,0,0)}}}function O(t){return null===s?t:s[t]}}}])&&qn(o.prototype,i),a&&qn(o,a),c}(t)}function ar(t){return(ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ur(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function cr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function lr(t,e,n){return(lr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=yr(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function fr(t,e){return(fr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function sr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=yr(t);if(e){var o=yr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return pr(this,n)}}function pr(t,e){return!e||"object"!==ar(e)&&"function"!=typeof e?hr(t):e}function hr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function yr(t){return(yr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function vr(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,dr(t,e,"get"))}function br(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,dr(t,e,"set"),n),n}function dr(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function wr(t){var e,n;return e=new WeakMap,n=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fr(t,e)}(u,t);var r,o,i,a=sr(u);function u(){var t;ur(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=a.call.apply(a,[this].concat(o)),e.set(hr(t),{writable:!0,value:void 0}),n.set(hr(t),{writable:!0,value:void 0}),br(hr(t),e,new wt(0,0)),br(hr(t),n,new wt(1,1)),t}return r=u,(o=[{key:"ConfigureHoldPieceDrawable",value:function(t,r){br(this,e,t),br(this,n,r)}},{key:"p5Draw",value:function(t){if(lr(yr(u.prototype),"p5Draw",this).call(this,t),null!==this.State){this.SetTransform(t,vr(this,n).X,vr(this,n).Y,vr(this,e).X,vr(this,e).Y);var r=this.State,o=this.BlockSize;if(t.fill(50),t.rect(0,0,5*o,6*o),t.noStroke(),t.fill(255),t.textAlign(t.CENTER),t.textSize(15),Yn(t,"HOLD",2.5*o,5*o),t.textAlign(t.LEFT),t.stroke(0),r.Hold){var i=kt[r.Hold.Type].Rotations[0].slice(),a=i.map((function(t){return t.X})),c=i.map((function(t){return t.Y})),l=a.max()-a.min()+1,f=c.max()-c.min()+1;Nn(t,r.Hold.Type,new wt((2.5-l/2)*o,(2.5-f/2-c.min())*o),i,o,255)}}}}])&&cr(r.prototype,o),i&&cr(r,i),u}(t)}function gr(t){return(gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function mr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Sr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Pr(t,e,n){return(Pr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Cr(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Or(t,e){return(Or=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function kr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Cr(t);if(e){var o=Cr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Rr(this,n)}}function Rr(t,e){return!e||"object"!==gr(e)&&"function"!=typeof e?Tr(t):e}function Tr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Cr(t){return(Cr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _r(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Er(t,e,"get"))}function jr(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Er(t,e,"set"),n),n}function Er(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function xr(t){var e,n;return e=new WeakMap,n=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Or(t,e)}(u,t);var r,o,i,a=kr(u);function u(){var t;mr(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=a.call.apply(a,[this].concat(o)),e.set(Tr(t),{writable:!0,value:void 0}),n.set(Tr(t),{writable:!0,value:void 0}),jr(Tr(t),e,new wt(0,0)),jr(Tr(t),n,new wt(1,1)),t}return r=u,(o=[{key:"ConfigurePieceQueueDrawable",value:function(t,r){jr(this,e,t),jr(this,n,r)}},{key:"p5Draw",value:function(t){if(Pr(Cr(u.prototype),"p5Draw",this).call(this,t),null!==this.State){this.SetTransform(t,_r(this,n).X,_r(this,n).Y,_r(this,e).X,_r(this,e).Y);for(var r=this.State,o=this.BlockSize,i=0,a=r.PieceQueue.length-1;a>=0;a--){var c=kt[r.PieceQueue[a]].Rotations[0].slice(),l=c.map((function(t){return t.X})),f=c.map((function(t){return t.Y})),s=f.max()-f.min()+1,p=l.max()-l.min()+1;Nn(t,r.PieceQueue[a],new wt((2-p/2)*o,i-f.min()*o),c,o,255),i+=(s+1)*o}}}}])&&Sr(r.prototype,o),i&&Sr(r,i),u}(t)}function Ar(t){return(Ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Br(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Gr(t,e,n){return(Gr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Lr(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Ir(t,e){return(Ir=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Hr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Lr(t);if(e){var o=Lr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Wr(this,n)}}function Wr(t,e){return!e||"object"!==Ar(e)&&"function"!=typeof e?Mr(t):e}function Mr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Lr(t){return(Lr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Fr(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Yr(t,e,"get"))}function Nr(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Yr(t,e,"set"),n),n}function Yr(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function Xr(t){var e,n;return e=new WeakMap,n=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ir(t,e)}(u,t);var r,o,i,a=Hr(u);function u(){var t;Dr(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=a.call.apply(a,[this].concat(o)),e.set(Mr(t),{writable:!0,value:void 0}),n.set(Mr(t),{writable:!0,value:void 0}),Nr(Mr(t),e,new wt(0,0)),Nr(Mr(t),n,new wt(1,1)),t}return r=u,(o=[{key:"ConfigureFramerateDrawable",value:function(t,r){Nr(this,e,t),Nr(this,n,r)}},{key:"p5Draw",value:function(t){Gr(Lr(u.prototype),"p5Draw",this).call(this,t),this.SetTransform(t,Fr(this,n).X,Fr(this,n).Y,Fr(this,e).X,Fr(this,e).Y),t.noStroke(),t.fill(0),Yn(t,"FPS: ".concat(t.frameRate().toFixed(2)),0,0)}}])&&Br(r.prototype,o),i&&Br(r,i),u}(t)}function zr(t){return(zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ur(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Kr(t,e,n){return(Kr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Jr(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function qr(t,e){return(qr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Qr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Jr(t);if(e){var o=Jr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return $r(this,n)}}function $r(t,e){return!e||"object"!==zr(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Jr(t){return(Jr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Zr(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qr(t,e)}(i,t);var e,n,r,o=Qr(i);function i(){var t;Vr(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).keyHold=y.None,t.keyDelay=0,t}return e=i,(n=[{key:"p5Draw",value:function(t){Kr(Jr(i.prototype),"p5Draw",this).call(this,t),this.keyHold!==y.None&&this.Player instanceof tt&&(this.keyDelay<=0&&(this.Player.Enqueue(this.keyHold),this.keyDelay=3),this.keyDelay--)}},{key:"p5KeyPressed",value:function(t){this.Player instanceof tt&&(t.keyCode===t.LEFT_ARROW&&(this.keyHold=y.ShiftLeft),t.keyCode===t.RIGHT_ARROW&&(this.keyHold=y.ShiftRight),t.keyCode===t.UP_ARROW&&(this.keyHold=y.RotateCW),t.keyCode===t.CONTROL&&(this.keyHold=y.RotateCCW),t.keyCode===t.DOWN_ARROW&&(this.keyHold=y.SoftDrop),t.keyCode===t.SHIFT&&(this.keyHold=y.Hold)," "===t.key&&(this.keyHold=y.HardDrop),this.Player.Enqueue(this.keyHold),this.keyDelay=10)}},{key:"p5KeyReleased",value:function(t){if(this.Player instanceof tt){var e=y.None;t.keyCode===t.LEFT_ARROW&&(e=y.ShiftLeft),t.keyCode===t.RIGHT_ARROW&&(e=y.ShiftRight),t.keyCode===t.UP_ARROW&&(e=y.RotateCW),t.keyCode===t.CONTROL&&(e=y.RotateCCW),t.keyCode===t.DOWN_ARROW&&(e=y.SoftDrop),t.keyCode===t.SHIFT&&(e=y.Hold)," "===t.key&&(e=y.HardDrop),this.keyHold===e&&(this.keyHold=y.None)}}},{key:"KeyPressedHandler",get:function(){return this.p5KeyPressed.bind(this)}},{key:"KeyReleasedHandler",get:function(){return this.p5KeyReleased.bind(this)}}])&&Ur(e.prototype,n),r&&Ur(e,r),i}(t)}function to(t){return(to="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function eo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function no(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ro(t,e){return(ro=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function oo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ao(t);if(e){var o=ao(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return io(this,n)}}function io(t,e){return!e||"object"!==to(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ao(t){return(ao=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function uo(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ro(t,e)}(i,t);var e,n,r,o=oo(i);function i(){var t;eo(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).blockSize=P,t}return e=i,(n=[{key:"BlockSize",get:function(){return this.blockSize}},{key:"ConfigureBlockSize",value:function(t){this.blockSize=t}}])&&no(e.prototype,n),r&&no(e,r),i}(t)}!function(t){t.Lock="assets/sfx/sfx_lockdown.wav",t.RotateSuccess="assets/sfx/sfx_rotate.wav",t.RotateFail="assets/sfx/sfx_rotatefail.wav",t.ShiftSuccess="assets/sfx/sfx_move.wav",t.ShiftFail="assets/sfx/sfx_movefail.wav",t.SoftDrop="assets/sfx/sfx_softdrop.wav",t.Hold="assets/sfx/sfx_hold.wav"}(Tn||(Tn={})),function(t){t.Single="assets/sfx/sfx_single.wav",t.Double="assets/sfx/sfx_double.wav",t.Triple="assets/sfx/sfx_triple.wav",t.Tetris="assets/sfx/sfx_tetris.wav",t.TSpin="assets/sfx/sfx_tspin_zero.wav",t.TSpinMini="assets/sfx/sfx_tspin_mini.wav",t.TSpinSingle="assets/sfx/sfx_tspin_single.wav",t.TSpinDouble="assets/sfx/sfx_tspin_double.wav",t.TSpinTriple="assets/sfx/sfx_tspin_triple.wav",t.B2bTSpinMini="assets/sfx/sfx_b2b_tspin_mini.wav",t.B2bTSpinSingle="assets/sfx/sfx_b2b_tspin_single.wav",t.B2bTSpinDouble="assets/sfx/sfx_b2b_tspin_double.wav",t.B2bTSpinTriple="assets/sfx/sfx_b2b_tspin_triple.wav",t.B2bTetris="assets/sfx/sfx_b2b_tetris.wav",t.PerfectClear="assets/sfx/sfx_perfectclear.wav",t.Combo1="assets/sfx/sfx_combo1.wav",t.Combo2="assets/sfx/sfx_combo2.wav",t.Combo3="assets/sfx/sfx_combo3.wav",t.Combo4="assets/sfx/sfx_combo4.wav",t.Combo5="assets/sfx/sfx_combo5.wav",t.Combo6="assets/sfx/sfx_combo6.wav",t.Combo7="assets/sfx/sfx_combo7.wav",t.Combo8="assets/sfx/sfx_combo8.wav",t.Combo9="assets/sfx/sfx_combo9.wav",t.Combo10="assets/sfx/sfx_combo10.wav",t.Combo11="assets/sfx/sfx_combo11.wav",t.Combo12="assets/sfx/sfx_combo12.wav",t.Combo13="assets/sfx/sfx_combo13.wav",t.Combo14="assets/sfx/sfx_combo14.wav",t.Combo15="assets/sfx/sfx_combo15.wav",t.Combo16="assets/sfx/sfx_combo16.wav",t.Combo17="assets/sfx/sfx_combo17.wav",t.Combo18="assets/sfx/sfx_combo18.wav",t.Combo19="assets/sfx/sfx_combo19.wav",t.Combo20="assets/sfx/sfx_combo20.wav",t.GameOver="assets/sfx/sfx_gameover.wav"}(Cn||(Cn={})),function(t){t.Single="assets/voice/voice_single.wav",t.Double="assets/voice/voice_double.wav",t.Triple="assets/voice/voice_triple.wav",t.Tetris="assets/voice/voice_tetris.wav",t.TSpin="assets/voice/voice_tspin.wav",t.TSpinMini="assets/voice/voice_tspinmini.wav",t.TSpinSingle="assets/voice/voice_tspinsingle.wav",t.TSpinDouble="assets/voice/voice_tspindouble.wav",t.TSpinTriple="assets/voice/voice_tspintriple.wav",t.B2bTSpinMini="assets/voice/voice_b2btspinmini.wav",t.B2bTSpinSingle="assets/voice/voice_b2btspinsingle.wav",t.B2bTSpinDouble="assets/voice/voice_b2btspindouble.wav",t.B2bTSpinTriple="assets/voice/voice_b2btspintriple.wav",t.B2bTetris="assets/voice/voice_b2btetris.wav",t.PerfectClear="assets/voice/voice_perfectclear.wav",t.Combo1="assets/voice/voice_combo01.wav",t.Combo2="assets/voice/voice_combo02.wav",t.Combo3="assets/voice/voice_combo03.wav",t.Combo4="assets/voice/voice_combo04.wav",t.Combo5="assets/voice/voice_combo05.wav"}(_n||(_n={}));var co=n(766);function lo(t){return(lo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return so(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return so(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function so(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function po(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ho(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function yo(t,e,n){return(yo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=mo(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function vo(t,e){return(vo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function bo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=mo(t);if(e){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return wo(this,n)}}function wo(t,e){return!e||"object"!==lo(e)&&"function"!=typeof e?go(t):e}function go(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function mo(t){return(mo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function So(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Oo(t,e,"get"))}function Po(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Oo(t,e,"set"),n),n}function Oo(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function ko(t){var e,n,r;return e=new WeakMap,n=new WeakMap,r=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&vo(t,e)}(c,t);var o,i,a,u=bo(c);function c(){var t;po(this,c);for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return t=u.call.apply(u,[this].concat(i)),e.set(go(t),{writable:!0,value:void 0}),n.set(go(t),{writable:!0,value:void 0}),r.set(go(t),{writable:!0,value:void 0}),Po(go(t),n,new Map),Po(go(t),e,null),Po(go(t),r,.5),t}return o=c,(i=[{key:"ConfigurePlayerSfxPlayable",value:function(t){var o=this;Po(this,r,t),null!==this.Game?null!==this.Player?this.Game.Input.on((function(t){var r;if(t.Player===o.Player){var i=So(o,e);if(Po(o,e,null!=t?t:null),!(i&&t.Tick-i.Tick<=4&&t.Success===i.Success&&t.Input===i.Input)){var a=Vn(t);a&&(null===(r=So(o,n).get(a))||void 0===r||r.play())}}})):console.error("ConfigurePlayerSfxPlayable called before this.Player is assigned. Beware of the call order of Configure_ functions."):console.error("ConfigurePlayerSfxPlayable called before this.Game is assigned. Beware of the call order of Configure_ functions.")}},{key:"p5Setup",value:function(t,e){var o=this;yo(mo(c.prototype),"p5Setup",this).call(this,t,e),Object.entries(Tn).forEach((function(t){var e=fo(t,2)[1];return So(o,n).set(e,new co.Howl({src:[e],volume:So(o,r)}))}))}}])&&ho(o.prototype,i),a&&ho(o,a),c}(t)}function Ro(t){return(Ro="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function To(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Co(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Co(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Co(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function _o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function jo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Eo(t,e,n){return(Eo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Go(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function xo(t,e){return(xo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ao(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Go(t);if(e){var o=Go(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Do(this,n)}}function Do(t,e){return!e||"object"!==Ro(e)&&"function"!=typeof e?Bo(t):e}function Bo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Go(t){return(Go=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Io(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Wo(t,e,"get"))}function Ho(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Wo(t,e,"set"),n),n}function Wo(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function Mo(t){var e,n;return e=new WeakMap,n=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xo(t,e)}(u,t);var r,o,i,a=Ao(u);function u(){var t;_o(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=a.call.apply(a,[this].concat(o)),e.set(Bo(t),{writable:!0,value:void 0}),n.set(Bo(t),{writable:!0,value:void 0}),Ho(Bo(t),e,new Map),Ho(Bo(t),n,.5),t}return r=u,(o=[{key:"ConfigureGameEventSfxPlayable",value:function(t){var r=this;Ho(this,n,t),null!==this.State?(this.State.Achievement.on((function(t){var n=Vn(t);n&&n.forEach((function(t){var n;return null===(n=Io(r,e).get(t))||void 0===n?void 0:n.play()}))})),this.State.Dead.on((function(){var t;null===(t=Io(r,e).get(Cn.GameOver))||void 0===t||t.play()}))):console.error("ConfigureGameEventSfxPlayable called before this.State is assigned. Beware of the call order of Configure_ functions.")}},{key:"p5Setup",value:function(t,r){var o=this;Eo(Go(u.prototype),"p5Setup",this).call(this,t,r),Object.entries(Cn).forEach((function(t){var r=To(t,2)[1];return Io(o,e).set(r,new co.Howl({src:[r],volume:Io(o,n)}))}))}}])&&jo(r.prototype,o),i&&jo(r,i),u}(t)}function Lo(t){return(Lo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return No(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return No(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function No(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Yo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function zo(t,e,n){return(zo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Qo(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Vo(t,e){return(Vo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Uo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Qo(t);if(e){var o=Qo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ko(this,n)}}function Ko(t,e){return!e||"object"!==Lo(e)&&"function"!=typeof e?qo(t):e}function qo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Qo(t){return(Qo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $o(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Zo(t,e,"get"))}function Jo(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Zo(t,e,"set"),n),n}function Zo(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function ti(t){var e,n;return e=new WeakMap,n=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Vo(t,e)}(u,t);var r,o,i,a=Uo(u);function u(){var t;Yo(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=a.call.apply(a,[this].concat(o)),e.set(qo(t),{writable:!0,value:void 0}),n.set(qo(t),{writable:!0,value:void 0}),Jo(qo(t),e,new Map),Jo(qo(t),n,.5),t}return r=u,(o=[{key:"ConfigureGameEventVoicePlayable",value:function(t){var r=this;Jo(this,n,t),null!==this.State?this.State.Achievement.on((function(t){var n,o=function(t){if(t.Type===Ft.PerfectClear)return _n.PerfectClear;var e="";if(t.BackToBack&&(e+="B2b"),t.Type===Ft.TSpinMini?e+="TSpinMini":(t.Type===Ft.TSpin&&(e+="TSpin"),1===t.LinesCleared.length?e+="Single":2===t.LinesCleared.length?e+="Double":3===t.LinesCleared.length?e+="Triple":4===t.LinesCleared.length&&(e+="Tetris")),zn(e)&&"Single"!==e)return _n[e];if(e.startsWith("B2b")&&zn(e=e.substr(3)))return _n[e];if(t.Combo>0){var n="Combo".concat(Math.min(5,t.Combo));if(zn(n))return _n[n]}return null}(t);o&&(null===(n=$o(r,e).get(o))||void 0===n||n.play())})):console.error("ConfigureGameEventVoicePlayable called before this.State is assigned. Beware of the call order of Configure_ functions.")}},{key:"p5Setup",value:function(t,r){var o=this;zo(Qo(u.prototype),"p5Setup",this).call(this,t,r),Object.entries(_n).forEach((function(t){var r=Fo(t,2)[1];return $o(o,e).set(r,new co.Howl({src:[r],volume:$o(o,n)}))}))}}])&&Xo(r.prototype,o),i&&Xo(r,i),u}(t)}function ei(t){return(ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ni(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return ri(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ri(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ri(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function oi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ii(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ai(t,e,n){return(ai="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=si(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function ui(t,e){return(ui=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ci(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=si(t);if(e){var o=si(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return li(this,n)}}function li(t,e){return!e||"object"!==ei(e)&&"function"!=typeof e?fi(t):e}function fi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function si(t){return(si=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pi(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,yi(t,e,"get"))}function hi(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,yi(t,e,"set"),n),n}function yi(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function vi(t){var e,n;return e=new WeakMap,n=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ui(t,e)}(u,t);var r,o,i,a=ci(u);function u(){var t;oi(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=a.call.apply(a,[this].concat(o)),e.set(fi(t),{writable:!0,value:void 0}),n.set(fi(t),{writable:!0,value:void 0}),t.GameEventAnimation=null,hi(fi(t),e,new wt(0,0)),hi(fi(t),n,new wt(1,1)),t}return r=u,(o=[{key:"ConfigureGameEventTextDrawable",value:function(t,r){var o=this;hi(this,e,t),hi(this,n,r),null!==this.State?this.State.Achievement.on((function(t){var e=ni(t.toString(),2),n=e[0],r=e[1];o.GameEventAnimation=new jn(0,1,100*t.Rating,{subtitle:n,title:r,rating:t.Rating},0,jn.RevertingFunction())})):console.error("ConfigureGameEventTextDrawable called before this.State is assigned. Beware of the call order of Configure_ functions.")}},{key:"p5Draw",value:function(t){ai(si(u.prototype),"p5Draw",this).call(this,t),this.SetTransform(t,pi(this,n).X,pi(this,n).Y,pi(this,e).X,pi(this,e).Y);var r=this.GameEventAnimation;r&&(r.Tick(),r.Finished&&(this.GameEventAnimation=null),t.textAlign(t.CENTER,t.BOTTOM),t.fill(255,255,255,255*r.CurrentValue),t.noStroke(),t.textSize(15*r.Data.rating*.8),Yn(t,r.Data.subtitle,0,15*r.Data.rating),t.textSize(15*r.Data.rating),Yn(t,r.Data.title,0,0))}}])&&ii(r.prototype,o),i&&ii(r,i),u}(t)}function bi(t){return(bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function di(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function wi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function gi(t,e,n){return(gi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ki(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function mi(t,e){return(mi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Si(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ki(t);if(e){var o=ki(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Pi(this,n)}}function Pi(t,e){return!e||"object"!==bi(e)&&"function"!=typeof e?Oi(t):e}function Oi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ki(t){return(ki=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ri(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Ci(t,e,"get"))}function Ti(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Ci(t,e,"set"),n),n}function Ci(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function _i(t){var e,n;return e=new WeakMap,n=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&mi(t,e)}(u,t);var r,o,i,a=Si(u);function u(){var t;di(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return t=a.call.apply(a,[this].concat(o)),e.set(Oi(t),{writable:!0,value:void 0}),n.set(Oi(t),{writable:!0,value:void 0}),Ti(Oi(t),e,new wt(0,0)),Ti(Oi(t),n,new wt(1,1)),t}return r=u,(o=[{key:"ConfigureGarbageMeterDrawable",value:function(t,r){Ti(this,e,t),Ti(this,n,r)}},{key:"p5Draw",value:function(t){if(gi(ki(u.prototype),"p5Draw",this).call(this,t),null!==this.State){this.SetTransform(t,Ri(this,n).X,Ri(this,n).Y,Ri(this,e).X,Ri(this,e).Y);var r=this.State,o=this.BlockSize;t.fill(50),t.rect(0,0,o,o*r.PlayfieldHeight),t.fill(Fn(t,vt.Garbage));var i=r.GarbageMeter.reduce((function(t,e){return t+e.Lines}),0);i>r.PlayfieldHeight&&(i=r.PlayfieldHeight,t.fill("red"));for(var a=0;a<i;a++)t.rect(0,a*o,o,o)}}}])&&wi(r.prototype,o),i&&wi(r,i),u}(t)}function ji(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Ei=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e&&n?(this.width=e,this.height=n):(this.width=440,this.height=502)}var e,n,r;return e=t,(n=[{key:"SetTransform",value:function(t,e,n,r,o){this.ResetTransform(t),t.translate(r,o),t.scale(e,n)}},{key:"ResetTransform",value:function(t){t.resetMatrix(),t.scale(1,-1),t.translate(0,-this.height),t.scale(1,1)}},{key:"p5Setup",value:function(t,e){t.createCanvas(this.width,this.height).parent(e),t.frameRate(60),this.ResetTransform(t)}},{key:"p5Draw",value:function(t){t.background(100)}},{key:"DrawHandler",get:function(){return this.p5Draw.bind(this)}},{key:"SetupHandler",get:function(){return this.p5Setup.bind(this)}}])&&ji(e.prototype,n),r&&ji(e,r),t}();function xi(t){return(xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ai(t,e){return(Ai=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Di(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Gi(t);if(e){var o=Gi(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Bi(this,n)}}function Bi(t,e){return!e||"object"!==xi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Gi(t){return(Gi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ii=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ai(t,e)}(n,t);var e=Di(n);function n(t,r,o,i){var a,u,c;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(c=o&&i?e.call(this,o,i):e.call(this)).ConfigureGameState(r.State),c.ConfigurePlayer(r.Player),c.ConfigureGame(t),c.ConfigureBlockSize(P),c.ConfigurePlayfieldAnimatable(),c.ConfigurePlayerSfxPlayable(.125),c.ConfigureGameEventSfxPlayable(.125),c.ConfigureGameEventVoicePlayable(.125),c.ConfigureGameEventTextDrawable(new wt(11*c.BlockSize,c.BlockSize*((null!==(a=null===(u=c.State)||void 0===u?void 0:u.PlayfieldHeight)&&void 0!==a?a:S)+1)),new wt(1,1)),c.ConfigurePlayfieldDrawable(new wt(6*c.BlockSize,0),new wt(1,1)),c.ConfigureHoldPieceDrawable(new wt(10,200),new wt(1,1)),c.ConfigurePieceQueueDrawable(new wt(18*c.BlockSize,100),new wt(.7,.7)),c.ConfigureGarbageMeterDrawable(new wt(16.5*c.BlockSize,0),new wt(1,1)),c.ConfigureFramerateDrawable(new wt(0,c.height-10),new wt(1,1)),Bi(c)}return n}(Xr(_i(xr(wr(ir(vi(Mo(ti(ko(Mn(uo(Zr(On(vn(un(Ei))))))))))))))));function Hi(t){return(Hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Mi(t,e){return(Mi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Li(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ni(t);if(e){var o=Ni(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Fi(this,n)}}function Fi(t,e){return!e||"object"!==Hi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ni(t){return(Ni=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Yi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Mi(t,e)}(i,t);var e,n,r,o=Li(i);function i(t,e,n,r){var a,u,c;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(c=n&&r?o.call(this,n,r):o.call(this,220,251)).ConfigureGameState(e.State),c.ConfigurePlayer(e.Player),c.ConfigureGame(t),c.ConfigureBlockSize(P),c.ConfigurePlayfieldAnimatable(),c.ConfigurePlayerSfxPlayable(0),c.ConfigureGameEventSfxPlayable(.025),c.ConfigureGameEventVoicePlayable(.025),c.ConfigureGameEventTextDrawable(new wt(11*c.BlockSize,c.BlockSize*((null!==(a=null===(u=c.State)||void 0===u?void 0:u.PlayfieldHeight)&&void 0!==a?a:S)+1)),new wt(1,1)),c.ConfigurePlayfieldDrawable(new wt(6*c.BlockSize,0),new wt(1,1)),c.ConfigureHoldPieceDrawable(new wt(10,200),new wt(1,1)),c.ConfigurePieceQueueDrawable(new wt(18*c.BlockSize,100),new wt(.7,.7)),c.ConfigureGarbageMeterDrawable(new wt(16.5*c.BlockSize,0),new wt(1,1)),c.ConfigureFramerateDrawable(new wt(0,c.height-10),new wt(1,1)),Fi(c)}return e=i,(n=[{key:"ResetTransform",value:function(t){t.resetMatrix(),t.scale(1,-1),t.translate(0,-this.height),t.scale(.5,.5)}}])&&Wi(e.prototype,n),r&&Wi(e,r),i}(Xr(_i(xr(wr(ir(vi(Mo(ti(ko(Mn(uo(On(vn(un(Ei)))))))))))))));function Xi(t){return(Xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Vi(t,e){return(Vi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ui(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=qi(t);if(e){var o=qi(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ki(this,n)}}function Ki(t,e){return!e||"object"!==Xi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function qi(t){return(qi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Qi,$i,Ji,Zi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Vi(t,e)}(i,t);var e,n,r,o=Ui(i);function i(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(t=o.call(this)).ConfigureInputDelayable(10),t}return e=i,(n=[{key:"Update",value:function(t,e){return y.None}}])&&zi(e.prototype,n),r&&zi(e,r),i}((Qi=w,$i=new WeakMap,Ji=new WeakMap,function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&C(t,e)}(i,t);var e,n,r,o=_(i);function i(){var t;R(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t=o.call.apply(o,[this].concat(n)),$i.set(E(t),{writable:!0,value:void 0}),Ji.set(E(t),{writable:!0,value:void 0}),D(E(t),$i,0),D(E(t),Ji,10),t}return e=i,(n=[{key:"Tick",value:function(t){var e=t.TicksElapsed-A(this,$i)>=A(this,Ji),n=this.Update(t,e);return e?(n!==y.None&&D(this,$i,t.TicksElapsed),n):y.None}},{key:"ConfigureInputDelayable",value:function(t){D(this,Ji,t)}},{key:"Update",value:function(t,e){return y.None}}])&&T(e.prototype,n),r&&T(e,r),i}(Qi)));function ta(t){return(ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ea(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return na(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return na(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function na(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ra(t,e,n){return(ra="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ca(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function oa(t,e){return(oa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ia(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ca(t);if(e){var o=ca(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return aa(this,n)}}function aa(t,e){return!e||"object"!==ta(e)&&"function"!=typeof e?ua(t):e}function ua(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ca(t){return(ca=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function la(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function fa(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function sa(t,e,n){return e&&fa(t.prototype,e),n&&fa(t,n),t}function pa(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ya(t,e,"get"))}function ha(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,ya(t,e,"set"),n),n}function ya(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var va=new WeakMap,ba=function(){function t(e,n){la(this,t),va.set(this,{writable:!0,value:void 0}),this.rot=e,this.col=n,this.pieceTop=0,this.heightMap=[],this.enclosedHoles=0,this.openHoles=0,this.blocksAboveHoles=0,this.iWells=0,this.isDead=!1,this.holdPiece=vt.None,ha(this,va,null),this.achievement=null}return sa(t,[{key:"globalTop",get:function(){return this.heightMap.max()}},{key:"bumpiness",get:function(){var t=this;return this.heightMap.reduce((function(e,n,r){return e+(0===r?0:Math.abs(n-t.heightMap[r-1]))}),0)}},{key:"Rating",value:function(t){if(pa(this,va))return pa(this,va);var e=t(this);return ha(this,va,e),e}}],[{key:"Never",get:function(){var e=new t(0,0);return ha(e,va,Number.MIN_VALUE),e}}]),t}();function da(t,e,n,r){n[e][t]!==vt.None||r[e][t]||(r[e][t]=!0,t>0&&da(t-1,e,n,r),t<n[0].length-1&&da(t+1,e,n,r),e>0&&da(t,e-1,n,r),e<n.length-1&&da(t,e+1,n,r))}var wa=new WeakMap;function ga(t){return(ga="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ma(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Sa(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Pa(t,e){return(Pa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Oa(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ra(t);if(e){var o=Ra(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ka(this,n)}}function ka(t,e){return!e||"object"!==ga(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ra(t){return(Ra=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ta=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pa(t,e)}(i,t);var e,n,r,o=Oa(i);function i(){return ma(this,i),o.apply(this,arguments)}return e=i,(n=[{key:"rateChoice",value:function(t){var e=0;return e-=t.globalTop,e-=4*t.pieceTop,e-=10*t.enclosedHoles,e-=10*t.openHoles,e-=t.blocksAboveHoles,e-=t.iWells,e-=t.bumpiness,t.achievement&&(e+=10*t.achievement.Combo),t.isDead&&(e=Number.MIN_VALUE),e+=t.holdPiece===vt.I?10:0}}])&&Sa(e.prototype,n),r&&Sa(e,r),i}(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&oa(t,e)}(n,t);var e=ia(n);function n(){var t;return la(this,n),t=e.call(this),wa.set(ua(t),{writable:!0,value:void 0}),ha(ua(t),wa,null),t}return sa(n,[{key:"rateChoice",value:function(t){var e,n,r=0;return r-=t.globalTop,r-=t.pieceTop,r-=t.enclosedHoles,r-=t.openHoles,r-=t.blocksAboveHoles,r-=t.iWells,r+=10*(null!==(e=null===(n=t.achievement)||void 0===n?void 0:n.Rating)&&void 0!==e?e:0),r-=t.bumpiness,r+=t.holdPiece===vt.I?10:0,t.isDead&&(r=Number.MIN_VALUE),r}},{key:"getChoice",value:function(t,e){for(var n=this,r=[],o=0;o<kt[e.Type].Rotations.length;o++)for(var i=kt[e.Type].Rotations[o].map((function(t){return t.X})).min(),a=kt[e.Type].Rotations[o].map((function(t){return t.X})).max(),u=function(n){var i,a,u=new ba(o,n),c=new ie(t);c.Achievement.once((function(t){return u.achievement=t}));var l=e.Clone();c.Falling=l,l.Position.X=n,l.Rotation=o,c.HardDropPiece(),u.pieceTop=l.Top;for(var f=[],s=new Array(c.GridHeight).fill(null).map((function(t){return new Array(c.GridWidth).fill(!1)})),p=0;p<c.GridWidth;p++)da(p,c.GridHeight-1,c.Grid,s);u.enclosedHoles=c.Grid.reduce((function(t,e,n){return t+e.reduce((function(t,e,r){return t+(e!==vt.None||s[n][r]?0:(f.push([r,n]),1))}),0)}),0);for(var h=[],y=function(t){var e=c.Grid.map((function(e){return e[t]}));e[-1]=vt.I;for(var n=e.length-1;e[n]===vt.None;)n--;h.push(n+1)},v=0;v<c.GridWidth;v++)y(v);u.heightMap=h,u.openHoles=c.Grid.reduce((function(t,e,n){return t+e.reduce((function(t,e,r){return t+(e===vt.None&&s[n][r]&&n<h[r]?(f.push([r,n]),1):0)}),0)}),0),u.blocksAboveHoles=f.reduce((function(t,e){for(var n=ea(e,2),r=n[0],o=n[1];o<h[r];o++)c.Grid[r][o]!==vt.None&&t++;return t}),0),u.iWells=0;for(var b=0;b<c.GridWidth;b++)if(!(b>0&&h[b-1]-h[b]<3||b<c.GridWidth-1&&h[b+1]-h[b]<3)){var d=[];b>0&&d.push(h[b-1]-h[b]),b<c.GridWidth-1&&d.push(h[b+1]-h[b]),u.iWells+=Math.min.apply(Math,d)}u.isDead=c.IsDead,u.holdPiece=null!==(i=null===(a=c.Hold)||void 0===a?void 0:a.Type)&&void 0!==i?i:vt.None,r.push(u)},c=-i;c<t.GridWidth-a;c++)u(c);return r.sort((function(t,e){return e.Rating(n.rateChoice)-t.Rating(n.rateChoice)})),r[0]}},{key:"Update",value:function(t,e){var r=t.Falling;if(null===r&&ha(this,wa,null),null===pa(this,wa)&&null!==r||null!==pa(this,wa)&&null!==r&&pa(this,wa).PieceIndex!==r.PieceIndex){ha(this,wa,r);var o=this.getChoice(t,r),i=ba.Never,a=new ie(t);if(a.HoldPiece(),a.Falling&&(i=this.getChoice(a.GetVisibleState(),a.Falling)),i.Rating(this.rateChoice)>o.Rating(this.rateChoice))this.Enqueue(y.Hold);else{var u=o.col,c=o.rot;if(1===c?this.Enqueue(y.RotateCW):3===c?this.Enqueue(y.RotateCCW):2===c&&(this.Enqueue(y.RotateCW),this.Enqueue(y.RotateCW)),u>r.Position.X)for(var l=0;l<u-r.Position.X;l++)this.Enqueue(y.ShiftRight);else if(u<r.Position.X)for(var f=0;f<r.Position.X-u;f++)this.Enqueue(y.ShiftLeft);this.Enqueue(y.HardDrop)}}return ra(ca(n.prototype),"Update",this).call(this,t,e)}}]),n}(U(Zi))),Ca=n(788);function _a(t){return function(t){if(Array.isArray(t))return xa(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Ea(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ja(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||Ea(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ea(t,e){if(t){if("string"==typeof t)return xa(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xa(t,e):void 0}}function xa(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}const Aa=function(t){var e=ja((0,r.useState)(),2),n=e[0],o=e[1],i=(0,Ca.gz)({rounds:0,wins:null});return(0,r.useEffect)((function(){i.rounds++;var t=new tt,e=[];e.push(new Ta);var n=new Je([{player:t}].concat(_a(e.map((function(t){return{player:t}}))))),r=new Ii(n,n.Participants[0]),a=[];return n.Participants.slice(1).forEach((function(t){return a.push(new Yi(n,t))})),o([r].concat(a)),setTimeout((function(){return n.StartClock()}),1e3),n.GameEnded.once((function(){n.StopClock(),setTimeout((function(){var t,e=null===(t=i.wins)||void 0===t?void 0:t.slice();e||(e=new Array(n.Participants.length).fill(0)),e[n.Participants.findIndex((function(t){return!t.State.IsDead}))]++,i.wins=e}),1e3)})),function(){o(void 0)}}),[i.wins]),r.createElement("div",{className:"min-h-screen w-screen relative"},r.createElement("p",{className:"absolute top-0 left-0 z-10"},"Round ",i.rounds),r.createElement("div",{className:"absolute top-0 left-0 right-0 bottom-0 flex justify-center items-center flex-wrap"},null==n?void 0:n.map((function(t,e){return r.createElement("div",{key:"".concat(i.rounds,"-").concat(e)},r.createElement(p(),{setup:t.SetupHandler,draw:t.DrawHandler,keyPressed:t instanceof Ii?t.KeyPressedHandler:void 0,keyReleased:t instanceof Ii?t.KeyReleasedHandler:void 0}),r.createElement("p",null,i.wins?"".concat(i.wins[e]," wins"):null))}))))};function Da(t){return(Da="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ba(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ga(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ia(t,e){return(Ia=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ha(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=La(t);if(e){var o=La(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Wa(this,n)}}function Wa(t,e){return!e||"object"!==Da(e)&&"function"!=typeof e?Ma(t):e}function Ma(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function La(t){return(La=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Fa(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Ya(t,e,"get"))}function Na(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Ya(t,e,"set"),n),n}function Ya(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var Xa=new WeakMap,za=new WeakMap,Va=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ia(t,e)}(i,t);var e,n,r,o=Ha(i);function i(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return Ba(this,i),e=o.call(this),Xa.set(Ma(e),{writable:!0,value:void 0}),za.set(Ma(e),{writable:!0,value:void 0}),Na(Ma(e),Xa,null),e.Player=t,e.State=n instanceof ie?n:new ie(n),Na(Ma(e),za,new Tt),e}return e=i,(n=[{key:"Input",get:function(){return Fa(this,za)}},{key:"ClockRunning",get:function(){return null!==Fa(this,Xa)}},{key:"StartClock",value:function(){Na(this,Xa,window.setInterval(this.Tick.bind(this),1e3/60))}},{key:"StopClock",value:function(){null!==Fa(this,Xa)&&window.clearInterval(Fa(this,Xa))}},{key:"Tick",value:function(){if(!this.State.IsDead){this.State.Tick();var t=this.Player.Tick(this.State.GetVisibleState()),e=this.State.Falling,n=!1;switch(t){case y.None:break;case y.HardDrop:n=this.State.HardDropPiece();break;case y.Hold:n=this.State.HoldPiece();break;case y.RotateCW:n=this.State.RotatePiece(dt.CW);break;case y.RotateCCW:n=this.State.RotatePiece(dt.CCW);break;case y.ShiftLeft:n=this.State.ShiftPiece(-1);break;case y.ShiftRight:n=this.State.ShiftPiece(1);break;case y.SoftDrop:n=this.State.SoftDropPiece(!1)}t!==y.None&&Fa(this,za).emit(new b(this.State.TicksElapsed,t,n,e,this.Player))}}}])&&Ga(e.prototype,n),r&&Ga(e,r),i}(xe);function Ua(t){return(Ua="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ka(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qa(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Qa(t,e){return(Qa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function $a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Za(t);if(e){var o=Za(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ja(this,n)}}function Ja(t,e){return!e||"object"!==Ua(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Za(t){return(Za=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function tu(t){return(tu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function eu(t,e){return(eu=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function nu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ou(t);if(e){var o=ou(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ru(this,n)}}function ru(t,e){return!e||"object"!==tu(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ou(t){return(ou=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var iu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&eu(t,e)}(n,t);var e=nu(n);function n(t,r,o){var i,a,u;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(u=r&&o?e.call(this,r,o):e.call(this)).ConfigureGameState(t.State),u.ConfigurePlayer(t.Player),u.ConfigureGame(t),u.ConfigureBlockSize(P),u.ConfigurePlayfieldAnimatable(),u.ConfigurePlayerSfxPlayable(O),u.ConfigureGameEventSfxPlayable(O),u.ConfigureGameEventVoicePlayable(O),u.ConfigureGameEventTextDrawable(new wt(11*u.BlockSize,u.BlockSize*((null!==(i=null===(a=u.State)||void 0===a?void 0:a.PlayfieldHeight)&&void 0!==i?i:S)+1)),new wt(1,1)),u.ConfigurePlayfieldDrawable(new wt(6*u.BlockSize,0),new wt(1,1)),u.ConfigureHoldPieceDrawable(new wt(10,200),new wt(1,1)),u.ConfigurePieceQueueDrawable(new wt(17*u.BlockSize,100),new wt(.7,.7)),u.ConfigureFramerateDrawable(new wt(0,u.height-10),new wt(1,1)),ru(u)}return n}(Xr(xr(wr(ir(vi(Mo(ti(ko(Mn(uo(Zr(On(vn(function(t){return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Qa(t,e)}(i,t);var e,n,r,o=$a(i);function i(){var t;Ka(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(t=o.call.apply(o,[this].concat(n))).State=null,t}return e=i,(n=[{key:"ConfigureGameState",value:function(t){this.State=t}}])&&qa(e.prototype,n),r&&qa(e,r),i}(t)}(Ei)))))))))))))));function au(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return uu(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return uu(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uu(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}const cu=function(t){var e=au((0,r.useState)(),2)[1],n=au((0,r.useState)(),2)[1],o=au((0,r.useState)(),2),i=o[0],a=o[1];return(0,r.useEffect)((function(){var t=new tt,r=new Va(t),o=new iu(r);return e(t),n(r),a(o),setTimeout((function(){return r.StartClock()}),1e3),function(){r.StopClock()}}),[]),i?r.createElement("div",{className:"min-h-screen w-screen flex justify-center items-center"},r.createElement(p(),{setup:i.SetupHandler,draw:i.DrawHandler,keyPressed:i.KeyPressedHandler,keyReleased:i.KeyReleasedHandler})):r.createElement("p",null,"Loading")};const lu=function(){return r.createElement(i.UT,null,r.createElement(a.rs,null,r.createElement(a.AW,{exact:!0,path:"/",component:l}),r.createElement(a.AW,{exact:!0,path:"/test",component:cu}),r.createElement(a.AW,{exact:!0,path:"/multi/local",component:Aa}),r.createElement(a.AW,{component:u})))};o.render(r.createElement(lu,null),document.getElementById("app"))}},t=>{"use strict";var e;e=603,t(t.s=e)}]);