(self.webpackChunktetris_ai=self.webpackChunktetris_ai||[]).push([[826],{919:(e,t,n)=>{"use strict";var r=n(294),o=n(935),i=n(727),a=n(977);const u=function(e){return r.createElement("p",null,"Not found")};const c=function(){return r.createElement("div",{className:"flex flex-col justify-center items-center select-none min-h-screen bg-gradient-to-br from-gray-900  to-blue-700"},r.createElement("h1",{className:"text-6xl text-green-500 border-b-4 pb-4"},"Hello World !"),r.createElement("h2",{className:"text-2xl text-gray-300 mt-10"},"Click"," ",r.createElement(i.rU,{to:"/test",className:"text-green-400 underline"},"here")," ","to play pre-alpha Tetris",r.createElement("br",null),r.createElement(i.rU,{to:"/multi/local",className:"text-green-400 underline"},"Local Multi")))};const l=function(e){return r.createElement(c,null)};var f,s=n(210),p=n.n(s);function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.None=0]="None",e[e.SoftDrop=1]="SoftDrop",e[e.HardDrop=2]="HardDrop",e[e.Hold=3]="Hold",e[e.ShiftLeft=4]="ShiftLeft",e[e.ShiftRight=5]="ShiftRight",e[e.RotateCW=6]="RotateCW",e[e.RotateCCW=7]="RotateCCW"}(f||(f={}));const y=f;function v(e){return e===f.RotateCCW||e===f.RotateCW}var b=function(){function e(t,n,r,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.Tick=t,this.Input=n,this.Success=r,this.Falling=o,this.Player=i}var t,n,r;return t=e,(n=[{key:"Clone",value:function(){return new e(this.Tick,this.Input,this.Success,this.Falling,this.Player)}}])&&h(t.prototype,n),r&&h(t,r),e}();function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"Tick",value:function(e){return y.None}}])&&d(t.prototype,n),r&&d(t,r),e}(),g=10,m=40,S=20,O=20,P=.5;function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=x(e);if(t){var o=x(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return j(this,n)}}function j(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?E(e):t}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,B(e,t,"get"))}function D(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,B(e,t,"set"),n),n}function B(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function H(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function W(e,t,n){return(W="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Y(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function L(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Y(e);if(t){var o=Y(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return F(this,n)}}function F(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?N(e):t}function N(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Y(e){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function X(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,V(e,t,"get"))}function z(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,V(e,t,"set"),n),n}function V(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function U(e){var t;return t=new WeakMap,function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(a,e);var n,r,o,i=L(a);function a(){var e;H(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return e=i.call.apply(i,[this].concat(r)),t.set(N(e),{writable:!0,value:void 0}),z(N(e),t,[]),e}return n=a,(r=[{key:"Tick",value:function(e){var n;return"ConfigureInputDelayable"in this?W(Y(a.prototype),"Tick",this).call(this,e):null!==(n=X(this,t).shift())&&void 0!==n?n:y.None}},{key:"Update",value:function(e,n){var r;return n&&null!==(r=X(this,t).shift())&&void 0!==r?r:y.None}},{key:"Enqueue",value:function(e){X(this,t).push(e)}}])&&I(n.prototype,r),o&&I(n,o),a}(e)}function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Z(e);if(t){var o=Z(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return J(this,n)}}function J(e,t){return!t||"object"!==K(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ee=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(n,e);var t=$(n);function n(){return q(this,n),t.apply(this,arguments)}return n}(U(w));function te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ne,re,oe,ie,ae,ue,ce,le,fe,se,pe,he,ye,ve,be,de,we=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.X=t,this.Y=n}var t,n,r;return t=e,(n=[{key:"Add",value:function(t){return new e(this.X+t.X,this.Y+t.Y)}},{key:"Subtract",value:function(t){return new e(this.X-t.X,this.Y-t.Y)}},{key:"Clone",value:function(){return new e(this.X,this.Y)}}])&&te(t.prototype,n),r&&te(t,r),e}();function ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.None=0]="None",e[e.I=1]="I",e[e.J=2]="J",e[e.L=3]="L",e[e.O=4]="O",e[e.S=5]="S",e[e.T=6]="T",e[e.Z=7]="Z",e[e.Garbage=8]="Garbage"}(ve||(ve={})),function(e){e[e.R0=0]="R0",e[e.R90=1]="R90",e[e.R180=2]="R180",e[e.R270=3]="R270"}(be||(be={})),function(e){e[e.CW=1]="CW",e[e.CCW=-1]="CCW"}(de||(de={}));var me=Object.freeze([(ne={},ge(ne,-1,[new we(0,0),new we(1,0),new we(1,1),new we(0,-2),new we(1,-2)]),ge(ne,1,[new we(0,0),new we(-1,0),new we(-1,1),new we(0,-2),new we(-1,-2)]),ne),(re={},ge(re,-1,[new we(0,0),new we(1,0),new we(1,-1),new we(0,2),new we(1,2)]),ge(re,1,[new we(0,0),new we(1,0),new we(1,-1),new we(0,2),new we(1,2)]),re),(oe={},ge(oe,-1,[new we(0,0),new we(-1,0),new we(-1,1),new we(0,-2),new we(-1,-2)]),ge(oe,1,[new we(0,0),new we(1,0),new we(1,1),new we(0,-2),new we(1,-2)]),oe),(ie={},ge(ie,-1,[new we(0,0),new we(-1,0),new we(-1,-1),new we(0,2),new we(-1,2)]),ge(ie,1,[new we(0,0),new we(-1,0),new we(-1,-1),new we(0,2),new we(-1,2)]),ie)]),Se=Object.freeze([(ae={},ge(ae,-1,[new we(0,0),new we(-1,0),new we(2,0),new we(-1,2),new we(2,-1)]),ge(ae,1,[new we(0,0),new we(-2,0),new we(1,0),new we(-2,-1),new we(1,2)]),ae),(ue={},ge(ue,-1,[new we(0,0),new we(2,0),new we(-1,0),new we(2,1),new we(-1,-2)]),ge(ue,1,[new we(0,0),new we(-1,0),new we(2,0),new we(-1,2),new we(2,-1)]),ue),(ce={},ge(ce,-1,[new we(0,0),new we(1,0),new we(-2,0),new we(1,-2),new we(-2,1)]),ge(ce,1,[new we(0,0),new we(2,0),new we(-1,0),new we(2,1),new we(-1,-2)]),ce),(le={},ge(le,-1,[new we(0,0),new we(-2,0),new we(1,0),new we(-2,-1),new we(1,2)]),ge(le,1,[new we(0,0),new we(1,0),new we(-2,0),new we(1,-2),new we(-2,1)]),le)]),Oe=Object.freeze([(fe={},ge(fe,-1,[new we(0,0)]),ge(fe,1,[new we(0,0)]),fe),(se={},ge(se,-1,[new we(0,0)]),ge(se,1,[new we(0,0)]),se),(pe={},ge(pe,-1,[new we(0,0)]),ge(pe,1,[new we(0,0)]),pe),(he={},ge(he,-1,[new we(0,0)]),ge(he,1,[new we(0,0)]),he)]),Pe=Object.freeze((ge(ye={},ve.None,{Rotations:[[]],WallKick:Oe}),ge(ye,ve.I,{Rotations:[[new we(0,2),new we(1,2),new we(2,2),new we(3,2)],[new we(2,0),new we(2,1),new we(2,2),new we(2,3)],[new we(0,1),new we(1,1),new we(2,1),new we(3,1)],[new we(1,0),new we(1,1),new we(1,2),new we(1,3)]],WallKick:Se}),ge(ye,ve.J,{Rotations:[[new we(0,2),new we(0,1),new we(1,1),new we(2,1)],[new we(2,2),new we(1,2),new we(1,1),new we(1,0)],[new we(0,1),new we(1,1),new we(2,1),new we(2,0)],[new we(0,0),new we(1,0),new we(1,1),new we(1,2)]],WallKick:me}),ge(ye,ve.L,{Rotations:[[new we(0,1),new we(1,1),new we(2,1),new we(2,2)],[new we(1,2),new we(1,1),new we(1,0),new we(2,0)],[new we(0,0),new we(0,1),new we(1,1),new we(2,1)],[new we(0,2),new we(1,2),new we(1,1),new we(1,0)]],WallKick:me}),ge(ye,ve.O,{Rotations:[[new we(0,0),new we(0,1),new we(1,0),new we(1,1)]],WallKick:Oe}),ge(ye,ve.S,{Rotations:[[new we(0,1),new we(1,1),new we(1,2),new we(2,2)],[new we(1,2),new we(1,1),new we(2,1),new we(2,0)],[new we(0,0),new we(1,0),new we(1,1),new we(2,1)],[new we(0,2),new we(0,1),new we(1,1),new we(1,0)]],WallKick:me}),ge(ye,ve.T,{Rotations:[[new we(0,1),new we(1,1),new we(1,2),new we(2,1)],[new we(1,2),new we(1,1),new we(2,1),new we(1,0)],[new we(0,1),new we(1,0),new we(1,1),new we(2,1)],[new we(1,2),new we(0,1),new we(1,1),new we(1,0)]],WallKick:me}),ge(ye,ve.Z,{Rotations:[[new we(0,2),new we(1,1),new we(1,2),new we(2,1)],[new we(2,2),new we(1,1),new we(2,1),new we(1,0)],[new we(0,1),new we(1,0),new we(1,1),new we(2,0)],[new we(1,2),new we(0,1),new we(1,1),new we(0,0)]],WallKick:me}),ge(ye,ve.Garbage,{Rotations:[[new we(0,0)]],WallKick:Oe}),ye));const ke=Pe;function Re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Te=function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Re(this,"listeners",[]),Re(this,"listenersOncer",[]),Re(this,"on",(function(e){return t.listeners.push(e),{dispose:function(){return t.off(e)}}})),Re(this,"once",(function(e){t.listenersOncer.push(e)})),Re(this,"off",(function(e){var n=t.listeners.indexOf(e);n>-1&&t.listeners.splice(n,1)})),Re(this,"emit",(function(e){if(t.listeners.forEach((function(t){return t(e)})),t.listenersOncer.length>0){var n=t.listenersOncer;t.listenersOncer=[],n.forEach((function(t){return t(e)}))}})),Re(this,"pipe",(function(e){return t.on((function(t){return e.emit(t)}))}))};Array.prototype.max||Object.defineProperty(Array.prototype,"max",{enumerable:!1,writable:!1,configurable:!1,value:function(){for(var e=this.length,t=this[this.length-1];e--;)this[e]>=t&&(t=this[e]);return t}}),Array.prototype.maxBy||Object.defineProperty(Array.prototype,"maxBy",{enumerable:!1,writable:!1,configurable:!1,value:function(e){for(var t=this.length,n=e(this[this.length-1]),r=this[this.length-1];t--;){var o=e(this[t]);o>=n&&(n=o,r=this[t])}return r}}),Array.prototype.min||Object.defineProperty(Array.prototype,"min",{enumerable:!1,writable:!1,configurable:!1,value:function(){for(var e=this.length,t=this[this.length-1];e--;)this[e]<=t&&(t=this[e]);return t}}),Array.prototype.minBy||Object.defineProperty(Array.prototype,"minBy",{enumerable:!1,writable:!1,configurable:!1,value:function(e){for(var t=this.length,n=e(this[this.length-1]),r=this[this.length-1];t--;){var o=e(this[t]);o<=n&&(n=o,r=this[t])}return r}}),Array.prototype.sum||Object.defineProperty(Array.prototype,"sum",{enumerable:!1,writable:!1,configurable:!1,value:function(){return this.reduce((function(e,t){return e+t}),0)}});const Ce=function(e){return function(){var t=e+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296}};function _e(e){return function(e){if(Array.isArray(e))return je(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return je(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return je(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function je(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ae(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Be(e,t,"get"))}function De(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,Be(e,t,"set"),n),n}function Be(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var Ge=new WeakMap,He=new WeakMap,Ie=new WeakMap,We=function(){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;if(Ee(this,e),Ge.set(this,{writable:!0,value:void 0}),He.set(this,{writable:!0,value:void 0}),Ie.set(this,{writable:!0,value:void 0}),n instanceof Array)return De(this,He,null),De(this,Ie,new Array(r+n.length).fill(ve.None)),(t=Ae(this,Ie)).splice.apply(t,[r,n.length].concat(_e(n))),void De(this,Ge,null);De(this,He,void 0===n?Math.floor(Math.random()*Math.pow(2,32)):n),De(this,Ge,Ce(Ae(this,He))),De(this,Ie,[])}var t,n,r;return t=e,(n=[{key:"Seed",get:function(){return Ae(this,He)}},{key:"generate",value:function(){if(null!==Ae(this,He)&&null!==Ae(this,Ge))for(var e=[ve.I,ve.J,ve.L,ve.O,ve.S,ve.T,ve.Z];e.length>0;){var t=Math.floor(Ae(this,Ge).call(this)*e.length)%e.length;Ae(this,Ie).push(e.splice(t,1)[0])}else Ae(this,Ie).push(ve.None)}},{key:"Get",value:function(e){for(;Ae(this,Ie).length<=e;)this.generate();return Ae(this,Ie)[e]}},{key:"GetRange",value:function(e,t){for(;Ae(this,Ie).length<=e+t;)this.generate();return Ae(this,Ie).slice(e,e+t)}}])&&xe(t.prototype,n),r&&xe(t,r),e}();function Me(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Fe,Ne=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:be.R0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:NaN,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:NaN,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:y.None,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;Me(this,e),this.Type=t,this.Rotation=n,r?this.Position=r:(this.Position=new we(4,21),this.Bottom=21,this.Left=Math.floor(5-this.Width/2)),this.LastActionTick=o,this.ActionCount=i,this.DropTick=a,this.LastAction=u,this.PieceIndex=c}var t,n,r;return t=e,r=[{key:"Spawn",value:function(t,n,r){return new e(t,void 0,void 0,n,0,n,void 0,r)}}],(n=[{key:"Clone",value:function(){return new e(this.Type,this.Rotation,this.Position.Clone(),this.LastActionTick,this.ActionCount,this.DropTick,this.LastAction,this.PieceIndex)}},{key:"InternalPoints",get:function(){return Pe[this.Type].Rotations[this.Rotation]}},{key:"Points",get:function(){var e=this;return Pe[this.Type].Rotations[this.Rotation].map((function(t){return t.Add(e.Position)}))}},{key:"InternalLeft",get:function(){return this.InternalPoints.map((function(e){return e.X})).min()}},{key:"InternalRight",get:function(){return this.InternalPoints.map((function(e){return e.X})).max()}},{key:"InternalTop",get:function(){return this.InternalPoints.map((function(e){return e.Y})).max()}},{key:"InternalBottom",get:function(){return this.InternalPoints.map((function(e){return e.Y})).min()}},{key:"Left",get:function(){return this.Position.X+this.InternalLeft},set:function(e){this.Position.X=e-this.InternalLeft}},{key:"Right",get:function(){return this.Position.X+this.InternalRight},set:function(e){this.Position.X=e-this.InternalRight}},{key:"Top",get:function(){return this.Position.Y+this.InternalTop},set:function(e){this.Position.Y=e-this.InternalTop}},{key:"Bottom",get:function(){return this.Position.Y+this.InternalBottom},set:function(e){this.Position.Y=e-this.InternalBottom}},{key:"Width",get:function(){return this.InternalRight-this.InternalLeft+1}},{key:"Height",get:function(){return this.InternalTop-this.InternalBottom+1}},{key:"Rotate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:de.CW;this.Rotation+=e;var t=Pe[this.Type].Rotations.length;this.Rotation>=t&&(this.Rotation=0),this.Rotation<0&&(this.Rotation=t-1)}}])&&Le(t.prototype,n),r&&Le(t,r),e}();function Ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.LineClear=0]="LineClear",e[e.TSpin=1]="TSpin",e[e.TSpinMini=2]="TSpinMini",e[e.PerfectClear=3]="PerfectClear"}(Fe||(Fe={}));const Xe=function(){function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.LinesCleared=t,this.Type=n,this.Combo=r,this.BackToBack=o}var t,n,r;return t=e,(n=[{key:"Clone",value:function(){return new e(this.LinesCleared,this.Type,this.Combo,this.BackToBack)}},{key:"Rating",get:function(){var e=Math.pow(1.1,this.LinesCleared.length);switch(this.Type){case Fe.PerfectClear:e*=1.5;case Fe.TSpin:e*=1.3;case Fe.TSpinMini:e*=1.1}return this.BackToBack&&(e*=1.1),this.Combo&&(e*=Math.pow(1.05,this.Combo)),e}},{key:"Garbage",get:function(){var e=0,t=0;switch(this.BackToBack&&e++,this.Combo){case 0:case 1:break;case 2:case 3:e+=1;break;case 4:case 5:e+=2;break;case 6:case 7:e+=3;break;case 8:case 9:case 10:e+=4;break;default:e+=5}if(this.Type===Fe.PerfectClear)t+=6;else if(this.Type===Fe.LineClear)switch(this.LinesCleared.length){case 0:case 1:break;case 2:e++;break;case 3:e+=2;break;default:e+=4}else this.Type===Fe.TSpinMini?e+=this.LinesCleared.length:this.Type===Fe.TSpin&&(e+=2*this.LinesCleared.length,this.BackToBack&&3===this.LinesCleared.length&&e++);return{Targeted:e,Universal:t}}},{key:"toString",value:function(){var e="",t="";switch(this.Combo>0&&(e+="".concat(this.Combo," REN ")),this.BackToBack&&(e+="Back-to-back "),this.Type){case Fe.PerfectClear:t+="Perfect Clear ";break;case Fe.TSpinMini:t+="T-Spin Mini ";break;case Fe.TSpin:t+="T-Spin "}if(this.Type!==Fe.PerfectClear)switch(this.LinesCleared.length){case 4:t+="Tetris ";break;case 3:t+="Triple ";break;case 2:t+="Double ";break;case 1:t+="Single "}return[e.trim(),t.trim()]}}])&&Ye(t.prototype,n),r&&Ye(t,r),e}();function ze(e){return e.Type===Fe.LineClear&&e.LinesCleared.length>=4||(e.Type===Fe.TSpin||e.Type===Fe.TSpinMini)&&e.LinesCleared.length>0}function Ve(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ue(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ue(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ke(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Qe(e,t,"get"))}function qe(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,Qe(e,t,"set"),n),n}function Qe(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function $e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Je(e,t,n){return t&&$e(e.prototype,t),n&&$e(e,n),e}function Ze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var et=function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:m,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:S,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7?arguments[7]:void 0,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,s=arguments.length>9&&void 0!==arguments[9]&&arguments[9],p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,y=arguments.length>12&&void 0!==arguments[12]&&arguments[12];Ze(this,e),this.Grid=new Array(40).fill(null).map((function(){return new Array(10).fill(ve.None)})),o&&o.forEach((function(e,n){return e.forEach((function(e,r){return t.Grid[n][r]=e}))})),this.GridWidth=i,this.GridHeight=a,this.PlayfieldHeight=u,this.Falling=c?c.Clone():null,this.Hold=l?l.Clone():null,this.BlockHold=s,this.TicksElapsed=f,this.PieceQueue=n,this.PieceIndex=r,this.Combo=p,this.LastAchievement=h,this.IsDead=y},tt=function(){function e(t,n){Ze(this,e),this.Type=t,this.PieceIndex=n}return Je(e,[{key:"Clone",value:function(){return new e(this.Type,this.PieceIndex)}}]),e}(),nt=new WeakMap,rt=new WeakMap,ot=new WeakMap;const it=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,f=arguments.length>8&&void 0!==arguments[8]&&arguments[8];if(Ze(this,e),nt.set(this,{writable:!0,value:void 0}),rt.set(this,{writable:!0,value:void 0}),ot.set(this,{writable:!0,value:void 0}),n instanceof et){var s=n;this.Grid=s.Grid,this.Grid=new Array(40).fill(null).map((function(){return new Array(10).fill(ve.None)})),s.Grid&&s.Grid.forEach((function(e,n){return e.forEach((function(e,r){return t.Grid[n][r]=e}))})),this.Falling=s.Falling,this.Hold=s.Hold,this.BlockHold=s.BlockHold,this.TicksElapsed=s.TicksElapsed,qe(this,nt,new We(s.PieceQueue,s.PieceIndex)),this.PieceIndex=s.PieceIndex,this.Combo=s.Combo,this.LastAchievement=s.LastAchievement,this.IsDead=s.IsDead}else this.Grid=new Array(40).fill(null).map((function(){return new Array(10).fill(ve.None)})),this.Falling=o,this.Hold=null!=i?i:null,this.BlockHold=u,this.TicksElapsed=a,qe(this,nt,new We(n)),this.PieceIndex=r,this.Combo=c,this.LastAchievement=l,this.IsDead=f;qe(this,rt,new Te),qe(this,ot,new Te)}return Je(e,[{key:"GetVisibleState",value:function(){var e;return new et(this.PieceQueue,this.PieceIndex,this.Grid,this.GridWidth,this.GridHeight,this.PlayfieldHeight,this.Falling,this.Hold,this.TicksElapsed,this.BlockHold,this.Combo,null===(e=this.LastAchievement)||void 0===e?void 0:e.Clone(),this.IsDead)}},{key:"Achievement",get:function(){return Ke(this,rt)}},{key:"Dead",get:function(){return Ke(this,ot)}},{key:"GridWidth",get:function(){return g}},{key:"GridHeight",get:function(){return m}},{key:"PlayfieldHeight",get:function(){return S}},{key:"PieceQueue",get:function(){return Ke(this,nt).GetRange(this.PieceIndex,6)}},{key:"Get",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(e instanceof we)t=e.X,n=e.Y;else{if(void 0===r)return null;t=e,n=r}return t<0||n<0||t>=g||n>=m?null:this.Grid[n][t]}},{key:"IsPieceValid",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return t?!t.Points.some((function(t){var n;return(null!==(n=e.Get(t))&&void 0!==n?n:ve.I)!==ve.None})):!this.Falling||!this.Falling.Points.some((function(t){var n;return(null!==(n=e.Get(t))&&void 0!==n?n:ve.I)!==ve.None}))}},{key:"HasHold",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return void 0===e?null!==this.Hold&&this.Hold.Type!==ve.None:null!==e&&e.Type!==ve.None}},{key:"DequeuePiece",value:function(){return null===this.Falling&&(this.Falling=Ne.Spawn(Ke(this,nt).Get(this.PieceIndex),this.TicksElapsed,this.PieceIndex),this.PieceIndex++,this.BlockHold=!1,!!this.IsPieceValid()||(this.IsDead=!0,Ke(this,ot).emit(),!1))}},{key:"HoldPiece",value:function(){if(null===this.Falling)return!1;if(this.BlockHold)return!1;var e=this.Hold;return this.Hold=new tt(this.Falling.Type,this.PieceIndex-1),this.HasHold(e)||(e=new tt(Ke(this,nt).Get(this.PieceIndex),this.PieceIndex),this.PieceIndex++),e&&(this.Falling=Ne.Spawn(e.Type,this.TicksElapsed,e.PieceIndex)),this.BlockHold=!0,this.Falling.LastAction=y.Hold,!0}},{key:"ClearLines",value:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,r=[],o=null;if((null==n?void 0:n.Type)===ve.T&&v(n.LastAction)){var i=[[0,0],[2,0],[0,2],[2,2]].reduce((function(e,r){var o=Ve(r,2),i=o[0],a=o[1];return t.Get(n.Position.X+i,n.Position.Y+a)!==ve.None?e+1:e}),0);if(i>=3){var a=[[1,0],[0,1],[1,2],[2,1]].some((function(e){var r=Ve(e,2),o=r[0],i=r[1];return!n.InternalPoints.find((function(e){return e.X===o&&e.Y===i}))&&t.Get(n.Position.X+o,n.Position.Y+i)!==ve.None}));o=a?Fe.TSpinMini:Fe.TSpin}}for(var u=this.GridHeight-1;u>=0;u--)this.Grid[u].some((function(e){return e===ve.None}))||(this.Grid.splice(u,1),this.Grid.push(new Array(this.GridWidth).fill(ve.None)),r.push(u));if(0===r.length){if(this.Combo=0,null===o)return}else r.length>1&&o===Fe.TSpinMini&&(o=Fe.TSpin);var c=new Xe(r,null!==(e=o)&&void 0!==e?e:Fe.LineClear,this.Combo,!!this.LastAchievement&&ze(this.LastAchievement));r.length>0&&this.Combo++,this.Grid.some((function(e){return e.some((function(e){return e!==ve.None}))}))||(c.Type=Fe.PerfectClear),c.BackToBack=ze(c)&&c.BackToBack;var l=c.Clone();Ke(this,rt).emit(c),this.LastAchievement=l}},{key:"LockPiece",value:function(){var e=this;if(null===this.Falling)return!1;for(;!this.IsPieceValid();)this.Falling.Position.Y++;return this.Falling.Points.forEach((function(t){var n,r;return e.Grid[t.Y][t.X]=null!==(n=null===(r=e.Falling)||void 0===r?void 0:r.Type)&&void 0!==n?n:ve.None})),this.ClearLines(this.Falling),this.Falling.Points.map((function(e){return e.Y})).min()>=this.PlayfieldHeight&&(this.IsDead=!0,Ke(this,ot).emit()),this.Falling=null,!0}},{key:"RotatePiece",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:de.CW;if(null===this.Falling)return!1;var n=Pe[this.Falling.Type].WallKick[this.Falling.Rotation][t].find((function(n){var r,o=null===(r=e.Falling)||void 0===r?void 0:r.Clone();return!!o&&(o.Rotate(t),o.Position=o.Position.Add(n),e.IsPieceValid(o))}));return!!n&&(this.Falling.Rotate(t),this.Falling.Position=this.Falling.Position.Add(n),this.Falling.LastActionTick=this.TicksElapsed,this.Falling.ActionCount++,this.Falling.LastAction=t===de.CW?y.RotateCW:y.RotateCCW,!0)}},{key:"ShiftPiece",value:function(e){if(null===this.Falling)return!1;var t=this.Falling.Clone();return t.Position.X+=e,!!this.IsPieceValid(t)&&(this.Falling=t,this.Falling.LastActionTick=this.TicksElapsed,this.Falling.ActionCount++,this.Falling.LastAction=e>0?y.ShiftRight:y.ShiftLeft,!0)}},{key:"CanPieceDrop",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(t)e=t.Clone();else{if(!this.Falling)return!1;e=this.Falling.Clone()}return e.Position.Y--,this.IsPieceValid(e)}},{key:"SoftDropPiece",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return null!==this.Falling&&(!!this.CanPieceDrop()&&(this.Falling.Position.Y--,this.Falling.LastActionTick=this.TicksElapsed,this.Falling.ActionCount=0,e?this.Falling.DropTick=this.TicksElapsed:this.Falling.LastAction=y.SoftDrop,!0))}},{key:"HardDropPiece",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(t)e=t;else{if(!this.Falling)return!1;e=this.Falling}for(var n=e.Position.Y;this.IsPieceValid(e);)e.Position.Y--;return e.Position.Y++,n!==e.Position.Y&&(e.LastAction=y.HardDrop),e!==this.Falling||this.LockPiece()}},{key:"Tick",value:function(){this.IsDead||(null===this.Falling?this.DequeuePiece():(this.TicksElapsed-this.Falling.DropTick>=15&&this.SoftDropPiece(!0),this.TicksElapsed-this.Falling.LastActionTick>=60&&!this.CanPieceDrop()&&this.LockPiece()),this.TicksElapsed++)}}]),e}();function at(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ut(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,lt(e,t,"get"))}function ct(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,lt(e,t,"set"),n),n}function lt(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var ft=new WeakMap,st=new WeakMap,pt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ft.set(this,{writable:!0,value:void 0}),st.set(this,{writable:!0,value:void 0}),ct(this,st,void 0===t?Math.floor(Math.random()*Math.pow(2,32)):t),ct(this,ft,Ce(ut(this,st)))}var t,n,r;return t=e,(n=[{key:"Seed",get:function(){return ut(this,st)}},{key:"Get",value:function(e){return Math.floor(ut(this,ft).call(this)*e)}}])&&at(t.prototype,n),r&&at(t,r),e}();function ht(e){return(ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yt(e,t,n){return(yt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Pt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function vt(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,dt(e,t,"get"))}function bt(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,dt(e,t,"set"),n),n}function dt(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function wt(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gt(e,t)}function gt(e,t){return(gt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Pt(e);if(t){var o=Pt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return St(this,n)}}function St(e,t){return!t||"object"!==ht(t)&&"function"!=typeof t?Ot(e):t}function Ot(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pt(e){return(Pt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function kt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Rt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Tt(e,t,n){return t&&Rt(e.prototype,t),n&&Rt(e,n),e}var Ct=function(){function e(t,n){kt(this,e),this.Lines=t,this.TickEnqueued=n}return Tt(e,[{key:"Clone",value:function(){return new e(this.Lines,this.TickEnqueued)}}]),e}(),_t=function(e){wt(n,e);var t=mt(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:m,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:S,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,p=arguments.length>9&&void 0!==arguments[9]&&arguments[9],h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,v=arguments.length>12&&void 0!==arguments[12]&&arguments[12],b=arguments.length>13&&void 0!==arguments[13]?arguments[13]:[];return kt(this,n),(e=t.call(this,r,o,i,a,u,c,l,f,s,p,h,y,v)).GarbageMeter=b.map((function(e){return e.Clone()})),e}return n}(et),jt=new WeakMap;const Et=function(e){wt(n,e);var t=mt(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,c=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s=arguments.length>8&&void 0!==arguments[8]&&arguments[8],p=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[],h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:void 0;if(kt(this,n),e=t.call(this,r,o,null!=i?i:void 0,a,u,c,l,f,s),jt.set(Ot(e),{writable:!0,value:void 0}),r instanceof _t){var y=r;e.GarbageMeter=y.GarbageMeter,bt(Ot(e),jt,null)}else e.GarbageMeter=p,bt(Ot(e),jt,new pt(h));return e}return Tt(n,[{key:"GetVisibleState",value:function(){var e;return new _t(this.PieceQueue,this.PieceIndex,this.Grid,this.GridWidth,this.GridHeight,this.PlayfieldHeight,this.Falling,this.Hold,this.TicksElapsed,this.BlockHold,this.Combo,null===(e=this.LastAchievement)||void 0===e?void 0:e.Clone(),this.IsDead,this.GarbageMeter)}},{key:"SpawnGarbageLines",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(vt(this,jt)){var t=new Array(this.GridWidth).fill(ve.Garbage);t[vt(this,jt).Get(this.GridWidth)]=ve.None;for(var n=0;n<e;n++)this.Grid.unshift(t.slice()),this.Grid.pop();if(this.Falling)for(;!this.IsPieceValid();)this.Falling.Position.Y++}}},{key:"CancelGarbage",value:function(e){for(;e>0||this.GarbageMeter.length>0;){var t=this.GarbageMeter.minBy((function(e){return e.TickEnqueued}));t.Lines>=e?(t.Lines-=e,e=0):(e-=t.Lines,this.GarbageMeter.splice(this.GarbageMeter.indexOf(t),1))}return e}},{key:"Tick",value:function(){var e=this;this.IsDead||(this.GarbageMeter.forEach((function(t){t.Lines<=0||e.TicksElapsed-t.TickEnqueued>=240&&e.SpawnGarbageLines(t.Lines)})),this.GarbageMeter=this.GarbageMeter.filter((function(t){return e.TicksElapsed-t.TickEnqueued<240&&t.Lines>0})),yt(Pt(n.prototype),"Tick",this).call(this))}}]),n}(it);var xt=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};function At(e){return(At="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Dt(e,t){return(Dt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Bt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ht(e);if(t){var o=Ht(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Gt(this,n)}}function Gt(e,t){return!t||"object"!==At(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ht(e){return(Ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var It=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Dt(e,t)}(n,e);var t=Bt(n);function n(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(e=t.call(this)).Participants=[],e}return n}(xt);function Wt(e){return(Wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Lt(e,t){return(Lt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Xt(e);if(t){var o=Xt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Nt(this,n)}}function Nt(e,t){return!t||"object"!==Wt(t)&&"function"!=typeof t?Yt(e):t}function Yt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xt(e){return(Xt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zt(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Ut(e,t,"get"))}function Vt(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,Ut(e,t,"set"),n),n}function Ut(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var Kt=new WeakMap,qt=new WeakMap,Qt=new WeakMap,$t=new WeakMap,Jt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Lt(e,t)}(i,e);var t,n,r,o=Ft(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),t=o.call(this),Kt.set(Yt(t),{writable:!0,value:void 0}),qt.set(Yt(t),{writable:!0,value:void 0}),Qt.set(Yt(t),{writable:!0,value:void 0}),$t.set(Yt(t),{writable:!0,value:void 0}),Vt(Yt(t),Kt,null),t.Participants=e.map((function(e){return{Player:e.player,State:e.seed instanceof Et?e.seed:new Et(e.seed)}})),t.Participants.map((function(e){return e.State})).forEach((function(e){return e.Achievement.on((function(n){var r=n.Garbage,o=t.Participants.map((function(e){return e.State})).filter((function(t){return t!==e}));o.forEach((function(e){return e.GarbageMeter.push(new Ct(r.Universal,e.TicksElapsed))}));var i=o.filter((function(e){return!e.IsDead})),a=i[Math.floor(Math.random()*i.length)];a&&a.GarbageMeter.push(new Ct(r.Targeted,a.TicksElapsed))}))})),Vt(Yt(t),qt,new Te),Vt(Yt(t),Qt,!1),Vt(Yt(t),$t,new Te),t}return t=i,(n=[{key:"IsGameEnded",get:function(){return!!zt(this,Qt)||this.Participants.filter((function(e){return!e.State.IsDead})).length<=1&&(Vt(this,Qt,!0),!0)}},{key:"Input",get:function(){return zt(this,qt)}},{key:"GameEnded",get:function(){return zt(this,$t)}},{key:"ClockRunning",get:function(){return null!==zt(this,Kt)}},{key:"StartClock",value:function(){Vt(this,Kt,window.setInterval(this.Tick.bind(this),1e3/60))}},{key:"StopClock",value:function(){null!==zt(this,Kt)&&window.clearInterval(zt(this,Kt))}},{key:"Tick",value:function(){var e=this;this.Participants.forEach((function(t){if(!t.State.IsDead&&(t.State.Tick(),!t.State.IsDead)){var n=t.Player.Tick(t.State.GetVisibleState()),r=t.State.Falling,o=!1;switch(n){case y.None:break;case y.HardDrop:o=t.State.HardDropPiece();break;case y.Hold:o=t.State.HoldPiece();break;case y.RotateCW:o=t.State.RotatePiece(de.CW);break;case y.RotateCCW:o=t.State.RotatePiece(de.CCW);break;case y.ShiftLeft:o=t.State.ShiftPiece(-1);break;case y.ShiftRight:o=t.State.ShiftPiece(1);break;case y.SoftDrop:o=t.State.SoftDropPiece(!1)}n!==y.None&&zt(e,qt).emit(new b(t.State.TicksElapsed,n,o,r,t.Player))}})),!zt(this,Qt)&&this.IsGameEnded&&zt(this,$t).emit()}}])&&Mt(t.prototype,n),r&&Mt(t,r),i}(It);function Zt(e){return(Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function en(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nn(e,t){return(nn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function rn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=an(e);if(t){var o=an(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return on(this,n)}}function on(e,t){return!t||"object"!==Zt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function an(e){return(an=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function un(e){return function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nn(e,t)}(i,e);var t,n,r,o=rn(i);function i(){var e;en(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=o.call.apply(o,[this].concat(n))).State=null,e}return t=i,(n=[{key:"ConfigureGameState",value:function(e){this.State=e}}])&&tn(t.prototype,n),r&&tn(t,r),i}(e)}function cn(e){return(cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ln(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function sn(e,t){return(sn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=yn(e);if(t){var o=yn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return hn(this,n)}}function hn(e,t){return!t||"object"!==cn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function yn(e){return(yn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function vn(e){return function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&sn(e,t)}(i,e);var t,n,r,o=pn(i);function i(){var e;ln(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=o.call.apply(o,[this].concat(n))).Player=null,e}return t=i,(n=[{key:"ConfigurePlayer",value:function(e){this.Player=e}}])&&fn(t.prototype,n),r&&fn(t,r),i}(e)}function bn(e){return(bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function wn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function gn(e,t){return(gn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=On(e);if(t){var o=On(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Sn(this,n)}}function Sn(e,t){return!t||"object"!==bn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function On(e){return(On=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pn(e){return function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gn(e,t)}(i,e);var t,n,r,o=mn(i);function i(){var e;dn(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=o.call.apply(o,[this].concat(n))).Game=null,e}return t=i,(n=[{key:"ConfigureGame",value:function(e){this.Game=e}}])&&wn(t.prototype,n),r&&wn(t,r),i}(e)}function kn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Rn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Tn,Cn,_n,jn=function(){function e(t,n,r,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.Linear;kn(this,e),this.From=t,this.To=n,this.Duration=r,this.Data=o,this.Elapsed=i,this.EasingFunction=a}var t,n,r;return t=e,r=[{key:"Linear",value:function(e){return e}},{key:"EaseOutQuint",value:function(e){return 1-Math.pow(1-e,5)}},{key:"EaseInOutSine",value:function(e){return-(Math.cos(Math.PI*e)-1)/2}},{key:"RevertingFunction",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.EaseInOutSine,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;return function(e){return e<=n?t(e/n):e>=1-n?t((1-e)/n):1}}}],(n=[{key:"CurrentValue",get:function(){return this.From+(this.To-this.From)*this.EasingFunction(this.Elapsed/this.Duration)}},{key:"Finished",get:function(){return this.Elapsed>=this.Duration}},{key:"Tick",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.Elapsed+=e}}])&&Rn(t.prototype,n),r&&Rn(t,r),e}();function En(e){return(En="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function An(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Dn(e,t,n){return(Dn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=In(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Bn(e,t){return(Bn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Gn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=In(e);if(t){var o=In(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Hn(this,n)}}function Hn(e,t){return!t||"object"!==En(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function In(e){return(In=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Wn(e){return"ConfigurePlayfieldAnimatable"in e}function Mn(e){return function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Bn(e,t)}(i,e);var t,n,r,o=Gn(i);function i(){var e;xn(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=o.call.apply(o,[this].concat(n))).HardDropAnimations=[],e.LineClearAnimations=[],e}return t=i,(n=[{key:"ConfigurePlayfieldAnimatable",value:function(){var e=this;null!==this.State?null!==this.Game?null!==this.Player?(this.Game.Input.on((function(t){t.Player===e.Player&&t.Input===y.HardDrop&&t.Success&&t.Falling&&e.HardDropAnimations.push(new jn(1,0,20,{left:t.Falling.Left,right:t.Falling.Right,end:t.Falling.Top,type:t.Falling.Type},0,jn.EaseOutQuint))})),this.State.Achievement.on((function(t){var n=0;t.LinesCleared.forEach((function(t){e.LineClearAnimations.filter((function(e){return e.Data.Y>t})).forEach((function(e){return e.Data.Y--})),e.LineClearAnimations.push(new jn(1,0,20+n,{Y:t,OrigY:t},0,jn.EaseOutQuint)),n+=4}))}))):console.error("ConfigurePlayfieldAnimatable called before this.Player is assigned. Beware of the call order of Configure_ functions."):console.error("ConfigurePlayfieldAnimatable called before this.Game is assigned. Beware of the call order of Configure_ functions."):console.error("ConfigurePlayfieldAnimatable called before this.State is assigned. Beware of the call order of Configure_ functions.")}},{key:"p5Draw",value:function(e){Dn(In(i.prototype),"p5Draw",this).call(this,e),this.HardDropAnimations.forEach((function(e){return e.Tick()})),this.HardDropAnimations=this.HardDropAnimations.filter((function(e){return!e.Finished})),this.LineClearAnimations.forEach((function(e){return e.Tick()})),this.LineClearAnimations=this.LineClearAnimations.filter((function(e){return!e.Finished}))}}])&&An(t.prototype,n),r&&An(t,r),i}(e)}function Ln(e,t){return e.setAlpha(t),e}function Fn(e,t){switch(t){case ve.None:return e.color(50);case ve.I:return e.color(77,208,225);case ve.J:return e.color(33,150,243);case ve.L:return e.color(255,152,0);case ve.O:return e.color(253,216,53);case ve.S:return e.color(76,175,80);case ve.T:return e.color(224,64,251);case ve.Z:return e.color(229,115,115);case ve.Garbage:return e.color(150)}}function Nn(e,t,n,r,o,i){e.fill(Ln(Fn(e,null!=t?t:ve.None),i)),r.forEach((function(t){e.rect(n.X+t.X*o,n.Y+t.Y*o,o,o)}))}function Yn(e,t,n,r,o,i){e.push(),e.scale(1,-1),e.text(t,n,-r,o,void 0===i?i:-i),e.pop()}function Xn(e){return void 0!==Object.keys(Cn).find((function(t){return t===e}))}function zn(e){return void 0!==Object.keys(_n).find((function(t){return t===e}))}function Vn(e){if(e instanceof b)switch(e.Input){case y.None:return null;case y.HardDrop:return Tn.Lock;case y.RotateCCW:case y.RotateCW:return e.Success?Tn.RotateSuccess:Tn.RotateFail;case y.ShiftLeft:case y.ShiftRight:return e.Success?Tn.ShiftSuccess:Tn.ShiftFail;case y.SoftDrop:return Tn.SoftDrop;case y.Hold:return e.Success?Tn.Hold:null}if(e instanceof Xe){var t=[];if(e.Combo>0){var n="Combo".concat(Math.min(20,e.Combo));Xn(n)&&t.push(Cn[n])}if(e.Type===Fe.PerfectClear)return t.push(Cn.PerfectClear),t;var r="";return e.BackToBack&&(r+="B2b"),e.Type===Fe.TSpinMini?r+="TSpinMini":(e.Type===Fe.TSpin&&(r+="TSpin"),1===e.LinesCleared.length?r+="Single":2===e.LinesCleared.length?r+="Double":3===e.LinesCleared.length?r+="Triple":4===e.LinesCleared.length&&(r+="Tetris")),(Xn(r)||r.startsWith("B2b")&&Xn(r=r.substr(3)))&&t.push(Cn[r]),t}return null}function Un(e){return(Un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Kn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qn(e,t,n){return(Qn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=tr(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function $n(e,t){return($n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Jn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=tr(e);if(t){var o=tr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Zn(this,n)}}function Zn(e,t){return!t||"object"!==Un(t)&&"function"!=typeof t?er(e):t}function er(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tr(e){return(tr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nr(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,or(e,t,"get"))}function rr(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,or(e,t,"set"),n),n}function or(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function ir(e){var t,n,r;return t=new WeakMap,n=new WeakMap,r=new WeakMap,function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$n(e,t)}(c,e);var o,i,a,u=Jn(c);function c(){var e;Kn(this,c);for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),t.set(er(e),{writable:!0,value:void 0}),n.set(er(e),{writable:!0,value:void 0}),r.set(er(e),{writable:!0,value:void 0}),rr(er(e),t,new we(0,0)),rr(er(e),n,new we(1,1)),rr(er(e),r,null),e}return o=c,(i=[{key:"ConfigurePlayfieldDrawable",value:function(e,r){rr(this,t,e),rr(this,n,r)}},{key:"p5Setup",value:function(e,t){Qn(tr(c.prototype),"p5Setup",this).call(this,e,t),this.State&&rr(this,r,e.createGraphics(this.State.GridWidth*this.BlockSize,(this.State.PlayfieldHeight+.1)*this.BlockSize))}},{key:"p5Draw",value:function(e){var o=this;if(Qn(tr(c.prototype),"p5Draw",this).call(this,e),null!==this.State){this.SetTransform(e,nr(this,n).X,nr(this,n).Y,nr(this,t).X,nr(this,t).Y);var i=this.State,a=this.BlockSize;if(nr(this,r)){var u=nr(this,r);if(i){u.background(50),u.stroke(0,0,0,100);for(var l=0;l<=i.GridHeight;l++)u.line(0,l*a,i.GridWidth*a,l*a);for(var f=0;f<=i.GridWidth;f++)u.line(f*a,0,f*a,i.GridHeight*a);Wn(this)&&(u.noStroke(),this.HardDropAnimations.forEach((function(e){u.fill(Ln(Fn(u,e.Data.type),20)),u.rect(e.Data.left*a,e.Data.end*a,(e.Data.right-e.Data.left+1)*a,(i.PlayfieldHeight-e.Data.end)*e.CurrentValue*a)}))),u.stroke(0,0,0,150);var s=null;if(Wn(this)){s=[];for(var p=function(e){s.push(e+o.LineClearAnimations.filter((function(t){return t.Data.Y<=e})).reduce((function(e,t){return e+t.CurrentValue}),0))},h=0;h<i.GridHeight;h++)p(h)}for(var y=0;y<i.GridHeight;y++)for(var v=0;v<i.GridWidth;v++){var b,d=null!==(b=i.Get(v,y))&&void 0!==b?b:ve.None;d!==ve.None&&(u.fill(Fn(u,d)),u.rect(v*a,P(y)*a,a,a))}if(i.Falling){var w,g,m=i.Falling.Points.map((function(e){return new we(e.X,P(e.Y))}));Nn(u,null===(w=i.Falling)||void 0===w?void 0:w.Type,new we(0,0),m,a,255);var S=i.Falling.Clone();i.HardDropPiece(S);var O=S.Points.map((function(e){return new we(e.X,P(e.Y))}));Nn(u,null===(g=i.Falling)||void 0===g?void 0:g.Type,new we(0,0),O,a,50)}Wn(this)&&(u.noStroke(),u.fill(255,255,255,100),this.LineClearAnimations.forEach((function(e){u.rect(0,e.Data.OrigY*a,i.GridWidth*a/2*e.CurrentValue,a),u.rect(i.GridWidth*a,e.Data.OrigY*a,-i.GridWidth*a/2*e.CurrentValue,a)}))),e.image(u,0,0)}}}function P(e){return null===s?e:s[e]}}}])&&qn(o.prototype,i),a&&qn(o,a),c}(e)}function ar(e){return(ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ur(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function lr(e,t,n){return(lr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=yr(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function fr(e,t){return(fr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function sr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=yr(e);if(t){var o=yr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return pr(this,n)}}function pr(e,t){return!t||"object"!==ar(t)&&"function"!=typeof t?hr(e):t}function hr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yr(e){return(yr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function vr(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,dr(e,t,"get"))}function br(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,dr(e,t,"set"),n),n}function dr(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function wr(e){var t,n;return t=new WeakMap,n=new WeakMap,function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fr(e,t)}(u,e);var r,o,i,a=sr(u);function u(){var e;ur(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return e=a.call.apply(a,[this].concat(o)),t.set(hr(e),{writable:!0,value:void 0}),n.set(hr(e),{writable:!0,value:void 0}),br(hr(e),t,new we(0,0)),br(hr(e),n,new we(1,1)),e}return r=u,(o=[{key:"ConfigureHoldPieceDrawable",value:function(e,r){br(this,t,e),br(this,n,r)}},{key:"p5Draw",value:function(e){if(lr(yr(u.prototype),"p5Draw",this).call(this,e),null!==this.State){this.SetTransform(e,vr(this,n).X,vr(this,n).Y,vr(this,t).X,vr(this,t).Y);var r=this.State,o=this.BlockSize;if(e.fill(50),e.rect(0,0,5*o,6*o),e.noStroke(),e.fill(255),e.textAlign(e.CENTER),e.textSize(15),Yn(e,"HOLD",2.5*o,5*o),e.textAlign(e.LEFT),e.stroke(0),r.Hold){var i=ke[r.Hold.Type].Rotations[0].slice(),a=i.map((function(e){return e.X})),c=i.map((function(e){return e.Y})),l=a.max()-a.min()+1,f=c.max()-c.min()+1;Nn(e,r.Hold.Type,new we((2.5-l/2)*o,(2.5-f/2-c.min())*o),i,o,255)}}}}])&&cr(r.prototype,o),i&&cr(r,i),u}(e)}function gr(e){return(gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Sr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Or(e,t,n){return(Or="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Cr(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Pr(e,t){return(Pr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function kr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Cr(e);if(t){var o=Cr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Rr(this,n)}}function Rr(e,t){return!t||"object"!==gr(t)&&"function"!=typeof t?Tr(e):t}function Tr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Cr(e){return(Cr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _r(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Er(e,t,"get"))}function jr(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,Er(e,t,"set"),n),n}function Er(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function xr(e){var t,n;return t=new WeakMap,n=new WeakMap,function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pr(e,t)}(u,e);var r,o,i,a=kr(u);function u(){var e;mr(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return e=a.call.apply(a,[this].concat(o)),t.set(Tr(e),{writable:!0,value:void 0}),n.set(Tr(e),{writable:!0,value:void 0}),jr(Tr(e),t,new we(0,0)),jr(Tr(e),n,new we(1,1)),e}return r=u,(o=[{key:"ConfigurePieceQueueDrawable",value:function(e,r){jr(this,t,e),jr(this,n,r)}},{key:"p5Draw",value:function(e){if(Or(Cr(u.prototype),"p5Draw",this).call(this,e),null!==this.State){this.SetTransform(e,_r(this,n).X,_r(this,n).Y,_r(this,t).X,_r(this,t).Y);for(var r=this.State,o=this.BlockSize,i=0,a=r.PieceQueue.length-1;a>=0;a--){var c=ke[r.PieceQueue[a]].Rotations[0].slice(),l=c.map((function(e){return e.X})),f=c.map((function(e){return e.Y})),s=f.max()-f.min()+1,p=l.max()-l.min()+1;Nn(e,r.PieceQueue[a],new we((2-p/2)*o,i-f.min()*o),c,o,255),i+=(s+1)*o}}}}])&&Sr(r.prototype,o),i&&Sr(r,i),u}(e)}function Ar(e){return(Ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Dr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Br(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gr(e,t,n){return(Gr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Lr(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Hr(e,t){return(Hr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ir(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Lr(e);if(t){var o=Lr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Wr(this,n)}}function Wr(e,t){return!t||"object"!==Ar(t)&&"function"!=typeof t?Mr(e):t}function Mr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Lr(e){return(Lr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fr(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Yr(e,t,"get"))}function Nr(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,Yr(e,t,"set"),n),n}function Yr(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function Xr(e){var t,n;return t=new WeakMap,n=new WeakMap,function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Hr(e,t)}(u,e);var r,o,i,a=Ir(u);function u(){var e;Dr(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return e=a.call.apply(a,[this].concat(o)),t.set(Mr(e),{writable:!0,value:void 0}),n.set(Mr(e),{writable:!0,value:void 0}),Nr(Mr(e),t,new we(0,0)),Nr(Mr(e),n,new we(1,1)),e}return r=u,(o=[{key:"ConfigureFramerateDrawable",value:function(e,r){Nr(this,t,e),Nr(this,n,r)}},{key:"p5Draw",value:function(e){Gr(Lr(u.prototype),"p5Draw",this).call(this,e),this.SetTransform(e,Fr(this,n).X,Fr(this,n).Y,Fr(this,t).X,Fr(this,t).Y),e.noStroke(),e.fill(0),Yn(e,"FPS: ".concat(e.frameRate().toFixed(2)),0,0)}}])&&Br(r.prototype,o),i&&Br(r,i),u}(e)}function zr(e){return(zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Vr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ur(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Kr(e,t,n){return(Kr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Jr(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function qr(e,t){return(qr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Jr(e);if(t){var o=Jr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return $r(this,n)}}function $r(e,t){return!t||"object"!==zr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Jr(e){return(Jr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zr(e){return function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qr(e,t)}(i,e);var t,n,r,o=Qr(i);function i(){var e;Vr(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=o.call.apply(o,[this].concat(n))).keyHold=y.None,e.keyDelay=0,e}return t=i,(n=[{key:"p5Draw",value:function(e){Kr(Jr(i.prototype),"p5Draw",this).call(this,e),this.keyHold!==y.None&&this.Player instanceof ee&&(this.keyDelay<=0&&(this.Player.Enqueue(this.keyHold),this.keyDelay=3),this.keyDelay--)}},{key:"p5KeyPressed",value:function(e){this.Player instanceof ee&&(e.keyCode===e.LEFT_ARROW&&(this.keyHold=y.ShiftLeft),e.keyCode===e.RIGHT_ARROW&&(this.keyHold=y.ShiftRight),e.keyCode===e.UP_ARROW&&(this.keyHold=y.RotateCW),e.keyCode===e.CONTROL&&(this.keyHold=y.RotateCCW),e.keyCode===e.DOWN_ARROW&&(this.keyHold=y.SoftDrop),e.keyCode===e.SHIFT&&(this.keyHold=y.Hold)," "===e.key&&(this.keyHold=y.HardDrop),this.Player.Enqueue(this.keyHold),this.keyDelay=10)}},{key:"p5KeyReleased",value:function(e){if(this.Player instanceof ee){var t=y.None;e.keyCode===e.LEFT_ARROW&&(t=y.ShiftLeft),e.keyCode===e.RIGHT_ARROW&&(t=y.ShiftRight),e.keyCode===e.UP_ARROW&&(t=y.RotateCW),e.keyCode===e.CONTROL&&(t=y.RotateCCW),e.keyCode===e.DOWN_ARROW&&(t=y.SoftDrop),e.keyCode===e.SHIFT&&(t=y.Hold)," "===e.key&&(t=y.HardDrop),this.keyHold===t&&(this.keyHold=y.None)}}},{key:"KeyPressedHandler",get:function(){return this.p5KeyPressed.bind(this)}},{key:"KeyReleasedHandler",get:function(){return this.p5KeyReleased.bind(this)}}])&&Ur(t.prototype,n),r&&Ur(t,r),i}(e)}function eo(e){return(eo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function to(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function no(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ro(e,t){return(ro=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ao(e);if(t){var o=ao(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return io(this,n)}}function io(e,t){return!t||"object"!==eo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ao(e){return(ao=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function uo(e){return function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ro(e,t)}(i,e);var t,n,r,o=oo(i);function i(){var e;to(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=o.call.apply(o,[this].concat(n))).blockSize=O,e}return t=i,(n=[{key:"BlockSize",get:function(){return this.blockSize}},{key:"ConfigureBlockSize",value:function(e){this.blockSize=e}}])&&no(t.prototype,n),r&&no(t,r),i}(e)}!function(e){e.Lock="assets/sfx/sfx_lockdown.wav",e.RotateSuccess="assets/sfx/sfx_rotate.wav",e.RotateFail="assets/sfx/sfx_rotatefail.wav",e.ShiftSuccess="assets/sfx/sfx_move.wav",e.ShiftFail="assets/sfx/sfx_movefail.wav",e.SoftDrop="assets/sfx/sfx_softdrop.wav",e.Hold="assets/sfx/sfx_hold.wav"}(Tn||(Tn={})),function(e){e.Single="assets/sfx/sfx_single.wav",e.Double="assets/sfx/sfx_double.wav",e.Triple="assets/sfx/sfx_triple.wav",e.Tetris="assets/sfx/sfx_tetris.wav",e.TSpin="assets/sfx/sfx_tspin_zero.wav",e.TSpinMini="assets/sfx/sfx_tspin_mini.wav",e.TSpinSingle="assets/sfx/sfx_tspin_single.wav",e.TSpinDouble="assets/sfx/sfx_tspin_double.wav",e.TSpinTriple="assets/sfx/sfx_tspin_triple.wav",e.B2bTSpinMini="assets/sfx/sfx_b2b_tspin_mini.wav",e.B2bTSpinSingle="assets/sfx/sfx_b2b_tspin_single.wav",e.B2bTSpinDouble="assets/sfx/sfx_b2b_tspin_double.wav",e.B2bTSpinTriple="assets/sfx/sfx_b2b_tspin_triple.wav",e.B2bTetris="assets/sfx/sfx_b2b_tetris.wav",e.PerfectClear="assets/sfx/sfx_perfectclear.wav",e.Combo1="assets/sfx/sfx_combo1.wav",e.Combo2="assets/sfx/sfx_combo2.wav",e.Combo3="assets/sfx/sfx_combo3.wav",e.Combo4="assets/sfx/sfx_combo4.wav",e.Combo5="assets/sfx/sfx_combo5.wav",e.Combo6="assets/sfx/sfx_combo6.wav",e.Combo7="assets/sfx/sfx_combo7.wav",e.Combo8="assets/sfx/sfx_combo8.wav",e.Combo9="assets/sfx/sfx_combo9.wav",e.Combo10="assets/sfx/sfx_combo10.wav",e.Combo11="assets/sfx/sfx_combo11.wav",e.Combo12="assets/sfx/sfx_combo12.wav",e.Combo13="assets/sfx/sfx_combo13.wav",e.Combo14="assets/sfx/sfx_combo14.wav",e.Combo15="assets/sfx/sfx_combo15.wav",e.Combo16="assets/sfx/sfx_combo16.wav",e.Combo17="assets/sfx/sfx_combo17.wav",e.Combo18="assets/sfx/sfx_combo18.wav",e.Combo19="assets/sfx/sfx_combo19.wav",e.Combo20="assets/sfx/sfx_combo20.wav",e.GameOver="assets/sfx/sfx_gameover.wav"}(Cn||(Cn={})),function(e){e.Single="assets/voice/voice_single.wav",e.Double="assets/voice/voice_double.wav",e.Triple="assets/voice/voice_triple.wav",e.Tetris="assets/voice/voice_tetris.wav",e.TSpin="assets/voice/voice_tspin.wav",e.TSpinMini="assets/voice/voice_tspinmini.wav",e.TSpinSingle="assets/voice/voice_tspinsingle.wav",e.TSpinDouble="assets/voice/voice_tspindouble.wav",e.TSpinTriple="assets/voice/voice_tspintriple.wav",e.B2bTSpinMini="assets/voice/voice_b2btspinmini.wav",e.B2bTSpinSingle="assets/voice/voice_b2btspinsingle.wav",e.B2bTSpinDouble="assets/voice/voice_b2btspindouble.wav",e.B2bTSpinTriple="assets/voice/voice_b2btspintriple.wav",e.B2bTetris="assets/voice/voice_b2btetris.wav",e.PerfectClear="assets/voice/voice_perfectclear.wav",e.Combo1="assets/voice/voice_combo01.wav",e.Combo2="assets/voice/voice_combo02.wav",e.Combo3="assets/voice/voice_combo03.wav",e.Combo4="assets/voice/voice_combo04.wav",e.Combo5="assets/voice/voice_combo05.wav"}(_n||(_n={}));var co=n(766);function lo(e){return(lo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return so(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return so(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function so(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function po(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ho(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function yo(e,t,n){return(yo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=mo(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function vo(e,t){return(vo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function bo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return wo(this,n)}}function wo(e,t){return!t||"object"!==lo(t)&&"function"!=typeof t?go(e):t}function go(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mo(e){return(mo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function So(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Po(e,t,"get"))}function Oo(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,Po(e,t,"set"),n),n}function Po(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function ko(e){var t,n,r;return t=new WeakMap,n=new WeakMap,r=new WeakMap,function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vo(e,t)}(c,e);var o,i,a,u=bo(c);function c(){var e;po(this,c);for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return e=u.call.apply(u,[this].concat(i)),t.set(go(e),{writable:!0,value:void 0}),n.set(go(e),{writable:!0,value:void 0}),r.set(go(e),{writable:!0,value:void 0}),Oo(go(e),n,new Map),Oo(go(e),t,null),Oo(go(e),r,.5),e}return o=c,(i=[{key:"ConfigurePlayerSfxPlayable",value:function(e){var o=this;Oo(this,r,e),null!==this.Game?null!==this.Player?this.Game.Input.on((function(e){var r;if(e.Player===o.Player){var i=So(o,t);if(Oo(o,t,null!=e?e:null),!(i&&e.Tick-i.Tick<=4&&e.Success===i.Success&&e.Input===i.Input)){var a=Vn(e);a&&(null===(r=So(o,n).get(a))||void 0===r||r.play())}}})):console.error("ConfigurePlayerSfxPlayable called before this.Player is assigned. Beware of the call order of Configure_ functions."):console.error("ConfigurePlayerSfxPlayable called before this.Game is assigned. Beware of the call order of Configure_ functions.")}},{key:"p5Setup",value:function(e,t){var o=this;yo(mo(c.prototype),"p5Setup",this).call(this,e,t),Object.entries(Tn).forEach((function(e){var t=fo(e,2)[1];return So(o,n).set(t,new co.Howl({src:[t],volume:So(o,r)}))}))}}])&&ho(o.prototype,i),a&&ho(o,a),c}(e)}function Ro(e){return(Ro="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function To(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Co(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Co(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Co(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function jo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Eo(e,t,n){return(Eo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Go(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function xo(e,t){return(xo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ao(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Go(e);if(t){var o=Go(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Do(this,n)}}function Do(e,t){return!t||"object"!==Ro(t)&&"function"!=typeof t?Bo(e):t}function Bo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Go(e){return(Go=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ho(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Wo(e,t,"get"))}function Io(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,Wo(e,t,"set"),n),n}function Wo(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function Mo(e){var t,n;return t=new WeakMap,n=new WeakMap,function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xo(e,t)}(u,e);var r,o,i,a=Ao(u);function u(){var e;_o(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return e=a.call.apply(a,[this].concat(o)),t.set(Bo(e),{writable:!0,value:void 0}),n.set(Bo(e),{writable:!0,value:void 0}),Io(Bo(e),t,new Map),Io(Bo(e),n,.5),e}return r=u,(o=[{key:"ConfigureGameEventSfxPlayable",value:function(e){var r=this;Io(this,n,e),null!==this.State?(this.State.Achievement.on((function(e){var n=Vn(e);n&&n.forEach((function(e){var n;return null===(n=Ho(r,t).get(e))||void 0===n?void 0:n.play()}))})),this.State.Dead.on((function(){var e;null===(e=Ho(r,t).get(Cn.GameOver))||void 0===e||e.play()}))):console.error("ConfigureGameEventSfxPlayable called before this.State is assigned. Beware of the call order of Configure_ functions.")}},{key:"p5Setup",value:function(e,r){var o=this;Eo(Go(u.prototype),"p5Setup",this).call(this,e,r),Object.entries(Cn).forEach((function(e){var r=To(e,2)[1];return Ho(o,t).set(r,new co.Howl({src:[r],volume:Ho(o,n)}))}))}}])&&jo(r.prototype,o),i&&jo(r,i),u}(e)}function Lo(e){return(Lo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return No(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return No(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function No(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Yo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zo(e,t,n){return(zo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Qo(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Vo(e,t){return(Vo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Uo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Qo(e);if(t){var o=Qo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ko(this,n)}}function Ko(e,t){return!t||"object"!==Lo(t)&&"function"!=typeof t?qo(e):t}function qo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qo(e){return(Qo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $o(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Zo(e,t,"get"))}function Jo(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,Zo(e,t,"set"),n),n}function Zo(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function ei(e){var t,n;return t=new WeakMap,n=new WeakMap,function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Vo(e,t)}(u,e);var r,o,i,a=Uo(u);function u(){var e;Yo(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return e=a.call.apply(a,[this].concat(o)),t.set(qo(e),{writable:!0,value:void 0}),n.set(qo(e),{writable:!0,value:void 0}),Jo(qo(e),t,new Map),Jo(qo(e),n,.5),e}return r=u,(o=[{key:"ConfigureGameEventVoicePlayable",value:function(e){var r=this;Jo(this,n,e),null!==this.State?this.State.Achievement.on((function(e){var n,o=function(e){if(e.Type===Fe.PerfectClear)return _n.PerfectClear;var t="";if(e.BackToBack&&(t+="B2b"),e.Type===Fe.TSpinMini?t+="TSpinMini":(e.Type===Fe.TSpin&&(t+="TSpin"),1===e.LinesCleared.length?t+="Single":2===e.LinesCleared.length?t+="Double":3===e.LinesCleared.length?t+="Triple":4===e.LinesCleared.length&&(t+="Tetris")),zn(t)&&"Single"!==t)return _n[t];if(t.startsWith("B2b")&&zn(t=t.substr(3)))return _n[t];if(e.Combo>0){var n="Combo".concat(Math.min(5,e.Combo));if(zn(n))return _n[n]}return null}(e);o&&(null===(n=$o(r,t).get(o))||void 0===n||n.play())})):console.error("ConfigureGameEventVoicePlayable called before this.State is assigned. Beware of the call order of Configure_ functions.")}},{key:"p5Setup",value:function(e,r){var o=this;zo(Qo(u.prototype),"p5Setup",this).call(this,e,r),Object.entries(_n).forEach((function(e){var r=Fo(e,2)[1];return $o(o,t).set(r,new co.Howl({src:[r],volume:$o(o,n)}))}))}}])&&Xo(r.prototype,o),i&&Xo(r,i),u}(e)}function ti(e){return(ti="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ni(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ri(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ri(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ri(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function oi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ii(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ai(e,t,n){return(ai="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=si(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function ui(e,t){return(ui=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ci(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=si(e);if(t){var o=si(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return li(this,n)}}function li(e,t){return!t||"object"!==ti(t)&&"function"!=typeof t?fi(e):t}function fi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function si(e){return(si=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pi(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,yi(e,t,"get"))}function hi(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,yi(e,t,"set"),n),n}function yi(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function vi(e){var t,n;return t=new WeakMap,n=new WeakMap,function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ui(e,t)}(u,e);var r,o,i,a=ci(u);function u(){var e;oi(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return e=a.call.apply(a,[this].concat(o)),t.set(fi(e),{writable:!0,value:void 0}),n.set(fi(e),{writable:!0,value:void 0}),e.GameEventAnimation=null,hi(fi(e),t,new we(0,0)),hi(fi(e),n,new we(1,1)),e}return r=u,(o=[{key:"ConfigureGameEventTextDrawable",value:function(e,r){var o=this;hi(this,t,e),hi(this,n,r),null!==this.State?this.State.Achievement.on((function(e){var t=ni(e.toString(),2),n=t[0],r=t[1];o.GameEventAnimation=new jn(0,1,100*e.Rating,{subtitle:n,title:r,rating:e.Rating},0,jn.RevertingFunction())})):console.error("ConfigureGameEventTextDrawable called before this.State is assigned. Beware of the call order of Configure_ functions.")}},{key:"p5Draw",value:function(e){ai(si(u.prototype),"p5Draw",this).call(this,e),this.SetTransform(e,pi(this,n).X,pi(this,n).Y,pi(this,t).X,pi(this,t).Y);var r=this.GameEventAnimation;r&&(r.Tick(),r.Finished&&(this.GameEventAnimation=null),e.textAlign(e.CENTER,e.BOTTOM),e.fill(255,255,255,255*r.CurrentValue),e.noStroke(),e.textSize(15*r.Data.rating*.8),Yn(e,r.Data.subtitle,0,15*r.Data.rating),e.textSize(15*r.Data.rating),Yn(e,r.Data.title,0,0))}}])&&ii(r.prototype,o),i&&ii(r,i),u}(e)}function bi(e){return(bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function di(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function wi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function gi(e,t,n){return(gi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ki(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function mi(e,t){return(mi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Si(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ki(e);if(t){var o=ki(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Oi(this,n)}}function Oi(e,t){return!t||"object"!==bi(t)&&"function"!=typeof t?Pi(e):t}function Pi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ki(e){return(ki=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ri(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Ci(e,t,"get"))}function Ti(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,Ci(e,t,"set"),n),n}function Ci(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function _i(e){var t,n;return t=new WeakMap,n=new WeakMap,function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mi(e,t)}(u,e);var r,o,i,a=Si(u);function u(){var e;di(this,u);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return e=a.call.apply(a,[this].concat(o)),t.set(Pi(e),{writable:!0,value:void 0}),n.set(Pi(e),{writable:!0,value:void 0}),Ti(Pi(e),t,new we(0,0)),Ti(Pi(e),n,new we(1,1)),e}return r=u,(o=[{key:"ConfigureGarbageMeterDrawable",value:function(e,r){Ti(this,t,e),Ti(this,n,r)}},{key:"p5Draw",value:function(e){if(gi(ki(u.prototype),"p5Draw",this).call(this,e),null!==this.State){this.SetTransform(e,Ri(this,n).X,Ri(this,n).Y,Ri(this,t).X,Ri(this,t).Y);var r=this.State,o=this.BlockSize;e.fill(50),e.rect(0,0,o,o*r.PlayfieldHeight),e.fill(Fn(e,ve.Garbage));var i=r.GarbageMeter.reduce((function(e,t){return e+t.Lines}),0);i>r.PlayfieldHeight&&(i=r.PlayfieldHeight,e.fill("red"));for(var a=0;a<i;a++)e.rect(0,a*o,o,o)}}}])&&wi(r.prototype,o),i&&wi(r,i),u}(e)}function ji(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ei=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t&&n?(this.width=t,this.height=n):(this.width=440,this.height=502)}var t,n,r;return t=e,(n=[{key:"SetTransform",value:function(e,t,n,r,o){this.ResetTransform(e),e.translate(r,o),e.scale(t,n)}},{key:"ResetTransform",value:function(e){e.resetMatrix(),e.scale(1,-1),e.translate(0,-this.height),e.scale(1,1)}},{key:"p5Setup",value:function(e,t){e.createCanvas(this.width,this.height).parent(t),e.frameRate(60),this.ResetTransform(e)}},{key:"p5Draw",value:function(e){e.background(100)}},{key:"DrawHandler",get:function(){return this.p5Draw.bind(this)}},{key:"SetupHandler",get:function(){return this.p5Setup.bind(this)}}])&&ji(t.prototype,n),r&&ji(t,r),e}();function xi(e){return(xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ai(e,t){return(Ai=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Di(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Gi(e);if(t){var o=Gi(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Bi(this,n)}}function Bi(e,t){return!t||"object"!==xi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Gi(e){return(Gi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Hi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ai(e,t)}(n,e);var t=Di(n);function n(e,r,o,i){var a,u,c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(c=o&&i?t.call(this,o,i):t.call(this)).ConfigureGameState(r.State),c.ConfigurePlayer(r.Player),c.ConfigureGame(e),c.ConfigureBlockSize(O),c.ConfigurePlayfieldAnimatable(),c.ConfigurePlayerSfxPlayable(.125),c.ConfigureGameEventSfxPlayable(.125),c.ConfigureGameEventVoicePlayable(.125),c.ConfigureGameEventTextDrawable(new we(11*c.BlockSize,c.BlockSize*((null!==(a=null===(u=c.State)||void 0===u?void 0:u.PlayfieldHeight)&&void 0!==a?a:S)+1)),new we(1,1)),c.ConfigurePlayfieldDrawable(new we(6*c.BlockSize,0),new we(1,1)),c.ConfigureHoldPieceDrawable(new we(10,200),new we(1,1)),c.ConfigurePieceQueueDrawable(new we(18*c.BlockSize,100),new we(.7,.7)),c.ConfigureGarbageMeterDrawable(new we(16.5*c.BlockSize,0),new we(1,1)),c.ConfigureFramerateDrawable(new we(0,c.height-10),new we(1,1)),Bi(c)}return n}(Xr(_i(xr(wr(ir(vi(Mo(ei(ko(Mn(uo(Zr(Pn(vn(un(Ei))))))))))))))));function Ii(e){return(Ii="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Mi(e,t){return(Mi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Li(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ni(e);if(t){var o=Ni(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Fi(this,n)}}function Fi(e,t){return!t||"object"!==Ii(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ni(e){return(Ni=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Yi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mi(e,t)}(i,e);var t,n,r,o=Li(i);function i(e,t,n,r){var a,u,c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(c=n&&r?o.call(this,n,r):o.call(this,220,251)).ConfigureGameState(t.State),c.ConfigurePlayer(t.Player),c.ConfigureGame(e),c.ConfigureBlockSize(O),c.ConfigurePlayfieldAnimatable(),c.ConfigurePlayerSfxPlayable(0),c.ConfigureGameEventSfxPlayable(.025),c.ConfigureGameEventVoicePlayable(.025),c.ConfigureGameEventTextDrawable(new we(11*c.BlockSize,c.BlockSize*((null!==(a=null===(u=c.State)||void 0===u?void 0:u.PlayfieldHeight)&&void 0!==a?a:S)+1)),new we(1,1)),c.ConfigurePlayfieldDrawable(new we(6*c.BlockSize,0),new we(1,1)),c.ConfigureHoldPieceDrawable(new we(10,200),new we(1,1)),c.ConfigurePieceQueueDrawable(new we(18*c.BlockSize,100),new we(.7,.7)),c.ConfigureGarbageMeterDrawable(new we(16.5*c.BlockSize,0),new we(1,1)),c.ConfigureFramerateDrawable(new we(0,c.height-10),new we(1,1)),Fi(c)}return t=i,(n=[{key:"ResetTransform",value:function(e){e.resetMatrix(),e.scale(1,-1),e.translate(0,-this.height),e.scale(.5,.5)}}])&&Wi(t.prototype,n),r&&Wi(t,r),i}(Xr(_i(xr(wr(ir(vi(Mo(ei(ko(Mn(uo(Pn(vn(un(Ei)))))))))))))));function Xi(e){return(Xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Vi(e,t){return(Vi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ui(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=qi(e);if(t){var o=qi(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ki(this,n)}}function Ki(e,t){return!t||"object"!==Xi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qi(e){return(qi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Qi,$i,Ji,Zi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Vi(e,t)}(i,e);var t,n,r,o=Ui(i);function i(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this)).ConfigureInputDelayable(5),e}return t=i,(n=[{key:"Update",value:function(e,t){return y.None}}])&&zi(t.prototype,n),r&&zi(t,r),i}((Qi=w,$i=new WeakMap,Ji=new WeakMap,function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(i,e);var t,n,r,o=_(i);function i(){var e;R(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=o.call.apply(o,[this].concat(n)),$i.set(E(e),{writable:!0,value:void 0}),Ji.set(E(e),{writable:!0,value:void 0}),D(E(e),$i,0),D(E(e),Ji,5),e}return t=i,(n=[{key:"Tick",value:function(e){var t=e.TicksElapsed-A(this,$i)>=A(this,Ji),n=this.Update(e,t);return t?(n!==y.None&&D(this,$i,e.TicksElapsed),n):y.None}},{key:"ConfigureInputDelayable",value:function(e){D(this,Ji,e)}},{key:"Update",value:function(e,t){return y.None}}])&&T(t.prototype,n),r&&T(t,r),i}(Qi)));function ea(e){return(ea="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ta(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return na(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return na(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function na(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ra(e,t,n){return(ra="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ca(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function oa(e,t){return(oa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ia(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ca(e);if(t){var o=ca(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return aa(this,n)}}function aa(e,t){return!t||"object"!==ea(t)&&"function"!=typeof t?ua(e):t}function ua(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ca(e){return(ca=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function la(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function sa(e,t,n){return t&&fa(e.prototype,t),n&&fa(e,n),e}function pa(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,ya(e,t,"get"))}function ha(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,ya(e,t,"set"),n),n}function ya(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var va=new WeakMap,ba=function(){function e(t,n){la(this,e),va.set(this,{writable:!0,value:void 0}),this.rot=t,this.col=n,this.pieceTop=0,this.heightMap=[],this.enclosedHoles=0,this.openHoles=0,this.blocksAboveHoles=0,this.iWells=[],this.isDead=!1,this.holdPiece=ve.None,ha(this,va,null),this.achievement=null}return sa(e,[{key:"globalTop",get:function(){return this.heightMap.max()}},{key:"bumpiness",get:function(){var e=this;return this.heightMap.reduce((function(t,n,r){return t+(0===r?0:Math.abs(n-e.heightMap[r-1]))}),0)}},{key:"Rating",value:function(e){if(pa(this,va))return pa(this,va);var t=e(this);return ha(this,va,t),t}}],[{key:"Never",get:function(){var t=new e(0,0);return ha(t,va,Number.MIN_VALUE),t}}]),e}();function da(e,t,n,r){n[t][e]!==ve.None||r[t][e]||(r[t][e]=!0,e>0&&da(e-1,t,n,r),e<n[0].length-1&&da(e+1,t,n,r),t>0&&da(e,t-1,n,r),t<n.length-1&&da(e,t+1,n,r))}var wa=new WeakMap,ga=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oa(e,t)}(n,e);var t=ia(n);function n(){var e;return la(this,n),e=t.call(this),wa.set(ua(e),{writable:!0,value:void 0}),ha(ua(e),wa,null),e}return sa(n,[{key:"rateChoice",value:function(e){var t,n,r=0;return r-=e.globalTop,r-=e.pieceTop,r-=e.enclosedHoles,r-=e.openHoles,r-=e.blocksAboveHoles,r-=e.iWells.sum(),r+=10*(null!==(t=null===(n=e.achievement)||void 0===n?void 0:n.Rating)&&void 0!==t?t:0),r-=e.bumpiness,r+=e.holdPiece===ve.I?10:0,e.isDead&&(r=Number.MIN_VALUE),r}},{key:"getChoice",value:function(e,t){for(var n=this,r=[],o=0;o<ke[t.Type].Rotations.length;o++)for(var i=ke[t.Type].Rotations[o].map((function(e){return e.X})).min(),a=ke[t.Type].Rotations[o].map((function(e){return e.X})).max(),u=function(n){var i,a,u=new ba(o,n),c=new it(e);c.Achievement.once((function(e){return u.achievement=e}));var l=t.Clone();c.Falling=l,l.Position.X=n,l.Rotation=o,c.HardDropPiece(),u.pieceTop=l.Top;for(var f=[],s=new Array(c.GridHeight).fill(null).map((function(e){return new Array(c.GridWidth).fill(!1)})),p=0;p<c.GridWidth;p++)da(p,c.GridHeight-1,c.Grid,s);u.enclosedHoles=c.Grid.reduce((function(e,t,n){return e+t.reduce((function(e,t,r){return e+(t!==ve.None||s[n][r]?0:(f.push([r,n]),1))}),0)}),0);for(var h=[],y=function(e){var t=c.Grid.map((function(t){return t[e]}));t[-1]=ve.I;for(var n=t.length-1;t[n]===ve.None;)n--;h.push(n+1)},v=0;v<c.GridWidth;v++)y(v);u.heightMap=h,u.openHoles=c.Grid.reduce((function(e,t,n){return e+t.reduce((function(e,t,r){return e+(t===ve.None&&s[n][r]&&n<h[r]?(f.push([r,n]),1):0)}),0)}),0),u.blocksAboveHoles=f.reduce((function(e,t){for(var n=ta(t,2),r=n[0],o=n[1];o<h[r];o++)c.Grid[r][o]!==ve.None&&e++;return e}),0),u.iWells=[];for(var b=0;b<c.GridWidth;b++){var d=[];b>0&&d.push(h[b-1]-h[b]),b<c.GridWidth-1&&d.push(h[b+1]-h[b]),u.iWells.push(Math.max(0,Math.min.apply(Math,d)))}u.isDead=c.IsDead,u.holdPiece=null!==(i=null===(a=c.Hold)||void 0===a?void 0:a.Type)&&void 0!==i?i:ve.None,r.push(u)},c=-i;c<e.GridWidth-a;c++)u(c);return r.sort((function(e,t){return t.Rating(n.rateChoice)-e.Rating(n.rateChoice)})),r[0]}},{key:"Update",value:function(e,t){var r=e.Falling;if(null===r&&ha(this,wa,null),null===pa(this,wa)&&null!==r||null!==pa(this,wa)&&null!==r&&pa(this,wa).PieceIndex!==r.PieceIndex){ha(this,wa,r);var o=this.getChoice(e,r),i=ba.Never,a=new it(e);if(a.HoldPiece(),a.Falling&&(i=this.getChoice(a.GetVisibleState(),a.Falling)),i.Rating(this.rateChoice)>o.Rating(this.rateChoice))this.Enqueue(y.Hold);else{var u=o.col,c=o.rot;if(1===c?this.Enqueue(y.RotateCW):3===c?this.Enqueue(y.RotateCCW):2===c&&(this.Enqueue(y.RotateCW),this.Enqueue(y.RotateCW)),u>r.Position.X)for(var l=0;l<u-r.Position.X;l++)this.Enqueue(y.ShiftRight);else if(u<r.Position.X)for(var f=0;f<r.Position.X-u;f++)this.Enqueue(y.ShiftLeft);this.Enqueue(y.HardDrop)}}return ra(ca(n.prototype),"Update",this).call(this,e,t)}}]),n}(U(Zi));function ma(e){return(ma="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sa(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Oa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pa(e,t){return(Pa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ka(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ta(e);if(t){var o=Ta(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ra(this,n)}}function Ra(e,t){return!t||"object"!==ma(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ta(e){return(Ta=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ca=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pa(e,t)}(i,e);var t,n,r,o=ka(i);function i(){return Sa(this,i),o.apply(this,arguments)}return t=i,(n=[{key:"rateChoice",value:function(e){var t=0;return t-=e.globalTop,t-=4*e.pieceTop,t-=10*e.enclosedHoles,t-=10*e.openHoles,t-=e.blocksAboveHoles,t-=e.iWells.filter((function(e){return e>=3})).sum(),t-=e.bumpiness,e.achievement&&(t+=10*e.achievement.Combo),t+=e.holdPiece===ve.I?10:0,e.isDead&&(t=Number.MIN_VALUE),t}}])&&Oa(t.prototype,n),r&&Oa(t,r),i}(ga),_a=n(788);function ja(e){return(ja="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ea(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Aa(e,t){return(Aa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Da(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ga(e);if(t){var o=Ga(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ba(this,n)}}function Ba(e,t){return!t||"object"!==ja(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ga(e){return(Ga=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ha=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Aa(e,t)}(i,e);var t,n,r,o=Da(i);function i(){return Ea(this,i),o.apply(this,arguments)}return t=i,(n=[{key:"rateChoice",value:function(e){var t=0;t-=2*e.globalTop,t-=4*e.pieceTop,t-=20*e.enclosedHoles,t-=20*e.openHoles,t-=e.blocksAboveHoles;var n,r,o=e.iWells.filter((function(e){return e>=3}));return o.length>0&&(t-=o.sum()-o.max()),t-=e.bumpiness,e.achievement&&(e.achievement.Type===Fe.LineClear?4===e.achievement.LinesCleared.length?t+=20*e.achievement.Rating:t-=20*(4-e.achievement.LinesCleared.length):t+=5*(null!==(n=null===(r=e.achievement)||void 0===r?void 0:r.Rating)&&void 0!==n?n:0)),t+=e.holdPiece===ve.I?10:0,e.isDead&&(t=Number.MIN_VALUE),t}}])&&xa(t.prototype,n),r&&xa(t,r),i}(ga);function Ia(e){return function(e){if(Array.isArray(e))return La(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ma(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wa(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(e,t)||Ma(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ma(e,t){if(e){if("string"==typeof e)return La(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?La(e,t):void 0}}function La(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const Fa=function(e){var t=Wa((0,r.useState)(),2),n=t[0],o=t[1],i=(0,_a.gz)({rounds:0,wins:null});return(0,r.useEffect)((function(){i.rounds++;var e=new ee,t=[];t.push(new Ha),t.push(new Ca);var n=new Jt([{player:e}].concat(Ia(t.map((function(e){return{player:e}}))))),r=new Hi(n,n.Participants[0]),a=[];return n.Participants.slice(1).forEach((function(e){return a.push(new Yi(n,e))})),o([r].concat(a)),setTimeout((function(){return n.StartClock()}),1e3),n.GameEnded.once((function(){n.StopClock(),setTimeout((function(){var e,t=null===(e=i.wins)||void 0===e?void 0:e.slice();t||(t=new Array(n.Participants.length).fill(0)),t[n.Participants.findIndex((function(e){return!e.State.IsDead}))]++,i.wins=t}),1e3)})),function(){o(void 0)}}),[i.wins]),r.createElement("div",{className:"min-h-screen w-screen relative"},r.createElement("p",{className:"absolute top-0 left-0 z-10"},"Round ",i.rounds),r.createElement("div",{className:"absolute top-0 left-0 right-0 bottom-0 flex justify-center items-center flex-wrap"},null==n?void 0:n.map((function(e,t){return r.createElement("div",{key:"".concat(i.rounds,"-").concat(t)},r.createElement(p(),{setup:e.SetupHandler,draw:e.DrawHandler,keyPressed:e instanceof Hi?e.KeyPressedHandler:void 0,keyReleased:e instanceof Hi?e.KeyReleasedHandler:void 0}),r.createElement("p",null,i.wins?"".concat(i.wins[t]," wins"):null))}))))};function Na(e){return(Na="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ya(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xa(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function za(e,t){return(za=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Va(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=qa(e);if(t){var o=qa(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ua(this,n)}}function Ua(e,t){return!t||"object"!==Na(t)&&"function"!=typeof t?Ka(e):t}function Ka(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qa(e){return(qa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qa(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Ja(e,t,"get"))}function $a(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,Ja(e,t,"set"),n),n}function Ja(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var Za=new WeakMap,eu=new WeakMap,tu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&za(e,t)}(i,e);var t,n,r,o=Va(i);function i(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return Ya(this,i),t=o.call(this),Za.set(Ka(t),{writable:!0,value:void 0}),eu.set(Ka(t),{writable:!0,value:void 0}),$a(Ka(t),Za,null),t.Player=e,t.State=n instanceof it?n:new it(n),$a(Ka(t),eu,new Te),t}return t=i,(n=[{key:"Input",get:function(){return Qa(this,eu)}},{key:"ClockRunning",get:function(){return null!==Qa(this,Za)}},{key:"StartClock",value:function(){$a(this,Za,window.setInterval(this.Tick.bind(this),1e3/60))}},{key:"StopClock",value:function(){null!==Qa(this,Za)&&window.clearInterval(Qa(this,Za))}},{key:"Tick",value:function(){if(!this.State.IsDead){this.State.Tick();var e=this.Player.Tick(this.State.GetVisibleState()),t=this.State.Falling,n=!1;switch(e){case y.None:break;case y.HardDrop:n=this.State.HardDropPiece();break;case y.Hold:n=this.State.HoldPiece();break;case y.RotateCW:n=this.State.RotatePiece(de.CW);break;case y.RotateCCW:n=this.State.RotatePiece(de.CCW);break;case y.ShiftLeft:n=this.State.ShiftPiece(-1);break;case y.ShiftRight:n=this.State.ShiftPiece(1);break;case y.SoftDrop:n=this.State.SoftDropPiece(!1)}e!==y.None&&Qa(this,eu).emit(new b(this.State.TicksElapsed,e,n,t,this.Player))}}}])&&Xa(t.prototype,n),r&&Xa(t,r),i}(xt);function nu(e){return(nu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ru(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ou(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function iu(e,t){return(iu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function au(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=cu(e);if(t){var o=cu(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return uu(this,n)}}function uu(e,t){return!t||"object"!==nu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function cu(e){return(cu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function lu(e){return(lu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fu(e,t){return(fu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function su(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=hu(e);if(t){var o=hu(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return pu(this,n)}}function pu(e,t){return!t||"object"!==lu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function hu(e){return(hu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var yu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fu(e,t)}(n,e);var t=su(n);function n(e,r,o){var i,a,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(u=r&&o?t.call(this,r,o):t.call(this)).ConfigureGameState(e.State),u.ConfigurePlayer(e.Player),u.ConfigureGame(e),u.ConfigureBlockSize(O),u.ConfigurePlayfieldAnimatable(),u.ConfigurePlayerSfxPlayable(P),u.ConfigureGameEventSfxPlayable(P),u.ConfigureGameEventVoicePlayable(P),u.ConfigureGameEventTextDrawable(new we(11*u.BlockSize,u.BlockSize*((null!==(i=null===(a=u.State)||void 0===a?void 0:a.PlayfieldHeight)&&void 0!==i?i:S)+1)),new we(1,1)),u.ConfigurePlayfieldDrawable(new we(6*u.BlockSize,0),new we(1,1)),u.ConfigureHoldPieceDrawable(new we(10,200),new we(1,1)),u.ConfigurePieceQueueDrawable(new we(17*u.BlockSize,100),new we(.7,.7)),u.ConfigureFramerateDrawable(new we(0,u.height-10),new we(1,1)),pu(u)}return n}(Xr(xr(wr(ir(vi(Mo(ei(ko(Mn(uo(Zr(Pn(vn(function(e){return function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&iu(e,t)}(i,e);var t,n,r,o=au(i);function i(){var e;ru(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=o.call.apply(o,[this].concat(n))).State=null,e}return t=i,(n=[{key:"ConfigureGameState",value:function(e){this.State=e}}])&&ou(t.prototype,n),r&&ou(t,r),i}(e)}(Ei)))))))))))))));function vu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return bu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const du=function(e){var t=vu((0,r.useState)(),2)[1],n=vu((0,r.useState)(),2)[1],o=vu((0,r.useState)(),2),i=o[0],a=o[1];return(0,r.useEffect)((function(){var e=new ee,r=new tu(e),o=new yu(r);return t(e),n(r),a(o),setTimeout((function(){return r.StartClock()}),1e3),function(){r.StopClock()}}),[]),i?r.createElement("div",{className:"min-h-screen w-screen flex justify-center items-center"},r.createElement(p(),{setup:i.SetupHandler,draw:i.DrawHandler,keyPressed:i.KeyPressedHandler,keyReleased:i.KeyReleasedHandler})):r.createElement("p",null,"Loading")};const wu=function(){return r.createElement(i.UT,null,r.createElement(a.rs,null,r.createElement(a.AW,{exact:!0,path:"/",component:l}),r.createElement(a.AW,{exact:!0,path:"/test",component:du}),r.createElement(a.AW,{exact:!0,path:"/multi/local",component:Fa}),r.createElement(a.AW,{component:u})))};o.render(r.createElement(wu,null),document.getElementById("app"))}},e=>{"use strict";var t;t=919,e(e.s=t)}]);